---
title: 命令行下创建 Android 工程，用 Ant 进行编译部署
url: /cmd-android-ant-project/
date: 2011-04-06T05:07:32-05:00
featured: false
draft: false
type: post
toc: false
# menu: main
usePageBundles: true
categories:
  - Android
tags: 
  - ant
  - android
comment: true
codeMaxLines: 50
# additional
wpPostId: 3403 
wpStatus: publish
views: 2071
lastmod: 2012-03-09T23:52:53-06:00
---

安装完 Android SDK 后可以在命令行下 Android.bat 命令创建一个示例项目，有 Ant 的话还可直接用 Ant 来编译部署到模拟器上运行。<br/>
<br/>
环境准备：<br/>
<br/>
告诉 path 要指向到 Android SDK 目录的 tools 子目录中，如 d:\android-sdk-windows\tools<br/>
要用 ant 编译部署的话，再把 ant 的 bin 目录加入到 path 上，如 D:\apache-ant-1.8.2\bin<br/>
<br/>
CMD 进到命令行下，执行：<br/>
android create project -k cc.unmi.android.test -n Hello -a HelloAndroid -t 5 -p c:\TestAndroid<br/>
<br/>
注：以上各参数的意义，可参考：http://developer.android.com/guide/developing/projects/projects-cmdline.html<br/>
-k 工程包名: cc.unmi.android.test<br/>
-n 工程名  : Hello<!--more--><br/>
-a Activity子类名: HelloAndroid<br/>
-t 工程使用的平台 Target: 5 ( 基于Android SDK1.6)，是执行 android list targets 显示出的 target id 值<br/>
-p 工程存储路径: c:\TestAndroid<br/>
<br/>
控制台下输出：<br/>
<br/>
Created project directory: c:\TestAndroid<br/>
Created directory C:\TestAndroid\src\cc\unmi\android\test<br/>
Added file c:\TestAndroid\src\cc\unmi\android\test\HelloAndroid.java<br/>
Created directory C:\TestAndroid\res<br/>
Created directory C:\TestAndroid\bin<br/>
Created directory C:\TestAndroid\libs<br/>
Created directory C:\TestAndroid\res\values<br/>
Added file c:\TestAndroid\res\values\strings.xml<br/>
Created directory C:\TestAndroid\res\layout<br/>
Added file c:\TestAndroid\res\layout\main.xml<br/>
Created directory C:\TestAndroid\res\drawable-hdpi<br/>
Created directory C:\TestAndroid\res\drawable-mdpi<br/>
Created directory C:\TestAndroid\res\drawable-ldpi<br/>
Added file c:\TestAndroid\AndroidManifest.xml<br/>
Added file c:\TestAndroid\build.xml<br/>
Added file c:\TestAndroid\proguard.cfg<br/>
<br/>
我们知道生成了什么文件，目录下存在 build.xml 文件。这时候，还没 gen 目录，bin 目录是空的。<br/>
<br/>
现在如果已配置好了 ant，就可以进到 c:\TestAndroid 目录下，执行 ant help, 显示出可以使用的 ant 的 target 选项：<br/>
<br/>
help:<br/>
[echo] Android Ant Build. Available targets:<br/>
[echo]    help:      Displays this help.<br/>
[echo]    clean:     Removes output files created by other targets.<br/>
[echo]    compile:   Compiles project's .java files into .class files.<br/>
[echo]    debug:     Builds the application and signs it with a debug key.<br/>
[echo]    release:   Builds the application. The generated apk file must be<br/>
[echo]               signed before it is published.<br/>
[echo]    install:   Installs/reinstalls the debug package onto a running<br/>
[echo]               emulator or device.<br/>
[echo]               If the application was previously installed, the<br/>
[echo]               signatures must match.<br/>
[echo]    uninstall: Uninstalls the application from a running emulator or<br/>
[echo]               device.<br/>
<br/>
也就是可以用 ant compile, ant release, ant install 等进行编译，打包，部署等。<br/>
<br/>
ant compile 在 bin 下编译出 class 文件，生成 gen 目录及 R.java。<br/>
ant release 在 bin 下生成 classes.dex, Hello.ap_ 和 Hello-unsigned.apk。<br/>
<br/>
要是你现在启动了 Android 模拟器，启动模拟器的命令是 emulator -avd avd名。关于创建 avd 的做法这里略去。<br/>
<br/>
那现在可以执行 ant install<br/>
<br/>
ant install 指令最后的过程是：<br/>
<br/>
-package-debug-sign:<br/>
[apkbuilder] Creating Hello-debug-unaligned.apk and signing it with a debug key...<br/>
<br/>
debug:<br/>
[echo] Running zip align on final apk...<br/>
[echo] Debug Package: C:\TestAndroid\bin\Hello-debug.apk<br/>
<br/>
install:<br/>
[echo] Installing C:\TestAndroid\bin\Hello-debug.apk onto default emulator or device...<br/>
[exec]     pkg: /data/local/tmp/Hello-debug.apk<br/>
[exec] Success<br/>
[exec] 35 KB/s (13235 bytes in 0.359s)<br/>
<br/>
BUILD SUCCESSFUL<br/>
<br/>
在 c:\TestAndroid 下新生成了 Hello-debug-unaligned.apk 和 Hello-debug.apk, 然后部署到模拟器上的是 Hello-debug.apk。当然有了 apk，你也可以直接使用 adb install Hello-debug.apk 来安装到模拟器上。<br/>
<br/>
来到模拟器下就可以看到这个 HelloAndroid 的运行效果了，见下面两图：<br/>
<br/>
{{< bundle-image src="android_cmd1.png" width="328px" class="inline" >}}&nbsp;&nbsp;
{{< bundle-image src="android_cmd2.png" width="333px" class="alignright" >}}
<br/><br/>
参考：1. <a href="http://blog.csdn.net/cs_lht/archive/2010/11/22/6028305.aspx" target="_blank">用Ant编译Android项目工程</a><br/>
2. <a href="http://www.chainlt.com/?p=819" target="_blank">android 命令行编译 ant</a><br/>
3. <a href="http://wiki.impjq.net/doku.php?id=android:build-with-ant" target="_blank">如何使用ant编译Android工程</a><br/>
4. <a href="http://developer.android.com/guide/developing/projects/projects-cmdline.html" target="_blank">Creating an Android Project</a>
