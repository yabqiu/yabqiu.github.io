---
title: 开启 Python 组件 Boto3 在 IDE 中的智能提示
url: /aws-boto3-python-ide-autocomplete/
date: 2019-07-13T13:44:02-05:00
featured: false
draft: false
toc: false
# menu: main
usePageBundles: true
thumbnail: "../images/logos/aws-logo.png"
categories:
  - Python
  - AWS
tags: 
  - autocomplete
  - Python
  - boto3
comment: true
codeMaxLines: 50
# additional
wpPostId: 9477 
wpStatus: publish
views: 922
lastmod: 2019-07-13T13:46:38-05:00
---

<p>在用 Python 编写 AWS 服务时，要用到 Boto 3 组件，而像 boto3.client('s3') 获得的对象只能被 IDE 识别为一个 BaseClient, 具体包含什么操作方法是在运行时由参数 <code>s3</code> 指示的基于 JSON 文件所描述的。因此 IDE 对 <code>s3 = boto3.client('s3')</code> 的 <code>s3</code> 对象无法提供有效的智能提示，每次用 Boto 3 时不得不打开 Boto 3 的在线 API 文档来对照。长此以往，总觉麻烦且效率低下，有种一直摸着石头过河的感觉。那么，是否有办法让 IDE 智能提示出各种 boto3.client('&lt;service&gt;') 的实际操作呢？网上找了找，确实有这个需求，解决办法有</p>

<ol>
	<li><a href="https://pypi.org/project/botostubs/">botostubs</a>: 与 boto3 API 保持更新(每三天)，并支持众多 IDE, 试过在 IntelliJ IDEA 和 Visual Studio Code 中可用</li>
	<li><a href="https://pypi.org/project/pyboto3/">pyboto3</a>: 上次更新在两年前, <a href="https://github.com/wavycloud/pyboto3">https://github.com/wavycloud/pyboto3</a>, 只在 Python 2.7 下测试过</li>
	<li><a href="https://pypi.org/project/autoboto/">autoboto</a>: 需有智能提示，但改变了应用 Boto 3 组件的方式，不建议使用</li>
</ol>

<p>本文重点推荐 botostubs, 下面会叙说具体理由，在进入正是之前，不妨来回顾一下直接使用 Boto 3 时没有好的智能提示的问题<!--more--></p>

<h3>Boto 3 组件智能提示的现状</h3>
<p>Visual Studio Code 中对 <code>s3 = boto3.client('s3')  s3.</code> 没有任何提示</p>

{{< bundle-image src="boto3-autocomplete-2.png" width="230px" >}}

<p>IntelliJ IDEA 中只识别为 BaseClient</p>

{{< bundle-image src="boto3-autocomplete-1-800x390.png" width="400px" >}}

<p>反而 Python 控制台令人意外的聪明，能提示出全部的操作，由于 Python 控制台每输入完一行马上进行解析，所以知道运行时类型</p>

{{< bundle-image src="boto3-autocomplete-3-800x332.png" width="400px" >}}

<p>boto3.client('&lt;service&gt;') 的实际类型</p>

<blockquote>
<p>&gt; import boto3<br />
&gt;&gt;&gt; s3 = boto3.client('s3')<br />
&gt;&gt;&gt; type(s3)<br />
&lt;class 'botocore.client.S3'&gt;<br />
&gt;&gt;&gt; type(boto3.client('sqs'))<br />
&lt;class 'botocore.client.SQS'&gt;</p>
</blockquote>

<p>现在正式开始步入正题，看我的日志总是需要一点耐心的</p>

<h3>botostubs 开启 boto 3 API 在 IDE 中的智能提示</h3>
<p>看 botostubs 组件页面 h<a href="https://pypi.org/project/botostubs/">ttps://pypi.org/project/botostubs/</a>，它号称的是让任何 IDE 能对 Botot 3 API 进行智能提示，比如 IntelliJ IDEA, Visual Studio Code, Vim, Emacs, Sublime, Atom 等。而且它能紧跟 Boto 3 的更新，它每三天检查一次 boto 3 是否有更新，有更新时则生成新的桩 -- 今天(2019-07-13) GitHub 上显示最后更新时间为 12 天前。所以本地要在 IDE 中获得最新智能提示，应经常性的用 <code>pip install --upgrade botostubs</code> 更新。</p>

<p>首先需要安装 botostubs, 命令 <code>pip install botostubs</code></p>

<h4>botostubs 在 IDE 的使用</h4>
<p>应用 botostubs 时需要在代码中有一点变动，基本对原有代码没有侵入性的。</p>

<p>下图是在 <strong>IntelliJ IDEA</strong> 中的表现，有了 botostubs 后, IDE 能认出这儿的 <code>s3</code> 是一个 S3 类型，进而提示出所有实际可用的操作以及方法参数类型</p>

{{< bundle-image src="boto3-autocomplet-4-800x220.png" width="400px" >}}

<p>在这里 botostubs 借用了 Python 3 之后类型提示(type hints) 的语法，关于类型提示可参考 <a href="https://sikasjc.github.io/2018/07/14/type-hint-in-python/">全面理解Python中的类型提示（Type Hints）</a>。</p>
<p>具体来说除了前面的紧随变量声明后的 <code># type: botostubs.S3</code>，还有另外两种书写形式。在此对比一下所有的三种方式</p>

<table style="border-collapse: collapse; width: 100%;">
<tbody>
<tr>
<td style="width: 8.02099%;">形式</td>
<td style="width: 36.081%;">代码</td>
<td style="width: 55.8979%;">说明</td>
</tr>
<tr>
<td style="width: 8.02099%;">行内注释</td>
<td style="width: 36.081%;">

{{< highlight python "hl_lines=1 4" >}}
import botostubs
import boto3

s3 = boto3.client('s3') # type: botostubs.S3
s3.delete_bucket(...)
{{</ highlight >}}

</td>

<td style="width: 55.8979%;">
<p>1. <code>import botostubs</code> 行可省略<br /><br/>
2. 如果有 <code>import botostubs</code> 的话，在 IntelliJ IEDA 书写 <code>type: botostubs.</code> 处也会有提示其下的类型<br /><br/>
3. 书写比较便利，如果发布时需移除 <code>botostubs</code> 依赖可把源文件中的 <code>import botostubs</code> 去除<br /><br/>
4. 同时支持 Visual Studio Code，通用性较强</p>
</td>
</tr>
<tr>
<td style="width: 8.02099%;">文档注释</td>
<td style="width: 36.081%;">

{{< highlight python "hl_lines=4" >}}
import boto3

s3 = boto3.client('s3')
""" :type: botostubs.S3 """

s3.delete_bucket(...)
{{</ highlight >}}

</td>

<td style="width: 55.8979%;">
<p>1. <code>import botostubs</code> 此时没有必要存在，因为在文档注释中写 <code>:type: botostubs.</code> 处没有智能提示<br /><br/>
2. 源代码级别就无需依赖于 <code>botostubs</code>，它纯粹是级 IDE 看的<br /><br/>
3. 但是在 Visual Studio Code 中没有智能提示</p>
</td>
</tr>
<tr>
<td style="width: 8.02099%;">类型声明</td>
<td style="width: 36.081%;">

{{< highlight python "hl_lines=4" >}}
import botostubs
import boto3

s3: botostubs.S3 = boto3.client('s3')
s.delete_bucket(...)
{{</ highlight >}}
</td>

<td style="width: 55.8979%;">

<p>1. <code>import botostubs</code> 也不能省略了，否则解析执行时会报错<br /><br/>
2. 对 <code>botostubs</code> 有强依赖，不建议使用，而且 Python 2 不能用 -- 不过谁还在用 Python 2 呢？<br /><br/>
3. 在 Visual Studio Code 中也支持</p>
</td>
</tr>
</tbody>
</table>

<p>以上三种形式在 IntelliJ IDEA 都有效果，基于通用性来讲第一种方式更可取，这也是为什么 botostubs 的官方只演示了该方式。在发布包带上 <code>botostubs</code> 这个运行时无关的依赖还算不上什么牺牲。</p>

<p>注：如果在基于 IntelliJ 的 IDE 中不能得到有效提示，需要在 IDE 的 <code>Help/ Edit Custom Properties...</code> 中加上一行</p>

<blockquote>
idea.max.intellisense.filesize=20000
</blockquote>

<p>再来到 <strong>Visual Studio Code</strong> 中体验一下</p>

{{< bundle-image src="boto3-autocomplete-5-800x344.png" width="400px" >}}

<p>在 Visual Studio Code 中也可以用 <code>batch: botostubs.Batch = boto3.client('batch')</code> 的形式，但是不支持文档注释方式</p>

{{< highlight python "hl_lines=2 3" >}}
batch = boto3.client('batch')<br/>
""" :type: botostubs.Batch """<br/>
batch.                          # 这时在 Visual Studio Code 中没有智能提示
{{</ highlight >}}

<p>还有一个 Visual Studio Code 比 IntelliJ IDEA 弱的地方是，书写注释时 <code>botostubs.</code> 无法提示出其下的类型，希望 Visutal Studio Code 以后会有所改进。</p>
<p>注：在 Visual Studio Code 中用 botostubs 的话，如果不能提示，请在 Visual Studio Code 设置中把 <code>python.jediEnabled</code> 设置为 false。</p>

<h3>顺带了解另两个 pyboto3 和 autoboto</h3><br/>
<p>虽然不建议使用它们，但不妨来看一下</p>
<p><code>pyboto3</code> 在 IntelliJ IDEA 中</p>

{{< bundle-image src="boto-autocomplete-6.png" width="503px" >}}

<p>上图来自于官方的 GitHub 网站 <a href="https://github.com/wavycloud/pyboto3">https://github.com/wavycloud/pyboto3</a>。它的实现与 <code>botostubs</code> 类似，只是没有人再维护了，随着 Boto 3 的升级，只能提示老的 API 的，而且也只在 Python 2.7 下测试过。亲测了一下，在 Visual Studio Code 中没有智能提示。</p>
<p><code>autoboto</code> 实际是 boto3 的封装</p>
<p><a href="https://github.com/jbasko/autoboto">https://github.com/jbasko/autoboto</a> 也说了不建议使用，已彻底停止维护了。</p>

<blockquote>
<p>boto3 with auto-complete in PyCharm and dataclasses not dicts. NOT RECOMMENDED FOR USE (2019-01-26)</p>
</blockquote>

<p>它完全构架于 Boto 3 之上的，可维护性太差，Boto 3 一小升级可能导致 autoboto 大动手脚与之相适应。</p>

{{< highlight python >}}
from autoboto.services import s3

s3 = s3.Client()
{{</ highlight >}}

<p>也由于它完全颠覆了使用 Boto 3 的方式，以致于它更可能带来新的问题。</p>

<h3>总结</h3><br/>
<p><code>botostubs</code> 是目前最佳选择，并且编码形式上推荐 <code>s3 = boto3.client('s3') # type: botostubs.S3</code>。它与 Boto 3 保持同步更新，并兼容于 IntelliJ IDEA 和 Visual Studio Code。<code>import botostubs</code> 在 IntelliJ IDEA 中是非必要的，打包前去除 <code>import botostubs</code> 即可完全免去发行包对 <code>botostubs</code> 的依赖，带上它也无妨。</p>

<p>链接：</p>

<ol>
	<li><a href="https://blog.wavycloud.com/2016/12/27/boto3-pyboto3-autocomplete/">Boto3 + Pyboto3 = Autocomplete = ❤︎</a></li>
	<li><a href="https://trevorsullivan.net/2019/06/11/intellisense-microsoft-vscode-aws-boto3-python/">Enable Intellisense for AWS Boto3 Type Hints in Microsoft Visual Studio Code</a></li>
</ol>
