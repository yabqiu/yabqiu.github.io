---
title: 走近 Ruby 的世界(六)
url: /close-to-ruby-world-6/
date: 2012-02-05T09:36:20-06:00
featured: false
#thumbnail: "../images/logos/ruby-logo.png"
draft: false
type: post
toc: false
# menu: main
usePageBundles: true
categories:
  - Ruby
tags: 
  - encoding
  - ruby
comment: true
codeMaxLines: 50
# additional
wpPostId: 4205 
wpStatus: publish
views: 236
lastmod: 2021-06-17T18:30:22-05:00
---

对于 Block，可以用 {} 或 do...end 来调用，如：</p>

{{< highlight ruby >}}
3.times { print "Ruby!" }   ＃可以写成 3.times do print "Ruby!" end

1.upto(10) do |x|
    print x
end
#也可以写成  1.upto(10) {|x| print x}  
{{</ highlight >}}

一般是多行时用 do...end，单行时用 {}<br/><br/>
但对于 module、class、method 的声明不能像 C/Java 那样用 {}，要用 ...end 来定义。<!--more--><br/><br/>
Ruby 的文件结构<br/>
{{< highlight ruby >}}
#!/usr/bin/ruby -W     #shebang 注释，给 Unix/Linux 的脚本说明的，必须放在第一行
#coding: utf-8         #指定编码的注释，放在第二行，如果没有 shebang 注释就放第一行
require 'socket'
...
__END__                #代码结束标识，下面为程序数据，可用 IO 的 DATA 读取的，像是可执行文件的.data 数据区
...
{{</ highlight >}}
<br/>
字符码码的注释，对于 Emacs 用户可写成 <span style="color: #800000;"># -*- coding: utf-8 -*-</span> 。冒号可写成 等号，即 coding = utf-8。字符集是大小写不敏感的，写成 uTf-8 也行。<br/><br/>
Ruby 又分源代码编码(Source Encoding) 和 默认外部编码(Default External Encoding)。源代码编码就是前面讲的，默认外部编码是脚本存文件时用的编码，这影响到了 Ruby 解释器要怎么读入它，执行时可用命令来指定：<br/><br/>
#ruby -E utf-8<br />
#ruby -Eutf-8<br />
#ruby --encoding utf-8<br />
#ruby --encoding=utf-8<br/><br/>
和其他的脚本代码一样，Ruby 脚本是从前至尾执行的，没有 main() 这样的玩意，但如果你的脚本中有 BEGIN 这样的块，就会先执行 BEGIN 块中的代码，然后再从头至尾，最后执行 END 块，例如：<br/>
{{< highlight ruby >}}
END{
   puts "over"
}     
puts 456  
BEGIN{
  puts 123
}
{{</ highlight >}}
<br/>
执行结果为：<br/><br/>
123<br />
over<br />
456<br/><br/>
最后，如果有 END 就执行 END 块。BEGIN 和 END 块可有多个，多个时，BEGIN 块按出现的顺序执行，END 块却按与出现的相反顺序执行。<br/><br/>
Ruby 脚本执行在遇到下面几种情况结束：<br/><br/>
1. 执行了一条语句导致程序的结束，例如 exit!<br />
2. 到达了文件的末尾<br />
3. 遇到了 __END__<br/><br/>
可以给 Ruby 脚本用 at_exit 函数加上退出时的勾子，即 "shutdown hook"。
