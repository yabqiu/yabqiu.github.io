---
title: ç”¨ Rust å†™ AWS Lambda çš„ç®€å•ä¾‹å­
url: /rust-write-aws-lambda-simple-example/
date: 2025-11-18T21:28:49-06:00
featured: true
draft: false
type: post
toc: false
# menu: main
usePageBundles: true
thumbnail: "../images/logos/rust-logo.png"
categories:
  - Rust
tags: 
  - lambda
  - Rust
comment: true
codeMaxLines: 50
# additional
wpPostId: 14487 
wpStatus: publish
views: 116
lastmod: 2025-11-19T18:37:06-06:00
---

AWS åœ¨ 2025-11-14 æ—¥å‘å¸ƒäº† <a href="https://aws.amazon.com/about-aws/whats-new/2025/11/aws-lambda-rust/">AWS Lambda adds support for Rust</a>, å³ AWS æ­£å¼æ”¯æŒç”¨ Rust å†™ Lambda äº†, å›é¡¾åˆ°ä¹‹å‰ AWS ä¸º Rust æä¾› SDK æ˜¯ä¸¤å¹´å‰çš„ 2023-11-27: <a href="https://aws.amazon.com/about-aws/whats-new/2023/11/aws-sdk-rust/">AWS SDK for Rust is now generally available</a>.Â <br/><br/>
æ—¥å¸¸ä¸­æ€»æœ‰å‡ ä¸ªç¼–ç¨‹è¯­è¨€æ˜¯è¦å»æŒæ¡çš„, åƒåŸºæœ¬çš„è„šæœ¬ Bash, ç½‘é¡µç”¨çš„ JavaScript, å¤§é¡¹ç›®ç”¨çš„ Java, AI æ—¶ä»£çš„ Python, å†å°±æ˜¯ä»¿ä½› Rust ä¹Ÿæ˜¯ç»•ä¸è¿‡çš„. ä¹‹å‰æœ‰å­¦è¿‡ Rust, åˆ°ç°åœ¨å¿˜å·®ä¸å¤šäº†, åˆçœ‹åˆ° Tauri, AWS Lambda å¯¹ Rust çš„å¤§åŠ›æ”¯æŒï¼Œæœ‰å¿…è¦æ”¾ Rust æåˆ°ä¸ Python, Java ä¸€æ ·çš„åœ°ä½æ¥çœ‹å¾…ã€‚å°½ç®¡å­¦ä¹ èµ·æ¥æ¯” C/C++ è¿˜é™¡å³­ï¼Œåƒ è§£å¼•ç”¨, Either(Result, Error), Unwrap, Borrow, Move, Ownership ç­‰æ¦‚å¿µåŠè§„åˆ™éœ€æ…¢æ…¢å»ç†Ÿæ‚‰ã€‚<br/><br/>
ä» AWS æ§åˆ¶å°çœ‹çœ‹ Lambda æ˜¯æ€ä¹ˆå¯¹ Rust æä¾›æ”¯æŒçš„ï¼Œåˆ›å»ºå‡½æ•°æ—¶ï¼ŒRuntimeÂ ä¸­å¯ä»¥é€‰æ‹©<br/><br/>
<table style="border-collapse: collapse; width: 100%;">
<tbody>
<tr>
<td style="width: 32.2526%;">
    {{< bundle-image src="aws-lambda-rust-1.png" width="273px" >}}
</td>
<td style="width: 28.2428%;">Amazon Linux 2023<br />
<span style="font-size: 10pt; color: #6b6666;">OS-only runtime for Go, Rust, C++, custom</span></td>
<td style="width: 28.3659%;">Amazon Linux 2<br />
<span style="color: #6b6666; font-size: 10pt;">OS-only runtime for Go, Rust, C++, custom</span></td>
</tr>
</tbody>
</table>
<br/>
OS æ–¹é¢å½“ç„¶æ˜¯è¦é€‰æ‹© Amazon Linux 2023 ä¼˜äº Amazon Linux 2ã€‚é€‰æ‹© Amazon Linux 2023 æˆ– Amazon Linux 2 æ—¶æœ€åè¿˜æœ‰ä¸€ä¸ª customï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥è‡ªä¹‰çš„å®šä¹‰è‡ªå·±çš„ Lambda è¿è¡Œæ—¶ï¼Œå¯é€‰æ‹©ä»»ä½•è¯­è¨€ï¼Œåªè¦ç¬¦åˆ AWS Lambda è°ƒç”¨çš„æ¥å£è§„èŒƒ <a href="https://docs.aws.amazon.com/lambda/latest/dg/runtimes-api.html">Using the Lambda runtime API for custom runtimes</a> å³å¯ã€‚ä¸è¿‡å®Œå…¨å®šä¹‰å—ï¼Œè¿˜æŒºç½—å—¦çš„ï¼Œç”¨å®˜æ–¹ç›´æ¥æ”¯æŒçš„è¯­è¨€å°±å®¹æ˜“å¤šäº†ã€‚<!--more--><br/><br/>
AWS å®˜æ–¹åˆ—å‡ºäº†è¯¦ç»†çš„æ–‡æ¡£ï¼Œåœ¨ <a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-rust.html">Building Lambda functions with Rust</a> é¡µé¢ä¸­ã€‚æœ¬æ–‡å°†å‚ç…§ <a href="https://github.com/aws/aws-lambda-rust-runtime">Rust Runtime for AWS Lambda</a> å®ç°ä¸€ä¸ªæœ€ç®€å•çš„ AWS Rule Lambdaã€‚æœ¬äººå·¥ä½œå¹³å°æ˜¯ Apple èŠ¯ç‰‡çš„ MacOSï¼ŒRust çš„ IDE å¯é€‰ç”¨ JetBrains çš„ RustRover, ä¸ªäººç”¨æˆ·å…è´¹ã€‚<br/><br/>
<h3>å‡†å¤‡æœ¬åœ°å¼€å‘ç¯å¢ƒ</h3>
é¦–å…ˆï¼Œç”µè„‘ä¸Šå…ˆè¦æœ‰ rustï¼Œç”¨å‘½ä»¤ <code>brew install rust</code> å®‰è£…ï¼Œå®Œåå°±æœ‰äº† rustc, cargo å‘½ä»¤ã€‚æˆ–è®¸ç”¨å¾—ç€ rustup, ç”¨ <code>brew install rustup</code> å®‰è£…ã€‚<br/><br/>
å®‰è£… cargo-lambda<br/>
<blockquote>
brew tap cargo-lambda/cargo-lambda
brew install cargo-lamda
</blockquote>

ä½†å®é™…åœ¨æ‰§è¡Œä¸Šé¢ç¬¬ä¸€æ¡å‘½ä»¤æ—¶å¡åœ¨ Tapping cargo-lambda/cargo-lambda, äºæ˜¯ç”¨ uv<br/>
<blockquote>
uv tool install cargo-lambda
</blockquote>

å®‰è£…æˆåŠŸåï¼Œç°åœ¨å°±æœ‰äº† cargo çš„ lambda å­å‘½ä»¤ï¼Œåç»­å¯ç”¨ cargo lambda æ¥åˆ›å»º Rust AWS Lambda é¡¹ç›®ï¼Œæ„å»ºï¼Œå’Œéƒ¨ç½²åˆ° AWS ä¸Šã€‚<br/><br/>
<h3>åˆ›å»º Rule Lambda é¡¹ç›®</h3>
cargo lambda new rust-lambda-demo æ–¹å¼åˆ›å»ºé¡¹ç›®æ—¶æœ‰è¿‡å¤šçš„é€‰é¡¹ï¼Œå¹¶ä¸”ç”Ÿæˆé¡¹ç›®å†…å®¹ä¸é‚£ä¹ˆå¹²å‡€ï¼Œå€’ä¸å¦‚ç”¨ cargo new ç”Ÿæˆä¸€ä¸ªæœ€ç®€å•çš„é¡¹ç›®ï¼Œæ…¢æ…¢ä¸°å¯Œç†è§£ã€‚<br/>
<blockquote>
cargo new rust-lambda-demo
</blockquote>

ç„¶åœ¨æŠŠç”Ÿæˆé¡¹ç›®çš„ src/main.rs çš„å†…å®¹ç”± Hello WorldÂ æ›¿æ¢ä¸º<br/>
{{< highlight rust >}}
use lambda_runtime::{service_fn, LambdaEvent, Error};
use serde_json::{json, Value};

#[tokio::main]
async fn main() -> Result<(), Error> {
    println!("main() function called");
    let func = service_fn(func);
    lambda_runtime::run(func).await?;
    Ok(())
}

async fn func(event: LambdaEvent<Value>) -> Result<Value, Error> {
    println!("func() function called");
    let (event, _context) = event.into_parts();
    let first_name = event["name"].as_str().unwrap_or("world");

    Ok(json!({ "message": format!("Hello, {}!", first_name) }))
}
{{</ highlight >}}

ä»¥ä¸Š main() æ˜¯åˆå§‹ Lambda å®ä¾‹æ—¶åªè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œéšåæ¯æ¬¡ Lambda è°ƒç”¨çš„å‡½æ•°æ˜¯ funcã€‚ä»åé¢éƒ¨ç½²åˆ° AWS, è°ƒç”¨è¯¥ Lambda åèƒ½çœ‹åˆ°åœ¨ CloudWatch ä¸Šçš„æ—¶åºæ˜¯<br/>
<blockquote>
INIT_START Runtime Version: provided:al2023.v117 Runtime Version ARN: arn:aws:lambda:us-east-1....
main() function called
START RequestId: 2ec17773-6bce-463d-b3d1-897b7592f840 Version: $LATEST
func() function called
END RequestId: 2ec17773-6bce-463d-b3d1-897b7592f840
REPORT RequestId: 2ec17773-6bce-463d-b3d1-897b7592f840 Duration: 1.23 ms Billed Duration: 25 m
START RequestId: 0a6d5501-a9f4-497c-8a84-8d7367d30a83 Version: $LATEST
func() function called
END RequestId: 0a6d5501-a9f4-497c-8a84-8d7367d30a83
......
</blockquote>

ç°åœ¨çš„é—®é¢˜å°±æ˜¯è¦è®©è¿™æ®µä»£ç é€šè¿‡ç¼–è¯‘ï¼Œæœ¬ç€ç¼ºä»€ä¹ˆè¡¥ä»€ä¹ˆçš„åŸåˆ™<br/><br/>
å®‰è£…å¿…è¦çš„ä¾èµ–<br/>
<blockquote>
cargo add lambda_runtime serde_json tokio
</blockquote>

<h3>æ„å»ºäºŒè¿›åˆ¶ä»£ç æ–‡ä»¶</h3>
æ¥ä¸‹æ¥å°±æ˜¯è¦æ„å»ºå®ƒï¼Œçœ‹åˆ°è¿™é‡Œçš„<br/><br/>
<blockquote>
#[tokio::main]
async fn main() -> Result<(), Error> {...}
</blockquote>

è™½ç„¶æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„ main å…¥å£æ–¹æ³•ï¼Œä½†ç›´æ¥æ‰§è¡Œæ—¶æ— æ³•åƒ func() å‡½æ•°ä¼ é€’å‚æ•°çš„ã€‚å…ˆç…§ç€æ–‡æ¡£ç”¨<br/>
<blockquote>
cargo lambda build --release
</blockquote>

æ„å»ºäºŒè¿›åˆ¶ä»£ç ï¼Œé»˜è®¤æ˜¯äº¤å‰ç¼–è¯‘ä¸º x86_64 å¹³å°çš„ä»£ç ã€‚ç¬¬ä¸€æ¬¡æ‰§è¡Œè¯¥å‘½ä»¤æ—¶ä¼šæç¤ºè¦å®‰è£… Zig å¿…é¡»ç»„ä»¶ï¼Œå¯é€‰æ‹©ç”¨ Homebrewã€‚<br/><br/>
æˆåŠŸç¼–è¯‘åç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶æ˜¯<br/>
<blockquote>
target/lambda/rust-lambda-demo/bootstrap
</blockquote>

å¦‚æœè¦ç¼–è¯‘æˆ ARM æ¶æ„ CPU çš„äºŒè¿›åˆ¶ä»£ç åˆ™ç”¨<br/>
<blockquote>
cargo lambda build --release --arm64
</blockquote>

å› ä¸ºæ˜¯ Linux å¹³å°çš„äºŒè¿›åˆ¶ä»£ç ï¼Œå½“ç„¶æ— æ³•åœ¨ MacOS ä¸‹æ‰§è¡Œï¼Œå³ä½¿æ”¾åˆ° Docker ä¸­ä¹Ÿæ— æ³•ç›´æ¥æ‰§è¡Œ<br/>
<blockquote>
docker run -it --platform linux/amd64 -v $(PWD):/vv ubuntu /vv/target/lambda/rust-lambda-demo/bootstrap
thread 'main' (1) panicked at /Users/yanbin/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/lambda_runtime-1.0.1/src/lib.rs:70:65:
Missing AWS_LAMBDA_FUNCTION_NAME env var: NotPresent
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
</blockquote>

ç¼ºä¹ç›¸åº”çš„ç¯å¢ƒ<br/><br/>
<h3>ç”¨ UnitTest æµ‹è¯• Lambda service_fn å‡½æ•°çš„è¡Œä¸º</h3>
ä½†æ˜¯åœ¨éƒ¨ç½²ä¹‹å‰å¯ä»¥ç”¨å•å…ƒæµ‹è¯•æ¥æ ¡éªŒè¯¥ Lambda çš„è¡Œä¸ºï¼Œç›´æ¥æµ‹è¯• service_fn å‡½æ•°çš„è¡Œä¸ºã€‚Rust ä¸­å•å…ƒæµ‹è¯•é€šå¸¸å†™åœ¨ä¸äº§å“ä»£ç ç›¸åŒçš„æ–‡ä»¶ä¸­ï¼Œç”¨ #[test] æ ‡æ³¨ï¼Œé›†æˆæµ‹è¯•æ‰å†™åœ¨ tests ç›®å½•ä¸­ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨ main.tf æ–‡ä»¶åå¤´åŠ ä¸Šå¦‚ä¸‹ä»£ç <br/>
{{< highlight rust >}}
#[tokio::test]
async fn test_func() {
    let input = serde_json::from_str(r#"{"name": "Yanbin"}"#).unwrap();
    let context = lambda_runtime::Context::default();

    let event = lambda_runtime::LambdaEvent::new(input, context);

    let lambda_result = func(event).await.unwrap();

    println!("{}", lambda_result)
}
{{</ highlight >}}

ç°åœ¨å¯ä»¥åœ¨ RustRover ä¸­é€‰æ‹© async fn test_func() å‡½æ•°æ¥æ‰§è¡Œï¼Œ<br/>
{{< bundle-image src="aws-lambda-rust-2.png" width="377px" >}}
ç›´æ¥æ‰§è¡Œè¾“å‡ºä¸º<br/>
<blockquote>
func() function called
{"message":"Hello, Yanbin!"}
</blockquote>

æˆ–è€…ç”¨<br/>
<blockquote>
cargo test -- --nocapture

running 1 test
func() function called
{"message":"Hello, Yanbin!"}
test test_func ... ok
</blockquote>

è¿™é‡Œç”¨å•å…ƒæµ‹è¯•åªæµ‹è¯• main() å‡½æ•°æ‰€è°ƒç”¨ service_fnÂ å‡½æ•°<br/><br/>
<h3>éƒ¨ç½² Rust AWS Lambda</h3>
å¯ç”¨ cargo lambda deploy å‘½ä»¤ï¼Œæˆ–ç”Ÿæˆ zipÂ åŒ…è‡ªè¡Œéƒ¨ç½²<br/><br/>
<h4>ç”¨ cargo lambda deployÂ å‘½ä»¤</h4>
<blockquote>
cargo lambda deploy rust-lambda-demo
</blockquote>

éƒ¨ç½²æˆåŠŸåè¾“å‡ºä¸º<br/>
<blockquote>
âœ… function deployed successfully ğŸ‰
ğŸ› ï¸ binary last compiled 2 minutes ago
ğŸ” arn: arn:aws:lambda:us-east-1:888888888888:function:rust-lambda-demo
ğŸ­ version: 1
</blockquote>

è¾“å‡ºäº†æ–°å»º LambdaÂ  çš„ ARNï¼Œå¹¶åˆ›å»ºäº† Lambda ç‰ˆæœ¬ 1<br/><br/>
å‡½æ•°åå¿…é¡»ä¸é¡¹ç›®åï¼Œæˆ–è€…è¯´ä¸ target/lambda/rust-lambda-demo/bootstrap ä¸­çš„ rust-lambda-demo ä¸€è‡´ï¼Œå¦åˆ™æç¤ºæ‰¾ä¸åˆ°äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ¯”å¦‚å°è¯•æŠŠ Lambda å‡½æ•°åæ”¹ä¸º my-rust-lambda-demoÂ å¾—åˆ°ä¸‹é¢çš„é”™è¯¯<br/>
<blockquote>
cargo lambda deploy my-rust-lambda-demo
Error: Ã— binary file for bootstrap not found, use `cargo lambda build` to create it
</blockquote>

è¯¥ AWS rust-lambda-demo å·²éƒ¨ç½²å¹¶èƒ½æ­£å¸¸å·¥ä½œï¼Œæˆ‘ä»¬åˆ° AWS æ§åˆ¶å°çœ‹ä¸‹ç”¨ cargo lambda deploy éƒ¨ç½²çš„ rust-lambda-demo é•¿ä»€ä¹ˆæ ·çš„ã€‚æˆ–è€…ç”¨ aws lambda get-functionÂ æŸ¥çœ‹<br/>
{{< highlight sh >}}
aws lambda get-function --function-name rust-lambda-demo
{
    "Configuration": {
        "FunctionName": "rust-lambda-demo",
        "FunctionArn": "arn:aws:lambda:us-east-1:888888888888:function:rust-lambda-demo",
        "Runtime": "provided.al2023",
        "Role": "arn:aws:iam::888888888888:role/cargo-lambda-role-904b9aa1-9e11-43cb-9ebd-73fe05d85dc3",
        "Handler": "bootstrap",
        "CodeSize": 10973933,
        "Description": "",
        "Timeout": 30,
        "MemorySize": 128,
        "LastModified": "2025-11-18T22:26:34.459+0000",
        "CodeSha256": "nV0VeY2HH+vpX8SqHZiqhC6+BMT6FsWCyqbgHzDkLxU=",
        "Version": "$LATEST",
        "TracingConfig": {
            "Mode": "PassThrough"
        },
        "RevisionId": "14112e95-0ec2-441f-86eb-3bd260c428bd",
        "State": "Active",
        "LastUpdateStatus": "Successful",
        "PackageType": "Zip",
        "Architectures": [
            "x86_64"
        ],
        "EphemeralStorage": {
            "Size": 512
        },
        "SnapStart": {
            "ApplyOn": "None",
            "OptimizationStatus": "Off"
        },
        "RuntimeVersionConfig": {
            "RuntimeVersionArn": "arn:aws:lambda:us-east-1::runtime:b05edb8ee2d750d3d6c1c858c7d73f338fc72e15c1a64f4440827804eaafc4b4"
        },
        "LoggingConfig": {
            "LogFormat": "Text",
            "LogGroup": "/aws/lambda/rust-lambda-demo"
        }
    },
    "Code": {
        "RepositoryType": "S3",
        "Location": "https://prod-04-2014-tasks.s3.us-east-1.amazonaws.com/snapshots/069762108088/rust-lambda-demo-082ca...00478"
    }
}
{{</ highlight >}}

ä»ä¸­çœ‹å‡º cargo lambda deploy å¸®æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª runtime ä¸º provided.al2023, handler æ˜¯ bootstrapåˆ›å»º IAM role, å†…å­˜ä¸º 128Mï¼ŒTimeout ä¸º 30 ç§’ï¼Œæ¶æ„ä¸º x86_64ï¼Œå¹¶ä¸”ç»ç”±æŸä¸ª s3 bucket ä»¥ zip åŒ…æ–¹å¼è¿›è¡Œéƒ¨ç½²çš„ã€‚<br/><br/>
ç”¨å‘½ä»¤ <code>cargo lambda deploy --help</code> å¯æŸ¥çœ‹è¯¦ç»†éƒ¨ç½²é…ç½®ã€‚<br/><br/>
åœ¨ Code source ä¸­çœ‹åˆ°çš„å°±æ˜¯é‚£ä¸ªäºŒåˆ¶ bootstrap æ–‡ä»¶ï¼Œå½“ç„¶æ˜¯æ— æ³•ç¼–è¾‘çš„<br/>
{{< bundle-image src="aws-lambda-rust-3-800x463.png" width="667px" >}}
<h4>ç”Ÿæˆ zipÂ ç„¶åè‡ªä¸»éƒ¨ç½²</h4>
<blockquote>
cargo lambda build --release --output-format zip
</blockquote>

è¿™æ ·å°±ä¼šç”Ÿæˆã€€target/lambda/rust-lambda-demo/bootstrap.zipÂ æ–‡ä»¶<br/>
{{< highlight sh >}}
ls -lh target/lambda/rust-lambda-demo
total 77024
-rwxr-xr-x@ 1 yanbin  staff    37M Nov 18 16:24 bootstrap
-rw-r--r--@ 1 yanbin  staff   570K Nov 18 16:58 bootstrap.zip
{{</ highlight >}}

é¡ºä¾¿çœ‹ä¸€ä¸‹ç”Ÿæˆæ–‡ä»¶çš„ä½“ç§¯<br/><br/>
æœ‰äº†è¿™ä¸ª bootstrap.zip ä¹‹åå¯é€‰æ‹©è‡ªå·±å–œçˆ±çš„å·¥å…·è¿›è¡Œéƒ¨ç½²ï¼Œå¦‚ aws lambda create-function, æˆ– CloudFormation, æˆ– Terraform è„šæœ¬ï¼Œå…³é”®å°±æ˜¯è¦é€‰æ‹© runtime ä¸º provided.al2023, handler ä¸º bootstrap, å…¶ä»–çš„å¦‚ç¯å¢ƒå˜é‡ï¼Œå†…å­˜ï¼Œè¶…æ—¶ç­‰é…ç½®ï¼Œæˆ–åˆ›å»ºä»€ä¹ˆæ ·çš„ IAM å°±è‡ªè¡Œå†³å®šäº†ã€‚<br/><br/>
<h3>æµ‹è¯• Rust LambdaÂ å‡½æ•°</h3>
å¯ç”¨ cargo lambda invoke æˆ– aws cli å‘½ä»¤è¿›è¡Œæµ‹è¯•<br/>
<blockquote>
cargo lambda invoke --remote --data-ascii '{"name": "Yanbin"}' --output-format json rust-lambda-demo
{
Â  Â  "message": "Hello, Yanbin!"
}
</blockquote>

æˆ–è€…ç”¨ã€€aws cli -- ä¸ç”¨ç†ä¼š Lambda ç»“æœåçš„ StatusCode ç­‰å†…å®¹<br/>
<blockquote>
aws lambda invoke --function-name rust-lambda-demo --cli-binary-format raw-in-base64-out --payload '{"name": "Yanbin"}' /dev/stdout
{"message":"Hello, Yanbin!"}
Â  Â  "StatusCode": 200,
Â  Â  "ExecutedVersion": "$LATEST"
}
</blockquote>

è¯¥ rust-lambda-demo è°ƒç”¨è¿‡å‡ æ¬¡åï¼Œçœ‹åˆ° CloudWatchÂ ä¸­çš„æ—¥å¿—<br/>
{{< bundle-image src="aws-lambda-rust-4-800x415.png" width="773px" >}}
è¿™é‡Œæ˜¯ä¸ºäº†éªŒè¯ä»£ç ä¸­ main() ä¸ func() å‡½æ•°ä¹‹é—´çš„å…³ç³»ï¼Œmain() ç›¸å½“äºæ˜¯å¯åŠ¨æœåŠ¡çš„å‡½æ•°ï¼Œåªæ‰§è¡Œä¸€æ¬¡ï¼Œè€Œåæ¯æ¬¡ Lambda è¯·æ±‚åªè°ƒç”¨ func() å‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ main() ä¸­ä½œä¸€äº›åˆå§‹åŒ–æ“ä½œï¼Œé‚£è¦æ˜¯æˆ‘ä»¬æ²¡ä»€ä¹ˆå¯åˆå§‹åŒ–çš„è¯ï¼Œæ˜¯ä¸æ˜¯å°±å¯çœç•¥ main() å‡½æ•°å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ä¸è¡Œï¼Œæ²¡æœ‰ main() å‡½æ•°æ— æ³•æ„å»ºã€‚<br/><br/>
<h3>ä»¥æœ¬åœ° ServerÂ å½¢å¼æµ‹è¯•</h3>
é™¤äº†å•å…ƒæµ‹è¯•çš„æ–¹å¼ï¼Œè¿˜èƒ½åƒ Python çš„ AWS Lambda Docker é•œåƒæµ‹è¯• http://localhost:8080/2015-03-31/functions/function/invocations é‚£æ ·æµ‹è¯• Rust å†™çš„ AWS Lambdaã€‚æ­¤ç§æ–¹å¼é€‚ç”¨äº Windows, Linux å’Œ MacOSÂ  å¹³å°ã€‚é¦–å…ˆå¯åŠ¨æœ¬åœ° Serverï¼Œåœ¨é¡¹ç›®æ‰€åœ¨ç›®å½•è¿è¡Œ<br/>
<blockquote>
cargo lambda watch
</blockquote>

{{< bundle-image src="aws-lambda-rust-6-800x670.png" width="721px" >}}

åœ¨æœ¬åœ° 9000 ç«¯å£å¯åŠ¨äº†æœåŠ¡ï¼Œä»¥ä¸Šæ˜¯è¿›è¡Œäº†å‡ æ¬¡è°ƒç”¨ï¼Œç„¶åè¿‡ä¸€å°æ®µæ—¶é—´çš„æ§åˆ¶å°æ˜¾ç¤ºã€‚<br/><br/>
å½“å¯åŠ¨åï¼Œé©¬ä¸Šä¼šæ‰§è¡Œ main() å‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰æ”¶åˆ°è¯·æ±‚çš„è¯ï¼Œmain() å‡½æ•°æ¯éš”å¤§æ¦‚å‡ ç§’åˆ°åˆä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œæ‰€ä»¥ä¼šæŒç»­è¾“å‡º main(), main(), main()ã€‚å¦‚æœæœ‰è°ƒç”¨çš„è¯ï¼Œåªæ‰§è¡Œ func() å‡½æ•°æ¥å¤„ç†è¯·æ±‚ã€‚<br/><br/>
æµ‹è¯• cargo lambda watchÂ å¯åŠ¨çš„æœåŠ¡<br/>
<blockquote>
cargo lambda invoke rust-lambda-demo --data-ascii '{ "name": "Yanbin" }'
{"message":"Hello, Yanbin!"}
</blockquote>

æ¯æ‰§è¡Œä¸€æ¬¡ï¼Œåœ¨ cargo lambda watch æ‰€åœ¨æ§åˆ¶å°å°±ä¼šè¾“å‡ºä¸€æ¬¡ func() function called<br/><br/>
å¦‚æœåé¢å¾ˆä¹…åˆæ²¡è°ƒç”¨äº†åˆæ¯éš”ä¸€æ®µæ—¶é—´åœ¨æ§åˆ¶å°è¾“å‡º main() function calledã€‚<br/><br/>
è¿™æ—¶å€™ä¿®æ”¹ä»£ç ï¼Œcargo lambda watch ä¼šé©¬ä¸Šé‡ç¼–è¯‘é‡æ–°åŠ è½½ï¼Œè¿™å°±æ˜¯ watchÂ  çš„åŠŸç”¨ï¼Œä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæ€»æœ‰ main() function calledÂ è¾“å‡ºçš„åŸå› ã€‚<br/><br/>
å¦‚æœç”¨ curl æ¥æµ‹è¯•çš„è¯ï¼Œç±»ä¼¼çš„<br/>
<blockquote>
curl http://127.0.0.1:9000/lambda-url/rust-lambda-demo/ \<br />
-H 'content-type: application/json' -d '{ "name": "Yanbin" }'
</blockquote>

ä½†ä¸Šé¢çš„ä»£ç åªä¼šæ”¶åˆ°å“åº”<br/>
<blockquote>
{"type":"https://httpstatuses.com/500","status":500,"title":"Internal Server Error"}
</blockquote>

å› ä¸ºåœ¨ç”¨ curl æµ‹è¯•æ—¶å®ç°ä»£ç å°±è¦ä½œç›¸åº”çš„ä¿®æ”¹ï¼Œä» HTTP æ¥æ”¶åˆ°çš„æ•°æ®å°±ä¸å†åœ¨<br/>
<blockquote>
let event: Value = {"name": "Yanbin"}
</blockquote>
<br/>
è¿™ä¹ˆç®€å•ï¼Œè€Œæ˜¯å˜æˆäº†<br/>
<blockquote>
{"authorizationToken":null,"body":"{ \"name\": \"yanbin\" }","headers":{"accept":"*/*","content-length":"20","content-type":"application/json","host":"127.0.0.1:9000","lambda-runtime-aws-request-id":"701a2d6a-678a-47e3-af1a-4939e353a54e","user-agent":"curl/8.7.1"},"httpMethod":"GET","identitySource":null,"isBase64Encoded":false,"methodArn":null,"rawPath":"/","rawQueryString":null,"requestContext":{"accountId":null,"apiId":null,"domainName":"localhost","domainPrefix":"rust-lambda-demo","http":{"method":"POST","path":"/","protocol":"http","sourceIp":"127.0.0.1","userAgent":"cargo-lambda"},"requestId":"701a2d6a-678a-47e3-af1a-4939e353a54e","routeKey":"$default","stage":"$default","time":"19/Nov/2025:02:33:19 +0000","timeEpoch":1763519599},"resource":null,"routeKey":"$default","stageVariables":{},"type":null,"version":"2.0"}
</blockquote>

è¦æƒ³å¥½å¥½çš„å¤„ç†è¯¥è¯·æ±‚å¹¶ç”Ÿæˆ HTTP å“åº”ï¼Œæ•´ä¸ª Lambda è¦ç”¨ lambda_http é‡å†™ï¼Œæœ€åçš„ä»£ç <br/>
{{< highlight rust >}}
use lambda_http::{service_fn, Error, Request, Response};
use serde_json::{Value};

#[tokio::main]
async fn main() -> Result<(), Error> {
    let func = service_fn(func);
    println!("main() function called");
    lambda_http::run(func).await?;
    Ok(())
}

async fn func(event: Request) -> Result<Response<String>, Error> {
    println!("func() function called");

    let body: Value = serde_json::from_slice(event.body())?;
    let name = body["name"].as_str().unwrap_or("world");

    Ok(Response::builder()
        .status(200)
        .header("content-type", "text/plain")
        .body(format!("Hello, {}!", name).to_string())?
    )
}
{{</ highlight >}}

å¦‚æ­¤ curlÂ å‘½ä»¤å°±èƒ½å·¥ä½œäº†<br/>
<blockquote>
curl http://127.0.0.1:9000/lambda-url/rust-lambda-demo/
-H 'content-type: application/json' -d '{ "name": "Yanbin" }'
Hello, Yanbin!
</blockquote>
<br/
å¥½åƒæ²¡æœ‰ Python å†™çš„ API Gateway å“åº”æ•°æ®é‚£ä¹ˆçµæ´»ï¼Œå¦‚æœå†™æˆä¸‹é¢çš„è¿”å›æ˜¯æ²¡ç”¨çš„<br/>
{{< highlight rust >}}
Ok(json!({
     "statusCode": 200,
     "headers":{
         "Content-Type": "text/plain"
     },
     "body": "hello"
 }))

{{</ highlight >}}
<br/>
<h3>æœ¬åœ° Runtime Interface Emulator(RIE) æµ‹è¯•</h3>
<a href="/aws-lambda-rust-runtime">Rust Runtime for AWS Lambda</a> ä¸­æåˆ°çš„æœ€åä¸€ç§æµ‹è¯•æ–¹æ³•ï¼Œæ˜¯ç”¨ RIEï¼Œä½†æ²¡æœ‰å…·ä½“è®²è§£, ä¹Ÿæ˜¯è‰è‰äº†äº‹ï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿä¸ä½œå®è·µã€‚åœ¨ <a href="https://yanbin.blog/build-aws-lambda-python-docker-image/">æ„å»º AWS Lambda Python Docker é•œåƒ</a> ä¸­æœ‰è®²åˆ°ç”¨ RIE çš„æ–¹å¼å¯åŠ¨ AWS Lambda<br/>
<blockquote>
/usr/local/bin/aws-lambda-rie /var/runtime/bootstrap
</blockquote>

Rust AWS Lambda ä¼°è®¡ä¹Ÿç±»ä¼¼ï¼Œå…¶ä¸­æåˆ°çš„<br/>
<blockquote>
make test-rie EXAMPLE=http-basic-lambda
</blockquote>

æ ¹æœ¬æ²¡è®²åˆ°ä¸€ä¸ªæ¥ç”±ï¼Œtest-rie æ¥è‡ªä½•å¤„ï¼Œä¹Ÿæ²¡è§å“ªæœ‰ makefileï¼Œå¤§è‡´æ˜¯ç”±å®ƒç”Ÿæˆ Linux é•œåƒï¼Œç„¶ååœ¨å®¹å™¨çš„ 9000 ç«¯å£ä¸Šå¯åŠ¨ RIE æœåŠ¡ï¼Œå†ä½œæµ‹è¯•.<br/>
<h3>æ€»ç»“</h3>
å…³äºç”¨ Rust å¦‚ä½•å†™ AWS Lambda åŸºæœ¬å†…å®¹å°±è¿™äº›äº†ï¼Œå…¶ä»–çš„ä¸€äº›ä¸»é¢˜è¿˜åŒ…æ‹¬ä¸åŒçš„ AWS event å¯¹è±¡ï¼Œç”¨åˆ°çš„ä¾èµ–æ˜¯ <a href="https://crates.io/crates/aws_lambda_events">aws_lambda_events</a>ã€‚åˆ«çš„ä¾èµ– lambda-extension, lambda-events, lambda-runtime-api-client, å®ƒä»¬éƒ½å¯ç”¨ cargo add å®‰è£…ã€‚<br/><br/>
è¿˜æœ‰ Tracing å’Œ Logging çš„ä¸»é¢˜ï¼Œä»¥åŠå¦‚ä½•å¤„ç† Lambda é”™è¯¯ã€‚<br/><br/>
AWS Lambda è¦æ±‚çš„æœ€å° Rust ç‰ˆæœ¬æ˜¯ 1.82.0ã€‚<br/><br/>
å‚è€ƒï¼š<br/><br/>
<ol>
    <li><a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-rust.html">Building Lambda functions with Rust</a></li>
</ol>
