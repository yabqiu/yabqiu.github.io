---
title: Backbone.js 使用模板
url: /backbone-js-use-template/
date: 2014-01-05T17:43:53-06:00
featured: false
thumbnail: "../images/logos/backbonejs-logo.png"
draft: false
toc: false
# menu: main
usePageBundles: true
categories:
  - Web/JS
tags: 
  - javascript
  - Backbone
  - Underscore
comment: true
codeMaxLines: 50
# additional
wpPostId: 5982 
wpStatus: publish
views: 6176
lastmod: 2021-05-05T15:54:12-05:00
---

前面一篇 <a title="Backbone.js HelloWorld，应用起步" href="/backbone-get-started/" target="_blank" rel="noopener">Backbone.js HelloWorld，应用起步</a> 只是让 Backbone 跑起来，实际的应用中会使用到模板，Model 等，而模板又是进阶的基础。所以这里介绍在 View 中使用模板，以及如何向模板填充值，模板可以用字符串，或是用 <span style="color: #800000;">&lt;script type="text/template"&gt;</span> 声明的内容。使用 <span style="color: #800000;">&lt;%= %&gt;</span> 或 <span style="color: #800000;">&lt;%- %&gt;</span> 来声明变量输出的占位符。</p>
<br/>
Backbone 的模板要用到的是 <a title="userscorejs" href="http://underscorejs.org" target="_blank" rel="noopener">underscore.js</a> 库, 要深入了解 Unserscore 就看官方的 <a href="http://documentcloud.github.io/underscore/" target="_blank" rel="noopener">Underscore.js 的文档</a>，Underscore 的 template 方法的原型如下：<br/>
<blockquote>
_.template(templateString, [data], [settings])
</blockquote>
<!--more-->
下面是些完整的例子<br/>
<h3><span style="color: #000080;"><strong>一: 使用字符串模板</strong></span></h3>
{{< highlight html >}}
<!DOCTYPE html>
<html>
     <head>
         <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
         <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js"></script>
         <script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.0.0/backbone-min.js"></script>
     </head>
     <body>
         <div id="container">Loading...</div>
     </body>
 </html>
 
 <script>
    var AppView = Backbone.View.extend({
        el: '#container',
        template: _.template("<h3>Hello <%= who %></h3>"),
        //上行可写成 template: _.template("<h3>Hello <%- who %></h3>", {who: 'World!'}), // :1
        initialize: function(options) {
            this.render();
        },
        render: function() {
            this.$el.html(this.template({who: 'World!'}));
            //前面开启的是 :1 标识的代码，这里就写成 this.$el.html(this.template);
        }
    });

    setTimeout(function(){
        var appView = new AppView();
    }, 1000);
</script>
{{</ highlight >}}
<br/>
为突出效果，把 <span style="color: #800000;">new AppView()</span> 放到了 <span style="color: #800000;">setTimeout()</span> 延迟执行，项目中没必要这么做。<br/><br/>
点击 <a href="http://fiddle.jshell.net/Unmi/A7MK7/" target="_blank" rel="noopener">http://fiddle.jshell.net/Unmi/A7MK7/</a> 看上面代码执行的效果，可以看到 Loading ... 在 1 秒后被替换成了 Hello World!<br/><br/>
另外，如果前面声明 View 时没有对 el 赋值，可以在实例化 AppView 时指定 <code>el</code> 属性，像下面那样使用<br/>
<blockquote>
new AppView({el: $("#container")})
</blockquote>

<h3><strong><span style="color: #000080;">二. 加载模板</span></strong></h3>
可以加载页面中用 <span style="color: #800000;">&lt;script type="text/template"&gt;</span> 包含的内容作为模板，它本身不会在页面中显示 出来的。下面是用 jQuery 的选择器来定位这个模板声明，html() 取出其中的内容。完整代码如下：<br/><br/>
{{< highlight html >}}
<!DOCTYPE html>
<html>
     <head>
         <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
         <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js"></script>
         <script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.0.0/backbone-min.js"></script>
     </head>
     <body>
         <div id="container">Loading...</div>

         <script type="text/template" id="who_template">
            <h3>Hello <%= who %></h3>
        </script>
     </body>
 </html>
 
 <script>
    var AppView = Backbone.View.extend({
        el: '#container',
        initialize: function(options) {
            this.render();
        },
        render: function() {
            var template = _.template($("#who_template").html());
            this.$el.html(template({who: 'Backbone!'}));
        }
    });

    setTimeout(function(){
        var appView = new AppView();
    }, 1000);
</script>
{{</ highlight >}}
<br/>
点击 <a href="http://fiddle.jshell.net/Unmi/2q6jJ/" target="_blank" rel="noopener">http://fiddle.jshell.net/Unmi/2q6jJ/</a> 看执行效果，页面在一秒钟后显示 <span style="color: #800000;">Hello Backbone!</span><br/><br/>
注意，你不能直接加载页面中声明的其他元素，例如定义的<br/>
{{< highlight html >}}
<div id="who_template" style="display:none">
    <h3>Hello <%= who %></h3>
</div>
{{</ highlight >}}
<br/>
如果直接用 <span style="color: #800000;">_template($("#who_template").html()</span> 的话，执行后显示的就是 <span style="color: #800000;">Hello &lt;%= who %&gt;</span>。也就是说其中的变量值不会被解析，如果你的模板中无需填充值是可以这么做，但还需用 <span style="color: #800000;">display:none</span> 来隐藏掉它。<br/><br/>
点击 <a href="http://fiddle.jshell.net/Unmi/4Rnzs/" target="_blank" rel="noopener">http://fiddle.jshell.net/Unmi/4Rnzs/</a> 看看加载普通页面元素执行的效果。<br/><br/>
我们还能直接在自定义 View 中使用 events 属性来定义事件，接下来我们去体验。<br/><br/>
参考： <a href="http://backbonetutorials.com/what-is-a-view/" target="_blank" rel="noopener">What is a view?</a>
