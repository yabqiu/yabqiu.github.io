---
title: Vue.js 项目使用  vue-prism-editor 语法高亮与编辑器
url: /vue-js-vue-prism-editor/
date: 2020-08-06T02:32:25-05:00
featured: false
draft: false
type: post
toc: false
# menu: main
usePageBundles: true
thumbnail: "../images/logos/https://yanbin.blog/wp-content/uploads/2020/07/vue_logo.png"
categories:
  - Vue.js
tags: 
  - Vue
comment: true
codeMaxLines: 50
# additional
wpPostId: 10461 
wpStatus: publish
views: 3594
lastmod: 2020-08-06T03:28:16-05:00
---

记录一下在 Vue.js 项目中使用 vue-prism-editor 进行语法高亮显示代码，并兼具代码编辑功能。JavaScript 中有几个比较典型的语法高亮显示的代码库，例如 <a href="http://shjs.sourceforge.net/">SHJS</a>, <a href="http://alexgorbatchev.com/SyntaxHighlighter/">SyntaxHighlighter</a>, <a href="https://craig.is/making/rainbows">Rainbow</a>,   <a href="https://highlightjs.org/">highlight.js</a>。本博客曾经使用过 SyntaxHighlighter 来显示日志中的示例代码，现今所采用的是基于 PHP 的 <a href="https://github.com/aramk/crayon-syntax-highlighter">Crayon Syntax Highlighter</a>。除了只为了高亮显示代码外，有时候还需处理在线编辑代码，许多年前试用过 <a href="https://codemirror.net/">CodeMirror</a>, 而今天要上手 <a href="http://prismjs.com/">Prism.js</a> 也能够支持代码编辑。 <br/><br/>
官方 Demo: <a href="https://prism-editor.netlify.com/">prism-editor.netlify.com</a><br />
Codesandbox:  <a href="https://codesandbox.io/s/61yrlnlnmn">https://codesandbox.io/s/61yrlnlnmn</a>。<br/><br/>
为了给 Vue.js 项目提供方便，有人专门做了一个 Vue.js 的插件 <a href="https://github.com/koca/vue-prism-editor">vue-prism-editor</a>，本文直接使用该插件，而非直接使用 Prism.js。并且项目蓝本用 <code>@vue/cli 4.4.6</code> 的命令<br/><br/>
<blockquote>
$ vue create vue-prism-editor-demo
</blockquote>
<br/>
创建的，创建过程可参考 <a href="https://yanbin.blog/flask-vue-js-integration-dev-deploy/#create-vue-project">Flask 和 Vue.js 开发及整合部署实例</a> 的 <strong>创建 Vue 项目</strong>一节，此文简单些，就只选择 <code>default (babel, eslint)</code> 默认项来创建<!--more--><br/><br/>
完后启动服务<br/><br/>
<blockquote>
$ cd vue-prism-editor-demo<br />
$ npm run serve
</blockquote>
<br/>
现在可访问 http://localhost:8080 来到了 Vue.js 的欢迎页面，接下来要应用 HelloWorld 页面来高亮显示代码。<br/><br/>
先要安装 vue-prism-editor, 命令如下<br/><br/>
<blockquote>
$ npm install --save vue-prism-editor            # 会连带安装 vue-prism-editor 的 css<br />
$ npm install --save prismjs                             # 上一步并不会安装 prismjs, 所以需手动安装它，它也会同时安装 css
</blockquote>
<br/>
用 <code>yarn</code> 的话是 <code>yarn add vue-prism-editor</code>。<code>npm install</code> 时候需要 <code>--save 或 -S</code>，它会在 <code>package.json</code> 中的 <code>dependencies</code> 块中加上行<br/><br/>
<blockquote>
"vue-prism-editor": "^0.6.1", <br />
"prismjs": "^1.20.0"
</blockquote>
<br/>
接下来只要对 <code>App.vue</code> 进行改造， <code>App.vue</code> 的完整内容如下：<br/><br/>
<pre class="lang:default decode:true">&lt;template&gt;
  &lt;div id="app"&gt;
    &lt;prism-editor v-model="code" language="js" lineNumbers&gt;&lt;/prism-editor&gt;
  &lt;/div&gt;
&lt;/template&gt;<br/><br/>
&lt;script&gt;
import VuePrismEditor from 'vue-prism-editor';
import 'vue-prism-editor/dist/VuePrismEditor.css';
import 'prismjs';
import 'prismjs/themes/prism.css';
import Vue from 'vue';<br/><br/>
Vue.component('prism-editor', VuePrismEditor);<br/><br/>
export default {
  data() {
    return {
      code:
`fetch('http://example.com/movies.json')
  .then(response =&gt; response.json())
  .then(data =&gt; console.log(data));
`,
    };
  },
};
&lt;/script&gt;</pre>
<br/>
保存后，http://localhost:8080 自动刷新，现在看到的页面为<br/><br/>
<a href="https://yanbin.blog/wp-content/uploads/2020/08/vue-prism-editor-4.png"><img class="aligncenter wp-image-10471" src="https://yanbin.blog/wp-content/uploads/2020/08/vue-prism-editor-4-800x359.png" alt="" width="595" height="267" /></a><br/><br/>
最后一行是直接在页面中输入的，证明那确实是一个 Editor, 是可编辑的，而且对于新输入内容也能进行实时的高亮显示。<br/><br/>
vue-prism-editor 除了可编辑，语法加亮外，还有 Undo/Redo，大小自动调整，行号显示等。<br/><br/>
我们可以切换显示主题，到底 prism 支持什么主题呢？查看 <code>node_modules/prismjs/thems</code> 目录下的文件<br/><br/>
<blockquote>
$ ls node_modules/prismjs/themes | sort<br />
prism-coy.css<br />
prism-dark.css<br />
prism-funky.css<br />
prism-okaidia.css<br />
prism-solarizedlight.css<br />
prism-tomorrow.css<br />
prism-twilight.css<br />
prism.css
</blockquote>
<br/>
于是我们可以把 <code>App.vue</code> 中的行<br/><br/>
<pre class="lang:default decode:true">import 'prismjs/themes/prism.css';</pre>
<br/>
改为上面列出的任一个主题样式，比如<br/><br/>
<pre class="lang:default decode:true ">import 'prismjs/themes/prism-twilight.css';</pre>
<br/>
页面自动刷新，注意这时候要改用 Safari 之外的浏览器了, 反正 Safari 我测试是不支持样式的选择，换成 Chrome<br/><br/>
<a href="https://yanbin.blog/wp-content/uploads/2020/08/vue-prism-editor-5.png"><img class="aligncenter wp-image-10472" src="https://yanbin.blog/wp-content/uploads/2020/08/vue-prism-editor-5-800x307.png" alt="" width="597" height="229" /></a><br/><br/>
如果要支持别的语言，可对 &lt;prism-editor&gt; 标签的 language 属性指定别的，如 java, json 等，查找当前  prism 支持哪些语言可用命令<br/><br/>
<blockquote>
ls node_modules/prismjs/components | grep 'min' | sort
</blockquote>
<br/>
列出，比如要支持 java，需先 import<br/><br/>
<pre class="lang:default decode:true ">import 'prismjs/components/prism-java';</pre>
<br/>
然后<br/><br/>
<pre class="lang:default decode:true  ">&lt;prism-editor language="java&gt;&lt;/prism-editor&gt;</pre>
<br/>
使用中发现的几个问题：<br/><br/>
<ol>
    <li>对 Safari 的支持较差，Safari 下初始时可高亮显示代码，但编辑代码时不能实时着色，并且不能切换主题</li>
    <li>如果不是用 <code>v-model="code"</code> 的方式，而是  <code>:code="code"</code>, 在 Chrome 下编辑时也不能实时着色</li>
    <li>显示大段代码时有问题，我测试的问题代码是 23M, 试图显示一个超大的 JSON 字符串，出现问题为<br />
<pre class="lang:default decode:true">vue.runtime.esm.js?2b0e:619 [Vue warn]: Error in render: "RangeError: Maximum call stack size exceeded"<br/><br/>
found in<br/><br/>
---&gt; &lt;PrismEditor&gt;
       &lt;S3File&gt; at src/views/S3File.vue
         &lt;App&gt; at src/App.vue
           &lt;Root&gt;<br/><br/>
vue.runtime.esm.js?2b0e:1888 RangeError: Maximum call stack size exceeded
    at normalizeArrayChildren (vue.runtime.esm.js?2b0e:2384)
    at normalizeChildren (vue.runtime.esm.js?2b0e:2359)
    at _createElement (vue.runtime.esm.js?2b0e:3400)
    at createElement (vue.runtime.esm.js?2b0e:3353)
    at vm._c (vue.runtime.esm.js?2b0e:3491)
    at Proxy.render (VuePrismEditor.common.js?431a:2291)
    at VueComponent.Vue._render (vue.runtime.esm.js?2b0e:3548)
    at VueComponent.updateComponent (vue.runtime.esm.js?2b0e:4066)
    at Watcher.get (vue.runtime.esm.js?2b0e:4479)
    at Watcher.run (vue.runtime.esm.js?2b0e:4554)</pre>
这有点狠了，但目前还没有发现在超大内容时如何禁止语法高亮，所以加了个条件，凡是超过 5 M的字符串改用 textarea 来展示。
</li>
</ol>
<br/>
其他的 vue-prism-editor 相关的属性就只照抄官网了<br/><br/>
属性<br/><br/>
<table style="width: 88.591%;">
<thead>
<tr>
<th style="width: 15.5125%;">属性名</th>
<th style="width: 7.57156%;">类型</th>
<th style="width: 5.81717%;">默认值</th>
<th style="width: 27.5162%;">Options</th>
<th style="width: 42.2899%;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="width: 15.5125%;">v-model</td>
<td style="width: 7.57156%;"><code>string</code></td>
<td style="width: 5.81717%;">-</td>
<td style="width: 27.5162%;">-</td>
<td style="width: 42.2899%;">设置要显示的代码，编辑时能实时着色</td>
</tr>
<tr>
<td style="width: 15.5125%;">code</td>
<td style="width: 7.57156%;"><code>string</code></td>
<td style="width: 5.81717%;"><code>""</code></td>
<td style="width: 27.5162%;">-</td>
<td style="width: 42.2899%;">要显示的代码，但编辑时不能实时着色</td>
</tr>
<tr>
<td style="width: 15.5125%;">language</td>
<td style="width: 7.57156%;"><code>String</code></td>
<td style="width: 5.81717%;"><code>"js"</code></td>
<td style="width: 27.5162%;"><code>vue,html,md,ts</code> + Prismjs Languages</td>
<td style="width: 42.2899%;"><code>ls node_modules/prismjs/components | grep 'min' | sort | wc -l</code> 查到能支持 210 种语言</td>
</tr>
<tr>
<td style="width: 15.5125%;">lineNumbers</td>
<td style="width: 7.57156%;"><code>Boolean</code></td>
<td style="width: 5.81717%;"><code>false</code></td>
<td style="width: 27.5162%;">-</td>
<td style="width: 42.2899%;">是否显示行号</td>
</tr>
<tr>
<td style="width: 15.5125%;">readonly</td>
<td style="width: 7.57156%;"><code>Boolean</code></td>
<td style="width: 5.81717%;"><code>false</code></td>
<td style="width: 27.5162%;">-</td>
<td style="width: 42.2899%;">是否只读</td>
</tr>
<tr>
<td style="width: 15.5125%;">emitEvents</td>
<td style="width: 7.57156%;"><code>Boolean</code></td>
<td style="width: 5.81717%;"><code>false</code></td>
<td style="width: 27.5162%;">-</td>
<td style="width: 42.2899%;">是否能触发事件</td>
</tr>
<tr>
<td style="width: 15.5125%;">autoStyleLineNumbers</td>
<td style="width: 7.57156%;"><code>Boolean</code></td>
<td style="width: 5.81717%;"><code>true</code></td>
<td style="width: 27.5162%;">-</td>
<td style="width: 42.2899%;">允许组件来设置行号的样式风格(不太明白)</td>
</tr>
</tbody>
</table>
<br/>
事件<br/><br/>
<table>
<thead>
<tr>
<th>Name</th>
<th>Parameters</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>change</td>
<td><code>(code)</code></td>
<td>当代码内容改变时触发</td>
</tr>
</tbody>
</table>
<br/>
以下事件只有在 <code>emitEvents</code> 属性设置为 <code>true</code> 才会被触发<br/><br/>
<table>
<thead>
<tr>
<th>Name</th>
<th>Parameters</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>keydown</td>
<td><code>(event)</code></td>
<td>在编辑器中按下键时触发</td>
</tr>
<tr>
<td>keyup</td>
<td><code>(event)</code></td>
<td>在编辑器中按键放开时触发</td>
</tr>
<tr>
<td>editor-click</td>
<td><code>(event)</code></td>
<td>在可编辑时点击即触发</td>
</tr>
</tbody>
</table>
