---
title: VC窗口程序中出现中文乱码的解决
url: /vc-cannot-show-chinese/
date: 2007-06-20T13:00:00-05:00
featured: false
draft: true
toc: false
# menu: main
usePageBundles: true
thumbnail: "../images/logos/https://yanbin.blog/wp-content/uploads/2006/05/cpp-logo.png"
categories:
  - C++/VB
tags: 
  - VC
comment: true
codeMaxLines: 50
# additional
wpPostId: 512 
wpStatus: publish
views: 2189
lastmod: 2019-11-13T21:58:47-06:00
---

用 VC6 的 MFC AppWizard 生成的窗口程序，窗口标题或者标签用中文，编译执行发现中文成乱码了，奇怪，以前怎么没有出现这种问题呢？<br/><br/>
在网上找找资料才知道，原来我现在用的是非中文 XP 操作系统，在用向导生成窗口程序的过程中，没有中文语言的选项。不知道为什么，我的操作系统的区域都是设置成的中国，语言也是设成的简体中体，都没错的，VC6 安装程序看我的界面不是中文就不给我装上中文语言支持的动态库。<!--more--><br/><br/>
解决办法是：可以在 VC6 安装光盘中找到 APPWZCHS.DLL 文件（也点击 <a href="/wp-content/uploads/2007/06/6.0.8168.0__APPWZCHS.zip">6.0.8168.0__APPWZCHS.zip</a> 可从此处下载），拷入到 C:\Program Files\Microsoft Visual Studio\COMMON\MSDev98\Bin\IDE，确切位置视你的 Visual Studio 安装目录而定。这样重新用 MFC AppWizard 建一个工程，在第一步就可以选上简体中文了，在程序中的界面上写中文，然后执行就没问题了。<br/><br/>
如果你的工程中的菜单、对话框、字符串等资源不是由AppWizard生成的，而是手工添加的，你必须保证该资源的Language选项为Chinese(P.R.C)<br/><br/>
还有一个解决方案是：不需要 APPWZCHS.DLL文件，找到工程中的 rc 文件（资源文件），把其中LANGUAGE 9, 1的地方改为4,2；codepage(1252)改为codepage（936）；另外把#include "afxres.rc" 改成#include "l.chs\afxres.rc"；把"afxres.rc" 改成"l.chs\\afxres.rc"即可，其中的数据根据不同文字代码可能不同，例子中的是英文，改为中文。<br/><br/>
改 rc 文件的办法我试过，改过之后虽然执行时界面显示中文都没有问题，可是程序响应按钮操作的时候却出现了 Debug Assertion Failed! _CrtIsValidHeapPointer(pUserData)......非常致命的错误，可能这跟修改 rc 文件是无关的。<br/><br/>
后来试了，的确，出现 _CrtIsValidHeapPoint 错误与修改 rc 文件无关，是因为 delete 一个指针时报的错，至今原因不明，因为同样的代码昨天还行，今天就不行了。随意猜测一下：是否有可能是昨天用的 Debug 出的 Dll 文件，今天用的 Release 出的 Dll 文件。<br/><br/>
就我个人看来，第一种方法比较好，用 MFC AppWizard 生成的窗口像确定啊，取消等按钮或菜单都是中文的，不需要你一个个的改动。<br/><br/>
更详细内容请看下面的连接页面。<br/><br/>
参考资料：1. <a href="http://www.china-askpro.com/msg1/qa31.shtml">VC++编程出现中文乱码</a><br/><br/>
<div id="xunlei_com_thunder_helper_plugin_d462f475-c18e-46be-bd10-327458d045bd"> </div>
