---
title: Bash 下的 emacs 和  vi 键绑定
url: /bash-emacs-vi-key-bindings/
date: 2018-01-22T20:43:23-06:00
featured: false
draft: true
toc: false
# menu: main
usePageBundles: true
categories:
  - Linux/Unix
tags: 
  - vi
  - Emacs
comment: true
codeMaxLines: 50
# additional
wpPostId: 8456 
wpStatus: publish
views: 1093
lastmod: 2018-01-22T20:43:23-06:00
---

<p>初衷只是为了记述一下在 Bash/Zsh 中怎么调用 Vi 编辑当前的命令，但一发挥便涉及到了 Bash/Zsh 的键绑定的话题，无法打住，只得另立新篇。这里也只说 Bash 的键绑定，不会有 Zsh 键绑定的内容。</p>

<p>什么是 Bash 的键绑定(keybing) 呢? 就是在 Bash 中的快捷键方案，即相当于某个 IDE 的快捷键配置，或者叫 Keymap。比如说 IntelliJ IDEA 中可选择的 Keymap 有 Eclipse, Emacs, JBuilder, Mac OS X, Mac OS X 10.5+, NetBean, Visual Studio, 以满足不同使用者的习惯。</p>

<p>相应的 Bash 也为我们提供了两种键绑定的方案，即 emacs(默认) 和 vi 键绑定类型。</p>

<h3>Emacs 键绑定</h3><br/>
<p>我们大多数天天在 Bash 下无意识中使用着 Emacs 键绑定类型，即使可能从未用过 Emacs 本身。比如我们在 Bash 下的按键组合</p>

<blockquote><br/>
<p>ctrl + a     跳到命令行的开始<br /><br/>
 ctrl + e     跳到命令行末尾<br /><br/>
 !!               重复最后一个命令<br /><br/>
 ctrl + l      清屏操作，类似于  clear 命令<br /><br/>
 ctrl + c      中断/杀掉当前运行的进程 (SIGINT)<br /><br/>
 ctrl + d     发送 EOF 标记，这会关掉当前的 shell (EXIT)<br /><br/>
 ctrl + z      发送 SIGTSTP 给当前任务，使其挂起送到后台。(所以如果 vi 未正常退出，而是按 ctrl + z 的话，vi 进程还呆在后台</p>

</blockquote>

<p>它们都是来自于 Emacs 键绑定。是不是那么的熟悉啊？<!--more--></p>

<h3>当前的键绑定类型</h3><br/>
<p>我们说过，Bash 默认的键绑定是 Emacs，基本上在终端中按下 <code>ctrl + l</code> 看是否能成功清屏就知道是否是 Emacs 键绑定，当然 Vi 绑定也可以自定义 <code>ctrl + l</code> 来清屏。</p>

<p>更准确的办法是用 <code>bind</code> 命令，这是一个 Bash 内置的命令。<code>bind -V</code> 可以看到所有设置，<code>bind -V | grep -e editing -e keymap</code> 显示编辑模式与键映射</p>

<blockquote><br/>
<p>$ bind -V | grep -e editing -e keymap<br /><br/>
editing-mode is set to `emacs'<br /><br/>
keymap is set to `emacs'</p>

</blockquote>

<p><code>bind -v</code> 能看到某个属性可以怎么用 <code>set</code> 命令去设置</p>

<h3>显示当前的按键绑定</h3><br/>
<p>使用命令 <code>bind -p</code> 几乎列出了所有的可绑定的按键操作，包括单个字母键标识为 <code>self-insert</code>，和组合键操作，共有大约 478 个键绑定。<code>bind -p | grep -F "\C"</code> 列出  <code>ctrl</code> 开始的键组合</p>

<blockquote><br/>
<p>$ bind -p | grep -F "\C"<br /><br/>
 "\C-g": abort<br /><br/>
 "\C-x\C-g": abort<br /><br/>
 ......<br /><br/>
 "\C-x\C-e": edit-and-execute-command<br /><br/>
 ......<br /><br/>
 "\C-p": previous-history<br /><br/>
 "\C-q": quoted-insert<br /><br/>
 "\C-v": quoted-insert<br /><br/>
 "\C-x\C-r": re-read-init-file<br /><br/>
 "\C-r": reverse-search-history<br /><br/>
 ......</p>

</blockquote>

<p>而 <code>bind -P</code> 列出当前 readline 函数名和键绑定</p>

<h3>切换到 Vi 键绑定</h3><br/>
<p>既然说 Bash  有两种类型的键绑定，并且平时对 Vi 表现出更强烈的热爱，该如何切换成 Vi 键绑定呢？或者说如何在两者之间切换，命令分别是</p>

<ol>

	<li><code>set -o vi</code> 切换到  Vi 键绑定</li>

	<li><code>set -o emacs</code> 切换到  Emacs 键绑定</li>

</ol>

<p>一旦我们切换到了 Vi 键绑定，会发现有些键 <code>ctrl + a</code>, <code>ctrl + l</code> 不管用了，但 <code>ctrl + c</code>, <code>ctrl + z</code> 还是一样的。确认是否是 Vi 键绑定，可以执行 <code>bind -V | grep -e editing -e keymap</code>,</p>

<blockquote><br/>
<p>$ bind -V | grep -e editing -e keymap<br /><br/>
editing-mode is set to `vi'<br /><br/>
keymap is set to `vi-insert'</p>

</blockquote>

<p>现在命令行的输入操控方式来到了 Vi 模式了，<code>Esc</code> 在  Vi 的正常模式与输入模式之间切换，<code>v</code> 键不再是可视模式，而是直接打开 <code>$EDITOR</code> 指示的编辑器(默认为 vi), 载入当前命令进行编辑，退出后立即执行。</p>

<p>Vi 键绑定下可以尝试大多数 Vi 的操作，例如</p>

<ol>

	<li>h, j, k, l 前下上右单字符的移动光标</li>

	<li>w, e, b 在单词间的移动</li>

	<li>0, ^, $ 跳到行首, 或行尾</li>

	<li>x 删除当前字符，dd 删除当前行，S 删除当前行并切到输入模式</li>

	<li>A, I 分别把光标移到行尾，行首并切换到输入模式。因为命令行是单行，所以  o, O 不起作用了</li>

	<li>搭配数字或 Motion 操作，如 dw 删除当前字符到当前词尾(带空白)，d2w 删除当前字符到下两个词尾(带空白)。d$ 删除到行尾</li>

	<li>/  搜索历史命令也能用，不过还是推荐用 <code>ctrl + r</code> 的 <code>reverse-search-history</code></li>

</ol>

<p>更多的类似 Vi 的操作请参看 Vi 操作指南。 在 Vi 键绑定时有些 Emacs 键绑定的快捷操作也还能用，多试一试不会怀孕的。</p>

<p>参考：</p>

<ol>

	<li><a href="https://ss64.com/bash/syntax-keyboard.html">Bash Keyboard Shortcuts</a></li>

	<li><a href="https://ss64.com/bash/bind.html">Bash bind 命令的用法</a></li>

	<li><a href="https://en.wikipedia.org/wiki/GNU_Readline">GNU Readline</a></li>

	<li><a href="https://www.gnu.org/software/bash/manual/html_node/Bindable-Readline-Commands.html">Bindable Readline Commands</a></li>

	<li><a href="https://www.gnu.org/software/bash/manual/html_node/index.html">Bash Reference Manual</a></li>

</ol>
