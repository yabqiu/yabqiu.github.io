---
title: 使用 NodeJS 框架 NW.js 编写桌面应用入门
url: /nodejs-nw-js-gui-app-hello-world/
date: 2015-01-22T02:51:14-06:00
featured: false
draft: true
type: post
toc: false
# menu: main
usePageBundles: true
categories:
  - NodeJS
tags: 
  - node.js
comment: true
codeMaxLines: 50
# additional
wpPostId: 6774 
wpStatus: publish
views: 27939
lastmod: 2021-09-03T17:54:53-05:00
---

前阵子还在琢磨于 Atom Shell 和 Node-Webkit 间如何作个选择。基于 Atom Shell 有点像是站在了 Node-Webkit 的肩膀上的原因，感觉 Atom Shell  会有些优势，所以首先体验了下 <a title="使用 NodeJS 框架 Atom Shell 编写桌面应用入门" href="http://unmi.cc/nodejs-atom-shell-gui-app-hello-world/" target="_blank" rel="noopener noreferrer">使用 NodeJS 框架 Atom Shell 编写桌面应用入门</a>。至于它们实现上是否合并了 Context 对我目前来说还不清楚会有什么影响。</p>
<br/>
正当我要安下心来的时候，先前那个 Node-Webkit 最近几日来了个华丽变身，以更为简洁明快的名字 <a href="http://nwjs.io/" target="_blank" rel="noopener noreferrer">NW.js</a> 横空出世，并且与 NodeJS 的另一分支 <a href="https://iojs.org/" target="_blank" rel="noopener noreferrer">io.js</a> 更热乎。新的名字似乎有意在含糊它与 Webkit 之间的关系。对于 NW.js 的这一激动人心之举, 难免心起涟漪，顿绝不能只是路过，而况它还是出自国人之手，自豪感总有的。<br/><br/>
于是决心一试，略玩之后发现, 特别是开发阶段可显示 toolbar -- 浏览任意 html, 前进/后退/刷新，并能用 Developer Tools 调试 UI 和 JavaScript 的特性。这才令我有些爱不释手，尚不知 Atom Shell 是否有类似的功能。<br/><br/>
开始随我体验 NW.js 的 Hello World 程序，这里包含了外部 js 和 css 文件，仍是以 Mac OS X 平台为例，其他平台类似。<br/><br/>
<span style="color: #0000ff;"><strong>1. 前提条件</strong></span>，安装 NW.js<br/><br/>
$ <span style="color: #800000;">npm install nw -g</span><br/><br/>
nw 模块就安装在 /usr/local/lib/node_modules/nw 目录下了，以后可以直接用 nw 命令来测试程序。<!--more--><br/><br/>
/usr/local/lib/node_modules/nw/nwjs/nwjs.app 是一个可用来打包应用的壳，与 Atom Shell 基本一至。<br/><br/>
<span style="color: #0000ff;"><strong>2. 建立文件, 目录</strong></span><br/><br/>
<blockquote>
nwjs-app/<br />
 ├── app.js<br />
 ├── index.html<br />
 ├── package.json<br />
 └── style.css
</blockquote>
<br/>
这里是一个简单的应用，实际 js 或 css 文件较多，或用到第三方的 js 或 css，需要更好的组织目录，如 js 文件放在 script 子目录中，把 css 文件放在  style 子目录中。<br/><br/>
package.json 内容：<br/><br/>
<pre class="lang:default decode:true">{
  "main": "index.html",
  "name": "Hello NW.js",
  "window": {
//    "toolbar": false //这个选项对于开发太重要了
  }
}</pre>
<br/>
index.html 内容：<br/><br/>
<pre class="lang:default decode:true">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset="utf-8"&gt;
    &lt;title&gt;Hello NW.js&lt;/title&gt;
    &lt;link rel="stylesheet" type="text/css" href="style.css"&gt;
    &lt;script src="app.js"&gt;&lt;/script&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Hello NW.js&lt;/h1&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre>
<br/>
要说 Hello World 程序 ，上面两个文件就足够了，这里再加点料，像 Web 开发一样的引入 js 和  css 文件。下面的两个文件，app.js 和 style.css 可以说明它们确实在发挥着光和热。<br/><br/>
app.js 内容：<br/><br/>
<pre class="brush:js ">console.log('console app.js');
document.writeln("out put from app.js");</pre>
<br/>
style.css 内容：<br/><br/>
<pre class="lang:default decode:true">body {
  background-color: lightgray;
}</pre>
<br/>
<strong><span style="color: #0000ff;">3. 运行程序</span></strong><br/><br/>
命令行下进到项目所在的项目，直接执行 nw<br/><br/>
nwjs-app $ nw<br/><br/>
或者为 nw 指定应用目录，如<br/><br/>
$ nw nwjs-app<br/><br/>
因为在 package.json 中注释掉了 <code>toolbar: false</code> 默认为 true, 所以界面如下<br/><br/>
<img class="aligncenter size-large wp-image-6777" src="/wp-content/uploads/2015/01/hello-nw-800x245.png" alt="hello-nw" width="800" height="245" /><br/><br/>
toolbar 提供了前进，后退，刷新页面，还能修改地址，以及地址栏后的两个开发工具按钮。<br/><br/>
上面的显示效果告诉了我们各个部件工作都很正常如预期。点击上面那个齿轮，打开 Developer Tool<br/><br/>
<img class="aligncenter size-large wp-image-6778" src="/wp-content/uploads/2015/01/nw.js-developer-tool-800x477.png" alt="nw.js-developer-tool" width="800" height="477" /><br/><br/>
对于 Web 开发人员，上面那个界面太熟悉了，有了这个再也不用担心界面的调节了，控制台的输出还捕获在这里的 Console，还能断点调试 JavaScript 代码，总之就等于一个 FireBug 摆在了你的面前。<br/><br/>
<span style="color: #0000ff;"><strong>4. 打包应用程序</strong></span><br/><br/>
如果是自己的工具，上面的步骤已经足够了，要是别的机器上安装了 NodeJS 和 NW.js，拷贝工程目录也可以的。<br/><br/>
与 Atom Shell 基本是一样的，以 /usr/local/lib/node_modules/nw/nwjs/nwjs.app 为壳 -- 可以在 <a href="http://nwjs.io">nwjs.io</a> 上下载，把项目打包成 app.nw 放到前面那个壳的 Contents/Resources 目录中。<br/><br/>
操作步骤<br/><br/>
1) 拷贝出  nwjs.app 并重命名为 hello-nwjs.app<br/><br/>
$ <span style="color: #800000;">cp -R /usr/local/lib/node_modules/nw/nwjs/nwjs.app ./hello-nwjs.app</span><br/><br/>
2) 打包项目文件到上面的 hello-nwjs.app/Contents/Resources 中<br/><br/>
在项目目录下：<br/><br/>
nwjs-app$ <span style="color: #800000;">zip -r ../hello-nwjs.app/Contents/Resources/app.nw *<br />
</span><br/><br/>
这时候就可以双击 hello-nwjs.app 来执行了，或者 open hell-nwjs.app 命令打开<br/><br/>
<img class="aligncenter size-large wp-image-6780" src="/wp-content/uploads/2015/01/nw.js-package-800x194.png" alt="nw.js-package" width="800" height="194" /><br/><br/>
已以把上面 package.json 中的 toolbar 改为 false 了，现在的  hello-nwjs.app 可是个实实在在的桌面应用程序了。<br/><br/>
通过修改 hello-nwjs.app 中的配置文件，图标等来进一步定制应用程序。<br/><br/>
<hr /><br/><br/>
同样，NodeJS 项目用 Grunt 来管理是再适合不过的，有一个 Grunt 插件 <a href="https://www.npmjs.com/package/grunt-node-webkit-builder" target="_blank" rel="noopener noreferrer">grunt-node-webkit-builder</a> 就是干这个的，只是它还没来得急变成 grunt-nw-builder。<br/><br/>
无奈 NW.js 才刚刚昭告天下 <a href="https://groups.google.com/forum/#!msg/nwjs-general/V1FhvfaFIzQ/720xKVd0jNkJ" target="_blank" rel="noopener noreferrer">node-webkit is renamed NW.js for io.js migration</a>，所以基本能找到的资料都是关于 Node-Webkit 的。<br/><br/>
看到 NW.js 对 io.js 的拥抱，有些担心 NodeJS 的分支化的担忧，当然不可能像 Android 那样的碎片化，也许 io.js 不过像是 MySQL 的 MariaDB 分支那样。<br/><br/>
参考: 1. <a href="http://kevinchen.synology.me/TechnicalDocuments/node-webkit/html2nw.html" target="_blank" rel="noopener noreferrer">將html檔打包給node-webkit—入門教學</a><br />
2. <a href="http://icodeit.org/2014/09/get-started-with-node-webkit/" target="_blank" rel="noopener noreferrer">使用node-webkit构建桌面应用程序</a><br />
3. <a href="http://blog.sina.com.cn/s/blog_8089c4650101gz3w.html" target="_blank" rel="noopener noreferrer">node-webkit入门:用JS开发跨平台的桌面应用<br />
</a>4. <a href="http://code.tutsplus.com/tutorials/introduction-to-html5-desktop-apps-with-node-webkit--net-36296" target="_blank" rel="noopener noreferrer">Introduction to HTML5 Desktop Apps With Node-Webkit </a>
