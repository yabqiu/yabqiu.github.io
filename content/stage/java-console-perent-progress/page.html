---
title: Java 控制台输出百分比进度指器
url: /java-console-perent-progress/
date: 2014-02-20T00:46:13-06:00
featured: false
draft: false
type: post
toc: false
# menu: main
usePageBundles: true
categories:
  - Java/JEE
tags: 
  - Java
comment: true
codeMaxLines: 50
# additional
wpPostId: 6213 
wpStatus: publish
views: 4189
lastmod: 2021-05-03T00:05:23-05:00
---

用 Java 在控制台下输出用 <code>System.out.print()</code> 这样的方法，那么要在同一行输出象 FTP 传文件那样的进度指示怎么做呢，它需要在同一行相同的位置上擦除并输出新百分数。比如前一行打印了 1%， 下一次就把 1% 擦除掉，同一位置上打印 2%，就形成了走进度的效果。如下：</p>
<br/>
<img class="aligncenter size-full wp-image-6214" src="/wp-content/uploads/2014/02/console_percent.gif" alt="console_percent" width="340" height="78" /><br/><br/>
我们要用到的办法是<code> System.out.print("\b")</code> 就会在控制台下往回删掉一个字符，如果你想回删多个字符就打印多个 "\b" 吧，只回删除到当前行首，也就是不回影响到上一行的输出。怎么删除当前行全部输出或指定的字符数呢，两个办法：<br/><br/>
输出足够多的 "\b"，会删除到行首为止，这样做其实也不保险，谁知道上一行会多少字符呢<br />
精确控制回删多少个字符，有时候也需要保留前面一些内容<!--more--><br/><br/>
前面动画演示的代码如下：<br/><br/>
<pre class="lang:default decode:true ">public static void main(String[] args) throws Exception {
    System.out.print("Progress:");
    for (int i = 1; i &lt;= 100; i++) {
        System.out.print(i + "%");
        Thread.sleep(100);
        
        for (int j = 0; j &lt;= String.valueOf(i).length(); j++) {
            System.out.print("\b");
        }
    }
    System.out.println();
}
</pre>
<br/>
这是打印 "\b" 回删字符的办法，还有一种做法是 <code>System.out.print("\r")</code>，把光标直接跳到当前行首，然后以覆盖的方式输出字符，这样能保留动态部分后方的内容。但是不知道怎么在控制台下往后跳动光标, Java 好像还做不到这点，.NET 可以，<a href="http://msdn.microsoft.com/en-us/library/system.console.setcursorposition%28v=vs.110%29.aspx" target="_blank" rel="noopener">Console.SetCursorPosition(left, right)</a>。<br/><br/>
Java 下可以运行下面的代码<br/><br/>
<pre class="brush:java">System.out.print("old line");
Thread.sleep(1000);
System.out.print("\rnew\n");</pre>
<br/>
执行效果是先输出，old Line，一秒后当前行内容变为 new Line<br/><br/>
要我说用 "\b" 来清除当前行，重新输出当前后的内容比较容易控制。<br/><br/>
注意，在有些 IDE 的控制台下执行与系统的控制台是不一样，比如在 Eclipse 的控制台下第一段代码会输出<br/><br/>
<span style="color: #800000;">Progress: 1%2%3%4%5%6%7%8%9%10%11%12%13%14%15%.......</span><br/><br/>
也就是 System.out.print("\b"), System.out.print("\r") 对于 Eclipse 控制台是无效果的。<br/><br/>
关于如何运用 Java 写出更为强大的控制台程序可以了解以下两个项目：<br/><br/>
1. <a href="http://code.google.com/p/lanterna/" target="_blank" rel="noopener">lanterna</a><br/><br/>
<img class="aligncenter size-full wp-image-6216" src="/wp-content/uploads/2014/02/lanterna.png" alt="lanterna" width="656" height="378" /><br/><br/>
2. <a href="http://sourceforge.net/projects/javacurses/" target="_blank" rel="noopener">Java Curses Library</a><br/><br/>
<img class="aligncenter size-full wp-image-6217" src="/wp-content/uploads/2014/02/java-curses-library1.jpg" alt="java-curses-library" width="640" height="454" />
