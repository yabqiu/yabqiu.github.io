---
title: Java 语言的几个缺陷之三: 不支持 var 类型推断
url: /java-language-defect-3-not-support-var-type-infer/
date: 2016-07-09T02:26:36-05:00
featured: false
draft: true
toc: false
# menu: main
usePageBundles: true
categories:
  - Java/JEE
tags: 
  - Java
  - java-wanted
comment: true
codeMaxLines: 50
# additional
wpPostId: 7350 
wpStatus: publish
views: 480
lastmod: 2018-06-16T02:26:30-05:00
---

<p>虽说 Java 的支持泛型以及近期 Lambda  表达式的加入, 在对类型进行推断上已经很强大了, 但在类型声明的时候仍然略显冗余, 最主要的一点是 Java 不能像 Scala 那样在声明变量有赋值的情况下进行类型推断. 我们先来看下 Java  已经为我们所进行的改进:</p><blockquote><p>List&lt;String&gt; strings = new ArrayList&lt;String&gt;();  //刚引入泛型时我们是这样<br />List&lt;String&gt; strings = new ArrayList&lt;&gt;();             //后来变成这样了, 可以钻石符号推断, Java 7<br /><br />List&lt;String&gt; list = new ArrayList&lt;&gt;();<br />list.addAll(new ArrayList&lt;&gt;()); //根据 list.addAll() 上下文推断要创建的类型是 new ArrayList&lt;String&gt;(), Java 8<br /><br />interface Foo {<br />  void dodo();<br />}<br />Foo foo = () -&gt; System.out.println("Foo:dodo()");   //Java 8 Lambda 可以根据 Lambda 表达式的签名推断出接口类型<br />foo.dodo();</p></blockquote><p>在 Java 7 的泛型方法其实也是可以通过声明类型与方法参数来推断要返回的具体类型的.<!--more--></p><p>可以我觉得这种类型推断做得还不够, 变量声明时最前面的类型始终需要, 比如能不能像 Scala 一样, 把</p><p>List&lt;String&gt; strings = new ArrayList&lt;String&gt;();  写成  var strings = new ArrayList&lt;String&gt;();</p><p>如果对于这个例子来讲, 也许几时有需求要把 strings 赋值为 new LinkedList&lt;String&gt;() 而不能在这里用 var 的话, 那么像 int, double, string 等应该可以写成</p><pre class="brush:java">var length = 100;      //无需写成 int length = 100;<br/>
var weight =  63.4;    //不用  double weight = 63.4<br/>
var name = "Yanbin";   //不用 String name = "Yanbin"<br/>
var result = foo();    //推断方法的返回类型</pre><p>如果方法返回类型 T 的时候, 也可以直接用 <code>var result = foo()</code> 来接收方法的返回值.</p><p>或许要说 Java 的设计是方便于针对接口去编程, 所以声明类型倾向于接口, 但 Java 8 已经在拥抱函数式编程. 我们可以仅在需要多态时使用上层接口或类去引用变量, 多数时候或在局部区域用 <code>var</code> 推断出具体类型即可.</p><p>我们无法把 Java 与动态类型语言相比, 和 Scala, C# 类比还是可以的, Scala 在用  <code>var</code> 或  <code>val</code> 在多数时候都不需要指定变量类型, 完全依赖对所赋值类型的推断. 而且 C# 早已在使用 <code>var</code> 关键字了, 代码书写何需如此繁琐. IDE 聪明, 用 <code>var</code> 也知道具体类型, 而我们人一般也是心里有底的.</p>
