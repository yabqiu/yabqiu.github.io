---
title: Scala 2.10.0 新特性之字符串插值
url: /scala-2-10-0-feature-string-interpolation/
date: 2013-01-20T16:11:53-06:00
featured: false
draft: false
type: post
toc: false
# menu: main
usePageBundles: true
categories:
  - Java/JEE
  - Scala
  - PlayFramework
tags: 
  - Scala
  - play
comment: true
codeMaxLines: 50
# additional
wpPostId: 5418 
wpStatus: publish
views: 6192
lastmod: 2021-05-19T16:19:15-05:00
---

Scala 在处理字符串方面终于也与时俱进了，引入了字符串插件，这在许多脚本语言中就早已这么做了。有了这个特性，字面量字符串和变量连接可以不需要总是用加号进行丑陋的连接了。有些脚本语言会是只对双引号字符串解析其中的变量，单引号的不会，当然Scala 是要区分字符串和字符类型。</p>
<br/>
直白的讲字符串插值就是，<span style="color: #800000;">val name="Unmi"; val greeting=s"Hello $name"; greeting 的值就是 "Hello name"</span>。产生效应的就是那个 s 方法。<br/><br/>
Scala 2.10.0 为我们提供了三种字符串插值的方式，分别是 s, f 和  raw。它们都是定义在 <a href="http://www.scala-lang.org/archives/downloads/distrib/files/nightly/docs/library/index.html#scala.StringContext" target="_blank" rel="noopener">StringContext</a> 中的方法。<br/><br/>
<strong>s 字符串插值器</strong><br/><br/>
可以解析字符串中的变量，可以调用方法，还能进行计算。实际调用的是  StringContext 中的  s 方法。<!--more--><br/><br/>
<pre class="brush:scala">val name = "Unmi"
println(s"Hello $name")   //Hello Unmi, 实际上就是调用的 StringContext("Hello, ", "").s(name)
println(s"Hello ${name}qq) //Hello Unmiqq 界定变量用大括号{}，s"Hello $nameq" 会试图解析变量  nameqq
println(s"1 + 1 = ${1 + 1} //1 ＋ 1 ＝ 2，能计算值<br/><br/>
class Person(val name: String){
    def say(what: String) = s"say $what"
}
val person = new Person("Unmi")
println(s"Hello ${person.name}, ${person.say(person.name)}")   //Hello Unmi, say Unmi, 这个比较复杂</pre>
<br/>
用大括号可以界定变量，{} 里可以求值，还可以使用属性和调用方法。<br/><br/>
<strong>f 字符串插值器</strong><br/><br/>
它除 s 的功能外(不指定格式就和 s 一样)，还能进行格式化输出，在变量后用 % 指定输出格式，格式的说明参照 Java 的 <a href="http://docs.oracle.com/javase/1.6.0/docs/api/java/util/Formatter.html#detail">Formatter javadoc</a>。实际调用的是  StringContext 中的  f 方法。<br/><br/>
<pre class="brush:scala">val height = 1.9d
val name = "James"
println(f"$name%s is $height%2.2f meters tall") // James is 1.90 meters tall</pre>
<br/>
<strong>raw 字符串插值</strong><br/><br/>
raw 能让字符串原原本本的输出来，而不是产生控制效果，如对 \n ，\t 等的输出。实际调用的是  StringContext 中的  raw 方法。看这个例子就知道了：<br/><br/>
<pre class="lang:default decode:true ">scala&gt; println("a\nb\tc")
a
b    c<br/><br/>
scala&gt; println(raw"a\nb\tc")
a\nb\tc</pre>
<br/>
&nbsp;<br/><br/>
除 Scala 提供的 s, f 和  raw 外，我们也可以参照 Scala 的实现方式，实现自己的插值处理器。参照 StringContext 中的  s, f 和 raw 方法。如实现：<br/><br/>
<pre class="brush:scala">id"String Content"</pre>
<br/>
这需要通过隐式类为 <a href="http://www.scala-lang.org/archives/downloads/distrib/files/nightly/docs/library/index.html#scala.StringContext" target="_blank" rel="noopener">StringContext</a> 类增加相应的方法。这里不详解，具体方法见：<a href="http://docs.scala-lang.org/overviews/core/string-interpolation.html" target="_blank" rel="noopener">http://docs.scala-lang.org/overviews/core/string-interpolation.html</a>。<br/><br/>
最后，目前字符串插值尚不能用于模式匹配中，将会在未来的 2.11 版本得到支持。<br/><br/>
参考: 1. <a href="http://docs.scala-lang.org/overviews/core/string-interpolation.html" target="_blank" rel="noopener">http://docs.scala-lang.org/overviews/core/string-interpolation.html</a>
