---
title: Hibernate程序使用WAS连接池提交事务时出现 NullPointerException
url: /hibernate-was-connection-pool-nullpointerexception/
date: 2007-04-21T02:57:00-05:00
featured: false
draft: true
toc: false
# menu: main
usePageBundles: true
thumbnail: "../images/logos/http://unmi.cc/wp-content/uploads/2016/12/hibernate_log.png"
categories:
  - Hibernate
tags: 
  - WAS
  - Hibernate
comment: true
codeMaxLines: 50
# additional
wpPostId: 527 
wpStatus: publish
views: 1098
lastmod: 2019-11-10T16:02:46-06:00
---

Hibernate应用程序部署到WebSphere Application Server 5.1上,使用WAS的连接池,程序在处理了比较多的 session.save(object)操作之后,在执行提交事物 trans.commit()之时出现以下异常</p>
<br/>
 <span style="color: #ff3300;">java.lang.NullPointerException<br />
        at oracle.jdbc.dbaccess.DBData.clearItem(<span style="color: #0000ff;">DBData.java:431</span>)<br />
        at oracle.jdbc.dbaccess.DBDataSetImpl.clearItem(<span style="color: #0000ff;">DBDataSetImpl.java:3528</span>)<br />
        at oracle.jdbc.driver.OraclePreparedStatement.clearParameters(<span style="color: #0000ff;">OraclePreparedStatement.java:3401</span>)<br />
        at com.ibm.ws.rsadapter.jdbc.WSJdbcConnection.resetStatement(<span style="color: #0000ff;">WSJdbcConnection.java:1719</span>)<!--more--><br />
        at com.ibm.ws.rsadapter.jdbc.WSJdbcConnection.prepareStatement(<span style="color: #0000ff;">WSJdbcConnection.java:1415</span>)<br />
        at com.ibm.ws.rsadapter.jdbc.WSJdbcConnection.prepareStatement(<span style="color: #0000ff;">WSJdbcConnection.java:1381</span>)<br />
        at org.hibernate.jdbc.AbstractBatcher.getPreparedStatement(<span style="color: #0000ff;">AbstractBatcher.java:497</span>)<br />
        at org.hibernate.jdbc.AbstractBatcher.prepareStatement(<span style="color: #0000ff;">AbstractBatcher.java:94</span>)<br />
        at org.hibernate.jdbc.AbstractBatcher.prepareStatement(<span style="color: #0000ff;">AbstractBatcher.java:87</span>)<br />
        at org.hibernate.jdbc.AbstractBatcher.prepareBatchStatement(<span style="color: #0000ff;">AbstractBatcher.java:218</span>)<br />
        at org.hibernate.persister.entity.AbstractEntityPersister.insert(<span style="color: #0000ff;">AbstractEntityPersister.java:2220</span>)<br />
        at org.hibernate.persister.entity.AbstractEntityPersister.insert(<span style="color: #0000ff;">AbstractEntityPersister.java:2656</span>)<br />
        at org.hibernate.action.EntityInsertAction.execute(<span style="color: #0000ff;">EntityInsertAction.java:52</span>)<br />
        at org.hibernate.engine.ActionQueue.execute(<span style="color: #0000ff;">ActionQueue.java:248</span>)<br />
        at org.hibernate.engine.ActionQueue.executeActions(<span style="color: #0000ff;">ActionQueue.java:232</span>)<br />
        at org.hibernate.engine.ActionQueue.executeActions(<span style="color: #0000ff;">ActionQueue.java:139</span>)<br />
        at org.hibernate.event.def.AbstractFlushingEventListener.performExecutions(<span style="color: #0000ff;">AbstractFlushingEventListener.java:28</span>)<br />
        at org.hibernate.event.def.DefaultFlushEventListener.onFlush(<span style="color: #0000ff;">DefaultFlushEventListener.java:27</span>)<br />
        at org.hibernate.impl.SessionImpl.flush(<span style="color: #0000ff;">SessionImpl.java:1000</span>)<br />
        at org.hibernate.impl.SessionImpl.managedFlush(<span style="color: #0000ff;">SessionImpl.java:338</span>)<br />
        at org.hibernate.transaction.JDBCTransaction.commit(<span style="color: #0000ff;">JDBCTransaction.java:106</span>)<br />
</span><br />
因为开发用的是Tomcat应用服务器,配置的Tomcat连接池,所以在本地跑怎么操作都不会有这种错误,费了好一翻工夫也没能定位,查错中总是受 java.lang.NullPointerException 的影响,一遍一遍地审视代码,会是哪个变量没有初始化呢?<br/><br/>
自我折磨了好一阵子,无奈之时去网上Google一把(其实早该这么做的,也就因为怀疑问题出在自己写的代码),才发现原来别人也遇到过类似的问题, Hibernate的官方论坛也有这种讨论.<br/><br/>
<a href="http://www.google.cn/search?complete=1&amp;hl=zh-CN&amp;newwindow=1&amp;q=+oracle.jdbc.dbaccess.DBDataSetImpl.clearItem&amp;meta">http://www.google.cn/search?complete=1&amp;hl=zh-CN&amp;newwindow=1&amp;q=+oracle.jdbc.dbaccess.DBDataSetImpl.clearItem&amp;meta</a>=<br/><br/>
网上有说是驱动的问题,有说是Hibernate数据库方言的问题,也有说最大缓存语句的问题<br/><br/>
1. Delete Object error <a href="http://forum.hibernate.org/viewtopic.php?t=934050">http://forum.hibernate.org/viewtopic.php?t=934050</a><br />
   其中提到的有换 Oracle 数据库驱动, 有人试着换成 ojdcbc14.jar 解决,最后有人说到设置 c3p0 的hibernate.c3p0.max_statements  为 0 就行<br/><br/>
2. NullPointerException on transaction.commit() <a href="http://forum.hibernate.org/viewtopic.php?t=973414&amp;sid=04bbd1a8951b3051c52e374a7888d35e">http://forum.hibernate.org/viewtopic.php?t=973414&amp;sid=04bbd1a8951b3051c52e374a7888d35e</a><br />
   回贴中说是把 org.hibernate.dialect.OracleDialect 换成 org.hibernate.dialect.Oracle9Dialect, 但有人采取这种做法无效,何况我用的还是 8.0.5 的Oracle,I 都不带.<br/><br/>
3. WAS 6上DataSource的问题 <a href="http://www.itpub.net/743938.html">http://www.itpub.net/743938.html</a><br />
   这篇贴主就直接撇名了把Data Source的Command Cache只能设为0，一旦大于0就报以上错误，看来这是一个比较明确的解决办法。于是我就在WAS的控制台下把我所用连接池的 语句高速缓存大小 设置为 0 ，然后重启WAS，问题得到解决。就是不知道不缓存 Statement 对性能会产生怎么样的影响，须进一步了解一下。<br/><br/>
   我也试过换数据库驱动的办法，把原有的驱动换成在我本地可用的class12.jar包，没有效果。又换成ojdbc.jar包试试，还是没用。<br/><br/>
    总结出现以上错误的解决办法，设置WAS的数据源属性的 Command Cache(也就是语句高速缓存大小)为0, 如果用的别的连接池产品，要设置相应的 max_statements 为 0，属性名具体参考对应连接池产品。<br/><br/>
    注意，改了WAS的数据源设置需要重启WAS的。
