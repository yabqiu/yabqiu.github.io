---
title: 使用 NodeJS 框架 Atom Shell 编写桌面应用入门
url: /nodejs-atom-shell-gui-app-hello-world/
date: 2015-01-15T00:43:31-06:00
featured: false
draft: false
type: post
toc: false
# menu: main
usePageBundles: true
categories:
  - NodeJS
tags: 
  - atom shell
  - NodeJS
comment: true
codeMaxLines: 50
# additional
wpPostId: 6760 
wpStatus: publish
views: 4744
lastmod: 2021-09-03T17:55:53-05:00
---

NodeJS 使前后台语言上得到了统一，给 “不就是做网站的” 那些人带来了福音，其基于事件驱动的处理机制更是在并发/CPU 密集型计算上大展身手。</p>
<br/>
虽然我不怎么做 UI 程序，但对于每一种语言却爱关心它做 GUI 程序是否得心应手。像 Java, Groovy, Scala 等写桌面程序也不怎么样，JavaFX 似乎显现出苗头来，因为 JavaFX 也支持 CSS 了，但布局仍然老套。<br/><br/>
HTML + CSS + JS 做页面布局等样式控制有种与身俱来的优越感，于是 NodeJS 的世界里便产生了  <a href="https://github.com/nwjs/nw.js" target="_blank" rel="noopener">Node-Webkit</a>(已更名为 NW.js) 和 <a href="https://github.com/atom/atom-shell" target="_blank" rel="noopener">Atom Shell</a>，它们各自的代表作有 <a href="http://lighttable.com/" target="_blank" rel="noopener">LightTable</a> 和堪与 Sublime 相媲美的 <a href="https://atom.io/" target="_blank" rel="noopener">Atom</a> 编辑器。<br/><br/>
Node-Webkit(NW.js) 有两个context，node context 和 web context, 应用入口是一个 html 文件。而在  Atom Shell 只维持一个context，入口是一个 JS 文件，浏览器的启动控制要亲自动手。<br/><br/>
完了基本的介绍后，回到原点，来看个 Atom Shell 的 Hello World 程序例子。<!--more--><br/><br/>
<span style="color: #0000ff;"><strong>1. 前提条件</strong></span><br/><br/>
已安装了 NodeJS, 并且使用 npm install atom-shell -g 全局方式安装了 Atom Shell。这里以 Mac OS X 平台为例，Atom Shell 安装之后，可以直接执行 atom-shell 命令。可以查看下 atom-shell 执行命令在哪<br/><br/>
<blockquote>
$ which atom-shell<br />
/usr/local/bin/atom-shell<br />
$ ls -l /usr/local/bin/atom-shell<br />
/usr/local/bin/atom-shell -&gt; ../lib/node_modules/atom-shell/run.bat
</blockquote>
<br/>
居然在 Mac 下也用 run.bat 这样带混淆意义的扩展名。此时直接执行 atom-shell 能看到一个  Welcome to Atom Shell 的默认界面。<br/><br/>
<span style="color: #0000ff;"><strong>2. 建立文件目录</strong></span><br/><br/>
<blockquote>
hello-atomshell/<br />
├── index.html<br />
├── main.js<br />
└── package.json
</blockquote>
<br/>
package.json 内容为<br/><br/>
<pre class="lang:default decode:true">{
  "name"    : "your-app",
  "version" : "0.1.0",
  "main"    : "main.js"
}</pre>
<br/>
main.js 内容：<br/><br/>
<pre class="lang:default decode:true">var app = require('app');
var BrowserWindow = require('browser-window');<br/><br/>
var mainWindow = null;<br/><br/>
app.on('window-all-closed', function() {
  app.quit();
});<br/><br/>
app.on('ready', function() {
  mainWindow = new BrowserWindow({width: 600, height: 200});
  mainWindow.loadUrl('file://' + __dirname + '/index.html');<br/><br/>
  mainWindow.on('closed', function() {
    mainWindow = null;
  });
});</pre>
<br/>
本文的代码内容来自 <a href="https://github.com/atom/atom-shell/blob/master/docs/tutorial/quick-start.md" target="_blank" rel="noopener">https://github.com/atom/atom-shell/blob/master/docs/tutorial/quick-start.md</a>，删除了注释代码。app 就像是 MFC 的 theApp 对象，是个应用入口。<br/><br/>
index.html 内容：<br/><br/>
<pre class="lang:default decode:true">&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Hello World!&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Hello World!&lt;/h1&gt;
    We are using node.js &lt;script&gt;document.write(process.version)&lt;/script&gt;
    and atom-shell &lt;script&gt;document.write(process.versions['atom-shell'])&lt;/script&gt;.
  &lt;/body&gt;
&lt;/html&gt;</pre>
<br/>
这是一个  HTML 文件，可以直接使用 Node 的 process 对象。<br/><br/>
<span style="color: #0000ff;"><strong>3. 运行程序</strong></span><br/><br/>
$ atom-shell hello-atomshell<br/><br/>
直接指定应用的目录 hello-atomshell，看到<br/><br/>
<img class="aligncenter size-large wp-image-6762" src="/wp-content/uploads/2015/01/atom-shell-hello-world1-800x264.png" alt="atom-shell-hello-world" width="800" height="264" /><br/><br/>
这样基本程序框架是完成了。深入些就是调动 CSS 来进行布局，以及应用 Node 来突破传统的 Web 沙箱限制了。现在发现程序图标菜单都是默认的，可以在打时进行定制。<br/><br/>
<span style="color: #0000ff;"><strong>4. 打包应用程序</strong></span><br/><br/>
比如在 Mac OS X 也可以打包成像 Atom.app 那样的程序，不管是 Node-Webkit 还是 Atom Shell 的独立程序，即使是一个 Hello World 应用包的大小也是惊人，好在现代磁盘空间不在乎。<br/><br/>
仍然以 Mac OS X 平台为例，需先在 <a href="https://github.com/atom/atom-shell/releases" target="_blank" rel="noopener">https://github.com/atom/atom-shell/releases</a> 下载最新的 darwin-x64 的版本包，如当前为 <a href="https://github.com/atom/atom-shell/releases/download/v0.20.6/atom-shell-v0.20.6-darwin-x64.zip" target="_blank" rel="noopener">atom-shell-v0.20.6-darwin-x64.zip</a>。下后后解压得到其中的 Atom.app 目录，把前面的项目目录 hello-atomshell 整个拷入它的 Contents/Resources 目录中，并更名为 app。<br/><br/>
采用下面的目录结构<br/><br/>
<blockquote>
Atom.app/<br />
└── Contents<br />
└── Resources<br />
├── app<br />
│   ├── index.html<br />
│   ├── main.js<br />
│   └── package.json<br />
└── atom.icns
</blockquote>
<br/>
Atom.app 可以改成别的名，如 HelloAtomShell，程序图标是 atom.icns。在 Info.plist 文件中<br/><br/>
HelloAtomShell.app/Contents/Info.plist<br />
HelloAtomShell.app/Contents/Frameworks/Atom Helper.app/Contents/Info.plist<br/><br/>
找到   CFBundleDisplayName, CFBundleIdentifier and CFBundleName 来定制程序的显示名，标识名和程序名称。<br/><br/>
现在 Finder 中就可以直接双击 HelloAtomShell.app 启动应用了。<br/><br/>
NodeJS 的项目一般都用 Grunt  来管理，同样像程序打包这么重要的事情可以用 <a href="https://github.com/paulcbetts/grunt-build-atom-shell" target="_blank" rel="noopener">grunt-build-atom-shell</a> 来帮忙。同时自己的应用也能打成 app.<a href="https://github.com/atom/asar" target="_blank" rel="noopener">asar</a> 压缩包放在  Xxx.app/Contents/Resources 目录下。<br/><br/>
参考：1. <a href="http://blog.iwege.com/posts/atom-shell-vs-node-webkit.html" target="_blank" rel="noopener">Atom Shell vs Node-Webkit</a><br />
2. <a href="https://github.com/atom/atom-shell/tree/master/docs" target="_blank" rel="noopener">https://github.com/atom/atom-shell/tree/master/docs</a>
