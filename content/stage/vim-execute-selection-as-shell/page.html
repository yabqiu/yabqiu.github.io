---
title: Vim 中使用被选择文本以 Shell 命令执行
url: /vim-execute-selection-as-shell/
date: 2014-11-10T01:58:37-06:00
featured: false
draft: false
type: post
toc: false
# menu: main
usePageBundles: true
categories:
  - Vim
tags: 
  - vi
  - Shell
comment: true
codeMaxLines: 50
# additional
wpPostId: 6707 
wpStatus: publish
views: 928
lastmod: 2017-05-11T00:55:21-05:00
---

<p>在 Vi 中如果想选取文本作为 Shell 命令来执行该如何做呢？ 想法的背景是想在 Vi 中编辑 Shell 命令，主要是对参数的修改，然后直接选择执行，而不希望复制再贴到 Terminal 下看结果。方法其实很简单，用不着使用 <a href="http://code.hootsuite.com/vimshell/" target="_blank" rel="noopener noreferrer">VimShell</a>，关键这个插件的安装还依赖于另两个插件。方法就是：</p>

<p>1. 可视模式选择文本，选择技巧, 按 v 逐字选择，j 从光标位置到行尾，最有用的莫过于大 V，以行为单位选择，所以按一下大 V 直接选中当前行<br /><br/>
 2. Shift+; 进到 :'&lt;,'&gt; 提示符<br /><br/>
 3. 输入 w !sh, 回车即可，要用 fish 就用  w !fish</p>

<p>效果</p>

<p><img class="aligncenter size-large wp-image-6708" src="http://unmi.cc/wp-content/uploads/2014/11/vi-selection-shell-800x174.png" alt="vi-selection-shell" width="800" height="174" /></p>

<p><span style="color: #808080;">原理(<span style="color: #0000ff;"><strong>这个表述其实不怎么准确</strong></span>)：其实进行的是一个管道操作，把选择的文本内容输送给 sh 执行，相当于</span></p>

<p><span style="color: #808080;">echo "echo 'Hello world'" | sh</span></p>

<p>如果想把执行结果输出到文件或是剪贴板, 就可借题发挥下了，比如<!--more--></p>

<p><span style="color: #800000;">:'&lt;,'&gt; w !sh &gt; ~/out</span></p>

<p><span style="color: #800000;">:'&lt;,'&gt; w !sh | pbcopy</span></p>

<p><code>w</code> 是 <code>write</code> 的简写形式，<code>'&lt;,'&gt; w !sh</code> 的意思是把选择区域内的文本作为 shell 命令 <code>sh</code> 的标准输入，所以就成了把选择文件作为脚本来执行的效果。</p>

<p>分别是执行输出到文件或剪贴板中，也可以在 ~/.vimrc 中自定义函数来简化上两个操作。例如使用自定义快捷键，在 ~/.vimrc 中加入</p>

<p><span style="color: #800000;">vmap &lt;leader&gt;e &lt;esc&gt;:'&lt;,'&gt;:w !sh&lt;CR&gt;</span></p>

<p>这样选择的文本之后，只要按下分号 ; 再按 e 键就执行了选择的文本。</p>

<p>参考：<a href="http://stackoverflow.com/questions/1237780/vim-execute-shell-command-without-filtering" target="_blank" rel="noopener noreferrer">http://stackoverflow.com/questions/1237780/vim-execute-shell-command-without-filtering</a></p>
