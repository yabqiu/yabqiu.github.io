---
title: JVM 上的 Lisp 方言 Clojure 1.9
url: /lisp-over-jvm-dialect-clojure-1-9/
date: 2018-02-03T20:46:27-06:00
featured: false
draft: false
type: post
toc: false
# menu: main
usePageBundles: true
thumbnail: "../images/logos/http://unmi.cc/wp-content/uploads/2016/07/clojure-logo-120b.png"
categories:
  - Clojure
tags: 
  - Lisp
comment: true
codeMaxLines: 50
# additional
wpPostId: 8485 
wpStatus: publish
views: 677
lastmod: 2021-09-10T12:52:26-05:00
---

还是从 OSChina 网站上得知 Clojure 1.9 在  2017 年 12 月发布的，时值这么久才开始真正去了解一下这个新版本。距离上一个版本 1.8 的发布时间(2016 年 1  月), 大概两年才出一个版本，而且总的说来 Clojure 1.9 并没有带来多大惊喜。<br/><br/>
唯一能带来点喜气的也就是 Clolure 有了自己的命令行工具了，再也无需寄身于 <a href="https://leiningen.org/">Leiningen</a>(一个 Clojure 构建工具，相当于 sbt 之于 Scala) 的篱笆之下了。以 Mac OS 平台为例，以前试图用 brew 来直接安装 <code>clojure</code> 的时候会提示找不到 <code>clojure</code>, 建议安装 <code>leiningen</code>.<br/><br/>
<blockquote>
$ brew install clojure
</blockquote>
<br/>
在 Clojure 1.9 出来之前，上面的命令会得到如下提示信息<br/><br/>
<blockquote>
Error: No available formula with the name "clojure"<br />
Clojure isn't really a program but a library managed as part of a<br />
project and Leiningen is the user interface to that library.
To install Clojure you should install Leiningen:<br />
brew install leiningen<br />
and then follow the tutorial:<br />
https://github.com/technomancy/leiningen/blob/stable/doc/TUTORIAL.md
</blockquote>
<br/>
所以那时候不得不用<!--more--><br/><br/>
<blockquote>
brew install leiningen
</blockquote>
<br/>
安装 <code>leiningen</code> 后，再通过它进入到  <code>Clojure</code> 控制台<br/><br/>
<a href="/wp-content/uploads/2018/02/clojure-1.9-11.png"><img class="aligncenter size-full wp-image-8487" src="/wp-content/uploads/2018/02/clojure-1.9-11.png" alt="" width="560" height="226" /></a>现在的 Leiningen 的 repl 还只能支持 Clojure 1.8，但作为项目构建工具应该能和 Clojure 1.9 一同使用。<br/><br/>
<code>lein repl</code> 可以用 <code>exit</code>, <code>ctrl + d</code> 退出。当然用 <code>(System/exit 0)</code> 或 <code>(. System exit 0)</code> 代码退出也行。<br/><br/>
Clojure 1.9 出来后，我们可以用 brew 安装 Clojure 了<br/><br/>
<blockquote>
brew install clojure
</blockquote>
<br/>
安装好 Clojure 就能直接运行 <code>clojure</code> 或 <code>clj</code> 命令了<br/><br/>
<a href="/wp-content/uploads/2018/02/clojure-1.9-33.png"><img class="aligncenter wp-image-8492 size-full" src="/wp-content/uploads/2018/02/clojure-1.9-33.png" alt="" width="874" height="238" /></a>进到 Clojure 的控制台(repl - Read-Eval-Print-Loop) 是那么的干脆。不过不能简单的用 <code>exit</code> 命令退出，退出需要用 <code>ctrl + d</code>, 或者 <code>(System/exit 0)</code>, 或者 <code>(. System exit 0)</code> 来退出 clojure 的  repl。<br/><br/>
<h3>关于 Clojure 项目的构建工具</h3><br/><br/>
其实最想要的是 clojure 能与 Maven 相结合，官方并未出品这样的插件，有一款民间的 <a href="https://mvnrepository.com/artifact/com.theoryinpractise/clojure-maven-plugin">clojure-maven-plugin</a>, 能用 Maven 管理 Clojure 项目，不知可靠性如何。<br/><br/>
Clojure 官方的推荐的构建工具仍然是 <a href="https://leiningen.org/"><code>Leiningen</code></a> 和 <a href="http://boot-clj.com/"><code>Boot</code></a>, Leiningen 有小试过，不怎么趁手，可能是 Maven 用习惯了。至于 Boot 就完全不同于传统的思维了。<br/><br/>
其实 Clojure 也内置有类库依赖管理的功能的，通过 <code>deps.edn</code> 文件来配置，允许用本地库，或从 github, Maven 仓库中下载依赖。详情请见 Clojure 官方文档 <a href="https://clojure.org/guides/deps_and_cli">Deps and CLI Guide</a>。<br/><br/>
<code>clojure/clj</code> 并不能称之为一个完备的构建工具，它也只定义最基本的项目布局<br/><br/>
<blockquote>
hello-world<br />
├── deps.edn<br />
└── src<br />
          └── hello.clj
</blockquote>
<br/>
如果要加上 <code>test</code> 目录，<code>resources</code> 目录必须在 <code>deps.edn</code> 中额外指定。<br/><br/>
在项目目录(如 hello-world) 中运行 <code>clj</code> 命令会依据 <code>deps.edn</code> 中的定义下载依赖，也能用 <code>clj -m hello</code> 来运行项目。但它离一个真正的构建工具还很远，不能执行清晰的编译产品代码，编译测试代码，运行测试，打包，布置等操作，更不便于与 <code>CI</code> 的集成。<br/><br/>
更多关于 <code>clojure/clj</code> 的命令可运行 <code>clj --help</code> 查看<br/><br/>
<pre class="lang:default decode:true ">clj --help
Usage: clojure [dep-opt*] [init-opt*] [main-opt] [arg*]
       clj     [dep-opt*] [init-opt*] [main-opt] [arg*]<br/><br/>
The clojure script is a runner for Clojure. clj is a wrapper
for interactive repl use. These scripts ultimately construct and
invoke a command-line of the form:<br/><br/>
java [java-opt*] -cp classpath clojure.main [init-opt*] [main-opt] [arg*]<br/><br/>
The dep-opts are used to build the java-opts and classpath:
 -Jopt          Pass opt through in java_opts, ex: -J-Xmx512m
 -Ralias...     Concatenated resolve-deps aliases, ex: -R:bench:1.9
 -Calias...     Concatenated make-classpath aliases, ex: -C:dev
         -Sdeps EDN     Deps data to use as the final deps file
 -Spath         Compute classpath and echo to stdout only
 -Srepro        Use only the local deps.edn (ignore other config files)
 -Sforce        Force recomputation of the classpath (don't use the cache)
 -Spom          Generate (or update existing) pom.xml with deps and paths
         -Stree         Print dependency tree
 -Sresolve-tags Resolve git coordinate tags to shas and update deps.edn
 -Sverbose      Print important path info to console<br/><br/>
init-opt:
 -i, --init path     Load a file or resource
 -e, --eval string   Eval exprs in string; print non-nil values<br/><br/>
main-opt:
 -m, --main ns-name  Call the -main function from namespace w/args
 -r, --repl          Run a repl
 path                Run a script from a file or resource
 -                   Run a script from standard input
 -h, -?, --help      Print this help message and exit<br/><br/>
For more info, see:
 https://clojure.org/guides/deps_and_cli
 https://clojure.org/reference/repl_and_main</pre>
<br/>
估计实际要开创一个 Clojure 项目，目前来说首选的构建工具应该还是 <code>Leiningen</code>, 其次是 <code>clojure-maven-plugin</code>(1.8.1 最近更新在 2016 年 5 月)。<br/><br/>
最后，在 Clojure 1.9 的 <a href="https://github.com/clojure/clojure/blob/master/changes.md">ChangeLog</a> 中提到的其他新的或增强的特性看是否能在实际中用上, 它们包括：<br/><br/>
<ol>
    <li>spec</li>
    <li>Support for working with maps with qualified keys</li>
    <li>New predicates</li>
    <li>More support for instants</li>
    <li>Other new core functions</li>
    <li>Other reader enhancements</li>
    <li>Spec syntax checking</li>
    <li>Documentation</li>
</ol>
