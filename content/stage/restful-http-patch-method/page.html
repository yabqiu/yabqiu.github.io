---
title: RESTful, 说说 http 的 patch method
url: /restful-http-patch-method/
date: 2013-12-12T10:40:24-06:00
featured: false
draft: true
type: post
toc: false
# menu: main
usePageBundles: true
categories:
  - Java/JEE
tags: 
  - http
  - restful
comment: true
codeMaxLines: 50
# additional
wpPostId: 5800 
wpStatus: publish
views: 18575
lastmod: 2021-05-05T16:02:22-05:00
---

最早的时候，我们只需要 GET 和 POST 方法，POST 方法的引入也只是为了消除 URL 过长，参数隐藏，上传文件的问题，完全和语义无关。接触到 RESTful 之后，我们开始思考 GET 和 POST 的不同语义，并且十分必要的去发掘出所有的 HTTP method，HTTP/1.1 所实现的 method，见 <a href="http://www.ietf.org/rfc/rfc2616" target="_blank" rel="noopener">RFC 2616</a>, 有这些：</p>
<br/>
OPTIONS, GET, HEAD, POST, PUT, DELETE, TRACE, CONNECT<br/><br/>
规范是这么定义的，这还要看容器实现了多少，比如 Tomcat 7 中的 <a href="https://tomcat.apache.org/tomcat-7.0-doc/servletapi/javax/servlet/http/HttpServlet.html" target="_blank" rel="noopener">servlet api</a> 实现了<br/><br/>
doOptions, doGet, doHead, doPost, doPut, doDelete, doTrace 就差个 doConnect 了。<br/><br/>
而我们这里要说的 PATCH method 是在 Servlet 3.0 和当前 Tomcat 7 中都提到的，也就是尚未实现它。<br/><br/>
这也难怪，PATCH 在 2010 年三月份才成为正式的方法，见 <a href="http://tools.ietf.org/html/rfc5789" target="_blank" rel="noopener">RFC 5789</a>。没有 PATCH 的时候我们进行更新的操作采用的是 PUT 方法。那么 PATCH 和 PUT 有什么区别呢？<br/><br/>
同样可以从语义上去理解，有两方面的对比：<!--more--><br/><br/>
<strong>1. 对已有资源的操作：</strong><br/><br/>
PATCH 用于资源的部分内容的更新，例如更新某一个字段。具体比如说只更新用户信息的电话号码字段<br/><br/>
而 PUT 用于更新某个资源较完整的内容，比如说用户要重填完整表单更新所有信息，后台处理更新时可能只是保留内部记录 ID 不变。<br/><br/>
<strong>2. 当资源不存在时：</strong><br/><br/>
联想到版本控制 PATCH 是修改原来的内容，也可能会产生一个新的版本。比如当资源不存在的时候，PATCH 可能会去创建一个新的资源，这个意义上像是 saveOrUpdate 操作。<br/><br/>
PUT 只对已有资源进行更新操作，所以是 update 操作<br/><br/>
见 <a href="http://restcookbook.com/HTTP%20Methods/patch/" target="_blank" rel="noopener">When should we use the PATCH HTTP method?</a> in The RESTful CookBook<br/><br/>
<blockquote>
<div id="stcpDiv">
The HTTP methods PATCH can be used to update partial resources. For instance, when you only need to update one field of the resource, PUTting a complete resource representation might be cumbersome and utilizes more bandwidth
<div>
<pre class="lang:default decode:true">PATCH /user/jthijssen HTTP/1.1
&lt;user&gt;
    &lt;firstname&gt;Joshua&lt;/firstname&gt;
&lt;/user&gt;</pre>
</div>
Also, the PUT method is idempotent. PUTting the same data multiple times to the same resource, should not result in different resources, while POSTing to the same resource can result creation of multiple resources.
- See more at: http://restcookbook.com/HTTP%20Methods/patch/#sthash.gYGM7j3Q.dpuf
</div>
</blockquote>
<br/>
在 <a href="http://tools.ietf.org/html/rfc5789" target="_blank" rel="noopener">RFC 5789</a> 更详述了 PATCH 与 PUT 的区别。<br/><br/>
再来看下目前谁实现了 PATCH 方法，谁还没有实现 PATCH 方法<br/><br/>
1. Apache HttpComponents HttpClient version 4.2 or later 支持了 PATCH<br />
2. 目前 JDK7 的 HttpURLConnection 未实现 PATCH<br />
3. TOMCAT 7 也不行<br />
4. PlayFramework 2 也不支持<br />
5. Spring 3.2 开始支持 PATCH 方法，但要选对部署的容器<br />
6. JBoss Netty 支持 PATCH，可见： <a href="http://docs.jboss.org/netty/3.2/api/org/jboss/netty/handler/codec/http/class-use/HttpMethod.html" target="_blank" rel="noopener">http://docs.jboss.org/netty/3.2/api/org/jboss/netty/handler/codec/http/class-use/HttpMethod.html</a><br/><br/>
总之现在实现了 PATCH 方法的容器真是少。<br/><br/>
参考：1. <a href="http://annevankesteren.nl/2007/10/http-methods" target="_blank" rel="noopener">List of HTTP methods (verbs)<br />
</a>             2. <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html" target="_blank" rel="noopener">Method Definitions<br />
</a>             3. <a href="http://tools.ietf.org/html/rfc5789" target="_blank" rel="noopener">RFC 5789 - PATCH Method for HTTP<br />
</a>             4. <a href="http://www.ietf.org/rfc/rfc2616" target="_blank" rel="noopener">RFC 2616<br />
</a>             5. <a href="https://restful-api-design.readthedocs.org/en/latest/methods.html" target="_blank" rel="noopener">Standard Methods</a>- RESTful API Design
