---
title: "Java 语言的几个缺陷之六: 无字符串插值"
url: /java-language-defect-no-string-interpolation/
date: 2016-07-12T02:07:43-05:00
featured: false
draft: true
toc: false
# menu: main
usePageBundles: true
categories:
  - Java/JEE
tags: 
  - Java
  - java-wanted
comment: true
codeMaxLines: 50
# additional
wpPostId: 7361 
wpStatus: publish
views: 785
lastmod: 2021-09-04T12:40:50-05:00
---

Java 在定义字符串的时候不支持字符串插值, 即不能在字符串中捕获作用域中的变量, 用来组成当前字符串. 而这可以说是其他各种言都具备的基本特性. 例如 Bash 中可以这样</p>
<br/>
<blockquote>
bash-3.2$ name=Yanbin<br />
bash-3.2$ echo "Hello $name"<br />
Hello Yanbin
</blockquote>
<br/>
Java 中不支持类似的方式<br/><br/>
<blockquote>
String name = "Yanbin";<br />
String greeting = "Hello $name";  //Java 中无法把 $name 替换为 name 变量值 "Yanbin"
</blockquote>
<br/>
而使用 Java 必须用 String 的静态方法 format (注意是静态方法哦) 来间接的格式化出一个字符串, 可以这么写<br/><br/>
<blockquote>
String.format("Hello %s", "World");<br />
String.format("%1$s %1$s %s %s %2$s", "aa", 10);    //aa aa aa 10 10
</blockquote>
<br/>
我们看到在用 format 格式化时匹配参数会是一个不小的问题, 相同使用法的打印输出方法是 <code>System.out.printf()</code>. 别说字符串插值了, 如果 format 方法是 String 的一个实例方法应用起来都会便利些, 如 <code>"Hello %s".format("World")</code> 会容易读些, Scala 的字符串实例就有 <code>format</code> 方法了.<!--more--><br/><br/>
也是因为 Java 对字符串插值的缺失造成了 Java 字符串本身不俱备基本的模板功能, 最简单的字符串模板都须用串替换操作,  或者需要依赖像 Velocity, FreeMarker 这样的模板组件. 有点不太明白引入字符串插值会对 Java 语言造成什么危害, 字符串插值应该是编译器的功能, 执行性能上也会优于字符的格式化或连接操作.<br/><br/>
我们来大概领略一下几个常见语言是怎么支持字符插值的.<br/><br/>
<strong>Swift</strong><br/><br/>
<pre class="lang:default decode:true">let extra = "little"
println("Mary had a \(extra) lamb.")</pre>
<br/>
<strong>Scala</strong><br/><br/>
<pre class="lang:default decode:true">scala&gt; val extra = "little"
extra: String = little<br/><br/>
scala&gt; s"Mary had a $extra lamb."
res24: String = Mary had a little lamb.</pre>
<br/>
<strong>C#</strong>, 有点类似于 Scala 的做法<br/><br/>
<pre class="brush:c#">var extra = "little";
Console.WriteLine($"Mary had a {extra} lamb.");</pre>
<br/>
<strong>Python</strong>, 它有多种形式, f, % 操作或 format/substitute 方法, 不过个人看下面这种更趁手些<br/><br/>
<pre class="lang:default decode:true ">&gt;&gt;&gt; extra = "little"
>&gt;&gt; "Mary had a %(extra)s lamb." % locals()
'Mary had a little lamb.'
>&gt;&gt; f"Mary had a {extra} lamb"
'Mary had a little lamb.
>&gt;&gt; "Mary had a {} lamb.".format(extra)
'Mary had a little lamb.
>&gt;&gt; "Mary had a %s lamb." % extra
'Mary had a little lamb.</pre>
<br/>
<strong>Ruby</strong><br/><br/>
<pre class="lang:default decode:true">irb(main):001:0&gt; extra = 'little'
=&gt; "little"
irb(main):002:0&gt; "Mary had a #{extra} lamb."
=&gt; "Mary had a little lamb."
irb(main):003:0&gt; "Mary had a %s lamb." % extra
=&gt; "Mary had a little lamb."</pre>
<br/>
Clojure 与 Scala 一样也是调用字符串的实例 format 方法, PHP, Perl, Kotlin, Groovy 等都是与  Bash 是一样的.<br/><br/>
参考:<a href="https://rosettacode.org/wiki/String_interpolation_(included)"> https://rosettacode.org/wiki/String_interpolation_(included)</a>
