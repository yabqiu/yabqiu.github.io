---
title: VBA 中发送邮件（二. 使用 JMail 组件）
url: /vba-send-email-jmail/
date: 2009-04-03T02:26:00-05:00
featured: false
draft: true
type: post
toc: false
# menu: main
usePageBundles: true
categories:
  - C++/VB
tags: 
  - VBA
  - JMail
comment: true
codeMaxLines: 50
# additional
wpPostId: 286 
wpStatus: publish
views: 2214
lastmod: 2015-07-01T01:52:54-05:00
---

<p>在上一篇 <a id="Editor_Results_rprSelectionList_ctl01_LinkTitle" class="titlelink" href="http://unmi.cc/vba-send-email-outlook/">VBA 中发送邮件（使用 Outlook）</a>中，VBA 通过 Outlook 来发邮件不仅频繁的弹出提示窗口要求确定，而且需要在 Outlook 中配置好，不能随意使用邮件服务器。对此，是否有相当于 JavaMail 那样的第三方组件呢？Google 帮忙，果然找到一个，名曰 w3 JMail，J 为首，其实与 Java 无任何关系。</p><p>可以在网络上搜索 w3 JMail Personal V4.3，或者直接到官网 <a href="http://www.dimac.net">http://www.dimac.net</a> 去下载，w3 Jmail 的授权方式是免费的。默认位置安装好 JMail 之后，是在 C:\Program Files\Dimac\w3JMail4 可以看到 Examples 目录、jmail.dll、w3jmail4.pdf 和 readme.txt 文件。可以查阅w3jmail4.pdf 中的使用帮助。我们所要的文件其实只是那个 jmail.dll，安装程序会自动帮你注册 jmail.dll。若未运行安装程序，只是拷贝了 jmail.dll，则要运行 regsvr32 jmail.dll 注册它即可。<!--more--></p><p>可以看看那个 Examples 目录，发现可支持 ASP、Assembly、Delphi、Visual C++、xml，自然像 JS、VBS、VB、VBA 那样的语言中也能使用。它不仅可以用来发送邮件，也能通过 POP 协议接收邮件。下面看一段接收邮件的代码：</p><pre class="brush:vb">'使用 JMail 组件来发送邮件<br/>
Function JmailSend(Subject, HtmlBody, MailTo)<br/>
    Dim JmailMsg As New jmail.Message<br/>
    With JmailMsg<br/>
        .Encoding = "GBK"<br/>
        .MailServerUserName = "Unmi" 'smtp 验证用户名<br/>
        .MailServerPassWord = "xxxxxx" 'smtp 验证密码<br/>
        .AddRecipient MailTo '收件人<br/>
        .AddRecipientCC "fantasia@sina.com" '抄送<br/>
        .AddRecipientBCC "broodwar@2911.net" '暗送<br/>
        .From = "unmi@2911.net"<br/>
        .FromName = "隔叶黄莺"<br/>
        .Charset = "GBK"<br/>
        .ContentType = "text/html"<br/>
        '.Priority = 1  '重要级别<br/>
        .Logging = True '为 True，可用 JmailMsg.Log 获得与服务器交互的详细日志信息<br/>
        .Silent = True '为 True，出错时会有 JmailMsg.ErrorMessage 回送消息<br/>
        .Subject = Subject<br/>
        '.Body = HtmlBody    '作为纯文本内容发送，设置 Body 属性<br/>
        .HtmlBody = HtmlBody '用这个可以发送 Html 内容<br/>
<br/>
        .AddAttachment "c:\users.ctl"  '发送附件<br/>
<br/>
        If .Send("mail.2911.net") Then '指定邮件服务器<br/>
            JmailSend = "发送成功"<br/>
        Else<br/>
            JmailSend = JmailMsg.ErrorMessage<br/>
        End If<br/>
        MsgBox JmailMsg.Log<br/>
        .Close<br/>
    End With<br/>
    Set JmailMsg = Nothing<br/>
End Function</pre><p>在 Excel 的 Microsoft Visual Basic 编辑器中要引用注册的“JMail 4.0 Library”， 代码中的 AddXxx 方法可以执行多次，如增加多个收件人、多个附件等。真正实现批量全自动发送，程序中可动态的选择邮件服务器。</p><p>用 w3 JMail 组件比起调用 Outlook 可要方便的多，Outlook 可以不用配置，发布时只需要带个 jmail.dll 动态库，用 regsvr32 jmail.dll 注册一下即可。</p><p>参考：1. <a href="http://qzone.qq.com/blog/4933188-1235490622" target="_blank">用VBA+Jmail发邮件</a></p><div id="xunlei_com_thunder_helper_plugin_d462f475-c18e-46be-bd10-327458d045bd"> </div>
