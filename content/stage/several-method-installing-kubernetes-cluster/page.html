---
title: å‡ ç§ç®€å•å®‰è£… Kubernetes é›†ç¾¤çš„æ–¹æ³•
url: /several-method-installing-kubernetes-cluster/
date: 2020-03-29T19:00:19-05:00
featured: false
draft: true
toc: false
# menu: main
usePageBundles: true
thumbnail: "../images/logos/https://yanbin.blog/wp-content/uploads/2020/03/kubernetes_logo.png"
categories:
  - Kubernetes
tags: 
  - minikube
  - kind
comment: true
codeMaxLines: 50
# additional
wpPostId: 10034 
wpStatus: publish
views: 1528
lastmod: 2020-04-06T16:19:22-05:00
---

åœ¨ <a href="https://yanbin.blog/kubernetes-learning-1/">Kubernetes å­¦ä¹ ç¬”è®°(ä¸€) - åˆä¸Šæ‰‹</a> ä¸­ä¸€ä¸Šæ‰‹å°±å°è¯•äº†æœ€åŸå§‹çº§çš„å®‰è£… Kubernetes çš„æ–¹å¼ï¼ŒèŠ±äº†ä¸å°‘æ—¶é—´ï¼Œå¥½å¤„æ˜¯èƒ½æ›´å¥½çš„ç†è§£ Kubernete çš„ç»„æˆä»¥åŠå„èŠ‚ç‚¹æ˜¯å¦‚ä½•ååŒå·¥ä½œçš„ã€‚ä»ã€ŠKubernetes in Actionã€‹ç¬¬äºŒç‰ˆä¸­äº†è§£äº†å‡ ç§ç®€å•çš„æ–¹æ³•ï¼Œä¸ºä»€ä¹ˆè¦æŠŠä»¥ä¸‹å‡ ç§æ–¹å¼åˆ—å‡ºæ¥å‘¢ï¼Ÿä¸ºäº†è®©çœ‹åˆ°ä¸Šç¯‡çš„åŒå­¦ä»¬ä¸è‡³äºå¯¹ Kubernetes çš„å®‰è£…è¿‡ç¨‹æœ›è€Œå´æ­¥ã€‚ä¸‹é¢çš„å‰ä¸¤ç§æ–¹å¼éƒ½æ˜¯åˆ›ç«‹çš„å•èŠ‚ç‚¹çš„ Kubernetes é›†ç¾¤ã€‚<br/><br/>
<h3>ä¸€ï¼šå¯ç”¨ Docker Desktop çš„ Kubernetes ç‰¹æ€§</h3><br/><br/>
Docker Desktop çš„ Community ç‰ˆæœ¬ä»Â  18.06.0-ce-mac70 2018-07-25 å¼€å§‹åŠ å…¥äº†å¯¹ Kubernetes çš„æ”¯æŒï¼Œåœ¨ 2018-11-19 åï¼ŒDocker Desktop å¼€å§‹ç”¨ 2.0.0.0 è¿™æ ·çš„ç‰ˆæœ¬ã€‚å½“å‰çš„ Docker Desktop Community ç‰ˆæ˜¯ 2.2.0.4ï¼Œæ‰€å¸¦çš„ Kubernetes æ˜¯ v1.15.5ï¼Œè¦å¯ç”¨å®ƒåªè¦è¿›åˆ°å®ƒçš„ <code>Preferences...</code>,<!--more--><br/><br/>
<a href="https://yanbin.blog/wp-content/uploads/2020/03/docker-desktop-kubernetes.png"><img class="aligncenter wp-image-10036" src="https://yanbin.blog/wp-content/uploads/2020/03/docker-desktop-kubernetes-800x321.png" alt="" width="720" height="289" /></a><br/><br/>
é€‰æ‹© Enable Kubernetes å°±è¡Œï¼Œé€‰ä¸Š Show system container(advanced) å°†å†³å®šåœ¨ <code>docker ps</code> èƒ½å¦çœ‹åˆ° Kubernetes æ‰€éœ€çš„å®¹å™¨ï¼Œä¾‹å¦‚ dns, proxy ç›¸å…³çš„ã€‚Apply &amp; Restart åç¨ç­‰ä¸€ä¼šï¼Œåˆå§‹åŒ–å®Œæˆå¯ä»¥æŸ¥çœ‹ä¸€ä¸‹ Nodes å’Œ Pods<br/><br/>
<a href="https://yanbin.blog/wp-content/uploads/2020/03/docker-desktop-kubernetes-1.png"><img class="aligncenter wp-image-10037" src="https://yanbin.blog/wp-content/uploads/2020/03/docker-desktop-kubernetes-1-800x334.png" alt="" width="621" height="259" /></a><br/><br/>
å®Œæˆã€‚å°±è¿™ä¹ˆç®€å•ã€‚<br/><br/>
åœ¨ Docker Desktop ä¸‹èŠ‚ç‚¹ docker-desktop æ˜¯ä¸€ä¸ªè™šæ‹Ÿæœºï¼Œå¯ç”¨å¦‚ä¸‹å‘½ä»¤è¿›å…¥åæŸ¥çœ‹æœºå™¨åæ¥éªŒè¯ä¸€ä¸‹<br/><br/>
<blockquote>
$ docker run --net=host --ipc=host --uts=host --pid=host --privileged \<br />
--security-opt=seccomp=unconfined -it --rm -v /:/host alpine chroot /host<br />
/ # hostname<br />
<span style="color: #0000ff;">docker-desktop</span>
</blockquote>
<br/>
è¿™æ¶‰åŠåˆ°äº† Docker ä¸ Namespace çš„è¯é¢˜ï¼Œè¯¦æƒ…è¯·å‚è€ƒå‰ä¸€ç¯‡ <a href="https://yanbin.blog/docker-process-namespace/">Docker å®¹å™¨å†…è¿›ç¨‹ä¸ Namespace</a>ã€‚<br/><br/>
<h3>äºŒï¼šMinikube é›†ç¾¤å®‰è£…</h3><br/><br/>
Minikube æ”¯æŒ macOS, Linux å’Œ Windows, å®ƒæ˜¯ä¸€ä¸ªå•äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œåœ¨ Mac ä¸‹å¯ç”± <code>brew install minikube</code> å®‰è£…ã€‚å®‰è£…åå¯åŠ¨ä¸€ä¸ª Kubernetes ä¼šé›†ç¾¤ååˆ†å®¹æ˜“<br/><br/>
<blockquote>
$ minikube start<br />
ğŸ˜„ minikube v1.9.0 on Darwin 10.14.4<br />
âœ¨ Using the hyperkit driver based on existing profile<br />
ğŸ”„ Retarting existing hyperkit VM for "minikube" ...<br />
ğŸ³ Preparing Kubernetes v1.18.0 on Docker 19.03.8 ...<br />
ğŸŒŸ Enabling addons: default-storageclass, storage-provisioner<br />
ğŸ„ Done! kubectl is now configured to use "minikube"
â— /usr/local/bin/kubectl is v1.15.5, which may be incompatible with Kubernetes v1.18.0.<br />
ğŸ’¡ You can also use 'minikube kubectl -- get pods' to invoke a matching version
</blockquote>
<br/>
å¦‚æœæ˜¯åœ¨ Mac æˆ– Windows ä¸Šè¿è¡Œ minikubeï¼Œå®ƒä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºï¼Œåœ¨ Linux ä¸‹å¯ç”¨Â  <code>minikube start --vm-driver none</code> ä»¥å½“å‰ä¸»æœºç³»ç»Ÿä¸ºå®¿ä¸»æœºã€‚<br/><br/>
æ£€æŸ¥ä¸€ä¸‹èŠ‚ç‚¹å’Œ Pod çš„è¿è¡Œæƒ…å†µï¼š<br/><br/>
<a href="https://yanbin.blog/wp-content/uploads/2020/03/minikube-kubernetes-1.png"><img class="aligncenter wp-image-10038" src="https://yanbin.blog/wp-content/uploads/2020/03/minikube-kubernetes-1-800x315.png" alt="" width="584" height="230" /></a><br/><br/>
å®ƒçš„çŠ¶æ€å¯ç”± Â <code>minikube status</code> æŸ¥çœ‹ï¼Œ<code>minikube ssh</code> èƒ½ç›´æ¥ç™»é™†åˆ°å®ƒåˆ›å»ºçš„ä¸­é—´è™šæ‹Ÿæœºä¸­<br/><br/>
<a href="https://yanbin.blog/wp-content/uploads/2020/03/minikube-kubernetes-2.png"><img class="aligncenter wp-image-10039" src="https://yanbin.blog/wp-content/uploads/2020/03/minikube-kubernetes-2.png" alt="" width="380" height="174" /></a><br/><br/>
å®ƒè¿˜æœ‰ä¸€ä¸ªæ›´è¯±äººçš„åŠŸèƒ½æ˜¯æ‰§è¡Œ <code>minikube dashboard</code> åé©¬ä¸Šç»™ä½ æ‰“å¼€æµè§ˆå™¨è¿›åˆ° Kubernetes Dashboardï¼Œç™»é™†ä¹Ÿå…äº†ã€‚<br/><br/>
<blockquote>
$ minikube dashboard<br />
ğŸ”Œ Enabling dashboard ...<br />
ğŸ¤” Verifying dashboard health ...<br />
ğŸš€ Launching proxy ...<br />
ğŸ¤” Verifying proxy health ...<br />
ğŸ‰ Opening http://127.0.0.1:56889/api/v1/namespaces/kubernetes-dashboard/services/http:kubernetes-dashboard:/proxy/ in your default browser...
</blockquote>
<br/>
åœæ­¢é›†ç¾¤ç”¨ <code>minikube stop</code><br/><br/>
<blockquote>
$ minikube stop<br />
âœ‹ Stopping "minikube" in hyperkit ...<br />
ğŸ›‘ Node "m01" stopped.
</blockquote>
<br/>
<h3>ä¸‰ï¼šç”¨ kind(Kubernetes in Docker)Â è¿è¡Œæœ¬åœ°é›†ç¾¤</h3><br/><br/>
è¿™ç§æ–¹å¼ä¸‹ Kubernetes èŠ‚ç‚¹ä¹Ÿæ˜¯ç”± Docker å®¹å™¨æ¥è¿è¡Œï¼Œå¯åŠ¨å¤šä¸ª Docker å®¹å™¨ä¹Ÿå°±å¾ˆå®¹æ˜“åˆ›å»ºçš„å¤šå»ºäº†å¤šèŠ‚ç‚¹çš„ Kubernetes é›†ç¾¤ã€‚kindÂ  ä¹Ÿæ˜¯ä¸€ä¸ªå•ä¸€å¯ä»¥å¯æ‰§è¡Œæ–‡ä»¶ã€‚åœ¨ Mac ä¸‹ä¹Ÿå¯ç”¨ <code>brew install kind</code> å®‰è£…ï¼Œå®‰è£…åè¿è¡Œ <code>kind create cluster</code> åˆ›å»º KubernetesÂ é›†ç¾¤<br/><br/>
<blockquote>
$ kind create cluster<br />
Creating cluster "kind" ...<br />
âœ“ Ensuring node image (kindest/node:v1.17.0) ğŸ–¼<br />
âœ“ Preparing nodes ğŸ“¦<br />
âœ“ Writing configuration ğŸ“œ<br />
âœ“ Starting control-plane ğŸ•¹ï¸<br />
âœ“ Installing CNI ğŸ”Œ<br />
âœ“ Installing StorageClass ğŸ’¾<br />
Set kubectl context to "kind-kind"<br />
You can now use your cluster with:
kubectl cluster-info --context kind-kind
Have a nice day! ğŸ‘‹
</blockquote>
<br/>
æŸ¥çœ‹ä¸€ä¸‹<br/><br/>
<a href="https://yanbin.blog/wp-content/uploads/2020/03/kind-kubernetes-1.png"><img class="aligncenter wp-image-10042" src="https://yanbin.blog/wp-content/uploads/2020/03/kind-kubernetes-1-800x329.png" alt="" width="715" height="294" /></a><br/><br/>
åˆ é™¤é›†ç¾¤çš„å‘½ä»¤æ˜¯ <code>kind delete cluster</code><br/><br/>
å®ƒè¿˜èƒ½åˆ›å»ºå¤šèŠ‚ç‚¹çš„é›†ç¾¤ï¼Œéœ€è¦ç”¨ä¸€ä¸ª yaml æ–‡ä»¶æ¥æè¿°ï¼Œå¦‚åˆ›å»ºä¸€ä¸ª kind-multi-node.yaml æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹<br/><br/>
<pre class="lang:default decode:true">kind: Cluster
apiVersion: kind.sigs.k8s.io/v1alpha3
nodes:
  - role: control-plane
  - role: worker
  - role: worker
</pre>
<br/>
ç”¨ <code>kind create cluster --config kind-multi-node.yaml</code> å‘½ä»¤å°±èƒ½åˆ›å»ºä¸€ä¸ª Master å’Œä¸¤ä¸ª worker çš„ Kubernetes é›†ç¾¤ã€‚<br/><br/>
<blockquote>
$ kind create cluster --config kind-multi-node.yaml<br />
Creating cluster "kind" ...<br />
âœ“ Ensuring node image (kindest/node:v1.17.0) ğŸ–¼<br />
âœ“ Preparing nodes ğŸ“¦ ğŸ“¦ ğŸ“¦<br />
âœ“ Writing configuration ğŸ“œ<br />
âœ“ Starting control-plane ğŸ•¹ï¸<br />
âœ“ Installing CNI ğŸ”Œ<br />
âœ“ Installing StorageClass ğŸ’¾<br />
âœ“ Joining worker nodes ğŸšœ<br />
Set kubectl context to "kind-kind"<br />
You can now use your cluster with:
kubectl cluster-info --context kind-kind
Have a question, bug, or feature request? Let us know! https://kind.sigs.k8s.io/#community ğŸ™‚
</blockquote>
<br/>
æ£€æŸ¥èŠ‚ç‚¹ï¼ŒPod<br/><br/>
<a href="https://yanbin.blog/wp-content/uploads/2020/03/kind-kubernetes-2.png"><img class="aligncenter wp-image-10043" src="https://yanbin.blog/wp-content/uploads/2020/03/kind-kubernetes-2-800x465.png" alt="" width="714" height="415" /></a><br/><br/>
kind æœªå†…ç½® Dashboard æ”¯æŒï¼Œéœ€è¦çš„è‡ªå·±å®‰è£…ã€‚<br/><br/>
å°ç»“ä¸€ä¸‹ä¸‰ç§å®‰è£…ç®€å•å®‰è£… KuberneteÂ çš„ç®€å•æ–¹æ³•<br/><br/>
<ol>
    <li>Docker Desktop Kubernetes: å•èŠ‚ç‚¹é›†ç¾¤ï¼Œå½“å‰æœ€æ–°çš„ Docker Desktop 2.2.0.4 æ‰€å¸¦çš„ Kubernetes ä»ç„¶æ˜¯ v1.15.5ã€‚èŠ‚ç‚¹ä¸º Docker çš„å®¿ä¸»è™šæ‹Ÿæœº</li>
    <li>minikubeï¼šå•èŠ‚ç‚¹é›†ç¾¤ï¼Œå½“å‰ minikube v1.9.0, æ‰€å¸¦ Kubernetes æ˜¯æ–°çš„ 1.18.0ã€‚å¹¶ä¸”è‡ªå¸¦ Dashboard, åªè¦ minikube dashboard å°±èƒ½æ‰“å¼€ï¼Œéå¸¸çš„ä¾¿åˆ©ã€‚èŠ‚ç‚¹ä¸º minikubeÂ æ–°å»ºçš„è™šæ‹Ÿæœº</li>
    <li>kind(Kubernetes in Docker): æ”¯æŒå¤šèŠ‚ç‚¹é›†ç¾¤ï¼Œç›®å‰ kind v0.7.0 æ‰€å¸¦çš„ Kubernetes æ˜¯ v1.17.0ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ª Docker å®¹å™¨ã€‚Â </li>
</ol>
<br/>
é“¾æ¥ï¼š<br/><br/>
<ol>
    <li><a href="https://github.com/kubernetes/minikube">kubernetes/minikube on github</a></li>
    <li><a href="https://kind.sigs.k8s.io/docs/user/quick-start/">kind Quick Start</a></li>
</ol>
