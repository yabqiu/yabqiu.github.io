---
title: Quartz Job Scheduling Framework［翻译］第五章. Cron 触发器及相关内容 (第三部分)
url: /quartz-job-scheduling-framework-5-3/
date: 2008-03-28T22:19:00-05:00
featured: false
draft: true
toc: false
# menu: main
usePageBundles: true
thumbnail: "../images/logos/https://yanbin.blog/wp-content/uploads/2007/10/quartz-logo.jpeg"
categories:
  - Quartz
tags: 
  - Quartz
  - 翻译
  - Cron
comment: true
codeMaxLines: 50
# additional
wpPostId: 425 
wpStatus: publish
views: 681
lastmod: 2021-09-02T20:50:57-05:00
---

<strong>四. 为 CronTrigger 使用起迄日期<br />
</strong></p>
<br/>
Cron 表达式是用来决定一个 Trigger 被触发执行一个 Job 的日期和次数。当你创建一个 <span style="color: #800080;">CronTrigger</span> 实例，假如没为它指定一个开始时间，这个 Trigger 当然就会假定是在依赖于 Cron 表达式尽早的被触发。例如，如果你用这个表达式<br/><br/>
<span style="color: #800080;">0 * 14-20 * * ?<br />
</span><br />
这个 Trigger 会在每天的从下午 2 点到下午的 7:59 间的每分钟触发一次。一旦你运行了这个表达式的 <span style="color: #800080;">CronTrigger</span>，假如当前是下午 2 点后(不能超过 7:59 PM--译者注)，它将会立即触发。它会在每天无限期的被触发。<!--more--><br/><br/>
另一方面，倘若你希望这个计划直到下一天才开始，并且只执行两天，你就可以用 <span style="color: #800080;">CronTrigger</span> 的 <span style="color: #800080;">setStartTime()</span> 和 <span style="color: #800080;">setEndTime()</span> 方法来形成一个 "定时箱" 来触发。代码 5.2 描述了限定 <span style="color: #800080;">CronTrigger</span> 仅触发两天的例子。<br/><br/>
<strong>代码 5.2. 你可以对 CronTrigger 用 startTime 和 endTime<br />
</strong><br/><br/>
<pre class="brush:java">public class Listing_5_2 {
     static Log logger = LogFactory.getLog(Listing_5_2.class);<br/><br/>
     public static void main(String[] args) {
          Listing_5_2 example = new Listing_5_2();
          example.runScheduler();
     }<br/><br/>
     public void runScheduler() {
          Scheduler scheduler = null;<br/><br/>
          try {<br/><br/>
              // Create a default instance of the Scheduler
              scheduler = StdSchedulerFactory.getDefaultScheduler();
              scheduler.start();
              logger.info("Scheduler was started at " + new Date());<br/><br/>
              // Create the JobDetail
              JobDetail jobDetail = new JobDetail("PrintInfoJob",
                        Scheduler.DEFAULT_GROUP,
                                    PrintInfoJob.class);<br/><br/>
              // Create a CronTrigger
              try {
                   // cron that fires every min from 2  8pm
                   CronTrigger trigger =
                                    new CronTrigger("MyTrigger", null,
                                                   "0 * 14-20 * * ?");<br/><br/>
                   Calendar cal = Calendar.getInstance();
                   // Set the date to 1 day from now
                   cal.add(Calendar.DATE, 1);
                   trigger.setStartTime(cal.getTime());<br/><br/>
                   // Move ahead 2 days to set the end time
                   cal.add(Calendar.DATE, 2);
                   trigger.setEndTime(cal.getTime());<br/><br/>
                   scheduler.scheduleJob(jobDetail, trigger);
              } catch (ParseException ex) {
                   logger.error("Couldn't parse cron expr", ex);
              }<br/><br/>
         } catch (SchedulerException ex) {
              logger.error(ex);
         }
    }
}</pre>
<br/>
代码 5.2 中的例子使用了 <span style="color: #800080;">java.util.Calendar</span> 来为 Trigger 选择一个开始和结束时间周期。在上面例子中，Trigger 将会在 Scheduler 启动后的下一天开始触发，并只在开始触发后的两天内有效。<br/><br/>
使用 <span style="color: #800080;">CronTrigger</span> 的 <span style="color: #800080;">startTime</span> 和 <span style="color: #800080;">endTime</span> 属性的效果有点像 <span style="color: #800080;">SimpleTrigger</span>。<br/><br/>
<strong>五. 为 CronTrigger 使用 TriggerUtils</strong><br/><br/>
在第四章，"安排 Job" 中介绍了 <span style="color: #800080;">org.quartz</span> 包中的 <span style="color: #800080;">TriggerUtils</span> 类，它简化了两种类型的 Trigger 的创建。只要可能的话，你应该尝试用 <span style="color: #800080;">TriggerUtils</span> 类的方法来创建你的 Trigger。<br/><br/>
例如，假如你需要在每天的下午 5:30 执行一个 Job，你可以用下面的代码：<br/><br/>
<pre class="brush:java">try {<br/><br/>
  // A CronTrigger that fires @ 5:30PM
  CronTrigger trigger = new CronTrigger("CronTrigger", null, "0 30 17 ? * *");
} catch (ParseException ex) {
  logger.error("Couldn't parse cron expression", ex);
}</pre>
<br/>
或者你能用上 <span style="color: #800080;">TriggerUtils</span>，如下：<br/><br/>
<pre class="brush:java">  // A CronTrigger that fires @ 5:30PM
Trigger trigger = TriggerUtils.makeDailyTrigger(17, 30);
trigger.setName("CronTrigger");</pre>
<br/>
<span style="color: #800080;">TriggerUtils</span> 使得我们更简单方便的使用 Trigger，而又未放弃太多的灵活性。<br/><br/>
<strong>六. 在 <span style="color: #800080;">JobInitializationPlugin</span> 中使用 <span style="color: #800080;">CronTrigger</span><br />
</strong><br />
尽管我们要到第八章，"使用 Quartz 插件" 才会讲到插件，但还是值得提前展现一下 <span style="color: #800080;">CronTrigger</span> 如何应用于  <span style="color: #800080;">quartz_jobs.xml</span> 文件中来指定 Job 信息的。<span style="color: #800080;">JobInitialzationPlugin</span> 可用来从 XML 文件中加载 Job 的信息。<br/><br/>
正如 <span style="color: #800080;">SimpleTrigger</span> 一样，你可在 XML 文件中指定 <span style="color: #800080;">CronTrigger</span> 的表达式，并且 Quartz 的 Scheduler 将会利用这一信息来安排你的 Job。这对于你想在你的程序代码之外声明你的 Job 信息时特别方便。代码 5.3 显示了 <span style="color: #800080;">quartz_jobs.xml</span> 文件内容，它被 <span style="color: #800080;">JobInitializationPlugin</span>  用来加作 Job 信息。<br/><br/>
<strong>代码 5.3. <span style="color: #800080;">CronTrigger</span> 可在 XML 文件中指定，并由 <span style="color: #800080;">JobInitializationPlugin</span> 加载<br />
</strong><br/><br/>
<pre class="lang:default decode:true ">&lt;?xml version='1.0' encoding='utf-8'?&gt;<br/><br/>
&lt;quartz&gt;
  &lt;job&gt;
    &lt;job-detail&gt;
      &lt;name&gt;PrintInfoJob&lt;/name&gt;
    &lt;group&gt;DEFAULT&lt;/group&gt;
    &lt;description&gt;
      A job that prints out some basic information.
    &lt;/description&gt;
    &lt;job-class&gt;
      org.cavaness.quartzbook.common.PrintInfoJob
    &lt;/job-class&gt;
   &lt;/job-detail&gt;<br/><br/>
   &lt;trigger&gt;
    &lt;cron&gt;
     &lt;name&gt;printJobInfoTrigger&lt;/name&gt;
     &lt;group&gt;DEFAULT&lt;/group&gt;
     &lt;job-name&gt;PrintInfoJob&lt;/job-name&gt;
     &lt;job-group&gt;DEFAULT&lt;/job-group&gt;<br/><br/>
      &lt;!-- Fire 7:30am Monday through Friday --&gt;
     &lt;cron-expression&gt;0 30 7 ? * MON-FRI&lt;/cron-expression&gt;
    &lt;/cron&gt;
   &lt;/trigger&gt;
  &lt;/job&gt;
&lt;/quartz&gt;</pre>
<br/>
代码  5.3 中的 Cron 表达式与 代码 5.1 中。当 Quartz 加载这个 XML 后，就会安排 <span style="color: #800080;">PrintInfoJob</span> (也已在 XML  中列出) 在从星期一到星期五的早上 7:30 执行。关于 <span style="color: #800080;">JobInitializationPlugin</span> 更多的说明见第八章。
