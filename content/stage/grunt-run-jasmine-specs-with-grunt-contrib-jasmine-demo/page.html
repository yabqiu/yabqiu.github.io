---
title: "Grunt 运行 Jasmine 测试: grunt-contrib-jasmine-示例"
url: /grunt-run-jasmine-specs-with-grunt-contrib-jasmine-demo/
date: 2014-04-19T05:11:04-05:00
featured: false
draft: true
toc: false
# menu: main
usePageBundles: true
thumbnail: "../images/logos/http://unmi.cc/wp-content/uploads/2014/04/jasmine_logo.png"
categories:
  - NodeJS
tags: 
  - Grunt
  - Jasmine
  - npm
  - NodeJS
comment: true
codeMaxLines: 50
# additional
wpPostId: 6342 
wpStatus: publish
views: 1269
lastmod: 2015-01-15T13:43:40-06:00
---

上一篇是 <a title="Grunt 运行 Jasmine 测试用例: grunt-contrib-jasmine-实例" href="http://unmi.cc/grunt-run-jasmine-specs-with-grunt-contrib-jasmine-example/" target="_blank">Grunt 运行 Jasmine 测试用例: grunt-contrib-jasmine-实例</a>，本篇叫做示例。其竟在于对 <a href="https://github.com/jsoverson/grunt-contrib-jasmine-example" target="_blank">grunt-contrib-jasmine-example</a> 的简单的窥探，进而自己的项目中可以如何如何。<br/>
<br/>
如果剔除该项目的几个外围文件，就只下面的结构了<br/>
<pre class="brush:text">├── Gruntfile.js<br/>
├── package.json<br/>
├── spec<br/>
│   ├── PlayerSpec.js<br/>
│   └── SpecHelper.js<br/>
└── src<br/>
    ├── Player.js<br/>
    └── Song.js</pre>

这算是一个最简单的 Jasmine 项目布局了。各位可以自己去查看上面的 <code>Gruntfile.js</code> 和 <code>package.json</code> 的内容，我这里自己来亲自打造一个比这还更简单的项目来，把原来的 jshint 任务也拿掉了。<br/>
<br/>
<span style="color: #0000ff;"><strong>1. 首先创建项目目录 TestJasmine</strong></span><!--more--><br/>
<br/>
<strong><span style="color: #0000ff;">2. 在其中创建 <code>package.json</code> 文件</span></strong>，内容基本不能再节俭了<br/>
<pre class="brush:js">{<br/>
 "name": "TestJasmine",<br/>
 "version": "0.1.0"<br/>
}</pre>

<span style="color: #0000ff;"><strong>3. 加入 <code>grunt-contrib-jasmine</code> 依赖</strong></span>，通过运行 <code>npm install grunt-contrib-jasmine --save-dev</code> , 这时候  package.json 中的内容变成<br/>
<pre class="brush:js">{<br/>
  "name": "TestJasmine",<br/>
  "version" : "0.1.0",<br/>
  "devDependencies": {<br/>
    "grunt-contrib-jasmine": "~0.6.3"<br/>
  } <br/>
}</pre>

<span style="color: #0000ff;"><strong>4. 创建 Gruntfile.js 文件</strong></span>，不需要单独运行 <code>npm install</code> 命令了，Gruntfile.js 的内容<br/>
<pre class="brush:js">module.exports = function(grunt) {<br/>
  'use strict';<br/>
<br/>
  // Project configuration.<br/>
  grunt.initConfig({<br/>
    jasmine : {<br/>
      src : 'src/**/*.js',<br/>
      options : {<br/>
        specs : 'spec/**/*.js',<br/>
        keepRunner: true<br/>
      }<br/>
    }<br/>
 });<br/>
<br/>
  grunt.loadNpmTasks('grunt-contrib-jasmine');<br/>
<br/>
  grunt.registerTask('test', ['jasmine']);<br/>
  grunt.registerTask('default', ['test']);<br/>
};</pre>

现在 Gruntfile.js 和 package.json 都有了，就差实际的项目文件了。这里继续发扬一切从俭的原则，坚决不让火葬比土葬的成本还高，对大自然造成的危害更大。<br/>
<br/>
<span style="color: #0000ff;"><strong>5. 创建待测试代码 src/Animals.js</strong></span>，内容为<br/>
<pre class="brush:js">var panda = 'happy';<br/>
var bear = 'sad';</pre>

<span style="color: #0000ff;"><strong>6. 创建 spec/AnimalsSpec.js</strong></span>, 内容为<br/>
<pre class="brush:js">describe('Animals',function(){<br/>
  it('Panda is happy',function(){<br/>
    expect(panda).toBe('happy');<br/>
  });<br/>
<br/>
  it('Bear is happy like the panda',function(){<br/>
    expect(bear).toBe('happy');<br/>
  });<br/>
});</pre>

至于 Jasmine 的 Spec 怎么写这里就不作交待了，模式就是 describe..it..expect..toBeXxx()，能够作什么样的断言请查找 Jasmine 相关资料 <a href="http://jasmine.github.io/2.0/introduction.html" target="_blank">http://jasmine.github.io/2.0/introduction.html</a>。<br/>
<br/>
<span style="color: #0000ff;"><strong>7. 运行 grunt test</strong></span>，结果如下<br/>
<br/>
<img class="aligncenter size-full wp-image-6350" src="http://unmi.cc/wp-content/uploads/2014/04/grunt-jasmine-test-animals.png" alt="grunt-jasmine-test-animals" width="860" height="486" /><br/>
<br/>
这里一个 Warning: Task "jasmine:src" failed, 尚不知为何。<br/>
<br/>
总之现在测试有失败的，我们打开生成的 _SpecRunner.html 来看看<br/>
<br/>
<a href="http://unmi.cc/wp-content/uploads/2014/04/grunt-jasmine-failure.png"><img class="aligncenter wp-image-6351" src="http://unmi.cc/wp-content/uploads/2014/04/grunt-jasmine-failure-1024x441.png" alt="grunt-jasmine-failure" width="800" height="345" /></a><br/>
<br/>
首先展示出的是错误用例的页面，可以切到 Spec List 页面<br/>
<br/>
<a href="http://unmi.cc/wp-content/uploads/2014/04/grunt-jasmine-specs.png"><img class="aligncenter wp-image-6352" src="http://unmi.cc/wp-content/uploads/2014/04/grunt-jasmine-specs-1024x215.png" alt="grunt-jasmine-specs" width="800" height="168" /></a><br/>
<br/>
我们也可以在生成的 _SpecRunner.html 中直接运行测试用例，修改测试后，刷新页面会运行所有的测试，点击 Animals 这个 Spec 就会重跑 Animals 这里的测试。<br/>
<br/>
接下来就是它怎么与持续构建工具，如 Jenkins 怎么集成的问题。还有怎么生成测试覆盖报告，这可以用 <a href="https://github.com/gotwarlost/istanbul" target="_blank">istanbul</a> 这个工具，也能与 Jasmine 联结起来，通过 <a href="https://github.com/maenu/grunt-template-jasmine-istanbul" target="_blank">https://github.com/maenu/grunt-template-jasmine-istanbul</a>。<br/>
<br/>
参考：1. <a href="https://github.com/gruntjs/grunt-contrib-jasmine" target="_blank">https://github.com/gruntjs/grunt-contrib-jasmine</a><br/>
2. <a href="https://github.com/jsoverson/grunt-contrib-jasmine-example" target="_blank">https://github.com/jsoverson/grunt-contrib-jasmine-example</a><br/>
3. <a href="https://github.com/jasmine-contrib/grunt-jasmine-runner" target="_blank">https://github.com/jasmine-contrib/grunt-jasmine-runner</a><br/>
4. <a href="https://github.com/maenu/grunt-template-jasmine-istanbul" target="_blank">https://github.com/maenu/grunt-template-jasmine-istanbul</a><br/>
5. <a href="https://github.com/gotwarlost/istanbul" target="_blank">https://github.com/gotwarlost/istanbul</a><br/>
6. <a href="http://www.zealake.com/2013/04/07/run-all-your-javascript-jasmine-tests-on-every-commit/" target="_blank">Run all your JavaScript Jasmine tests on every commit</a>
