---
title: 用JCoverage生成测试覆盖率报告(二 build文件)
url: /jcoverage-report-build-file/
date: 2006-01-03T10:45:00-06:00
featured: false
draft: true
type: post
toc: false
# menu: main
usePageBundles: true
categories:
  - Java/JEE
tags: 
  - JCoverage
  - Unit Test
  - Coverage
comment: true
codeMaxLines: 50
# additional
wpPostId: 602 
wpStatus: publish
views: 579
lastmod: 2021-09-03T10:53:16-05:00
---

下面的那一大段build.xml文件内容主要也是参考下载过来的JCoverage中的一个例子中的build文件，只是稍稍作了点修改，用下面这个build文件前，需要把JCoverage用到的 jar (下载的JCoverage中都有) 包拷到工程目录下lib子目录中，请注意理解其中的注解，以后必要时会加上更详细的中文注释。 <!--more--></p>
<br/>
<pre class="lang:default decode:true">&lt;?xml version="1.0" encoding="gb2312"?&gt; <br/><br/>
&lt;project name="jcoverage.examples" default="main" basedir="."&gt; <br/><br/>
  &lt;!--
    all build artefacts are deposited under this directory.
  --&gt;
  &lt;property name="build.dir" value="${basedir}/build"/&gt; <br/><br/>
  &lt;!--
    classes generated by the javac compiler are deposited in this
    directory.
  --&gt;
  &lt;property name="build.classes.dir" value="${build.dir}/classes"/&gt; <br/><br/>
  &lt;!--
    instrumented classes are deposited into this directory.
  --&gt;
  &lt;property name="build.instrumented.dir" value="${build.dir}/instrumented-classes"/&gt; <br/><br/>
  &lt;!--
    coverage reports are deposited into this directory. For the
    HTML report, look at ${build.coverage.dir}/index.html. For the XML
    report look at ${build.coverage.dir}/coverage.xml.
  --&gt;
  &lt;property name="build.coverage.dir" value="${build.dir}/coverage"/&gt; <br/><br/>
  &lt;!--
    unit test reports from junit are deposited in this directory.
  --&gt;
  &lt;property name="build.reports.dir" value="${build.dir}/reports"/&gt; <br/><br/>
  &lt;!--
    third party libraries that are also shipped with jcoverage can be
    found in this directory.
    JCoverageLib directory contains bcel.jar, jakarta-oro-2.0.7.jar
    java-getopt-1.0.9.jar, jcoverage.jar, junit,log4j-1.2.8.jar
  --&gt;
  &lt;property name="jcoverage.lib.dir" value="${basedir}/JCoverageLib"/&gt; <br/><br/>
  &lt;!--
    the source code for the examples can be found in this directory.
  --&gt;
  &lt;property name="src.dir" value="${basedir}/src"/&gt; <br/><br/>
  &lt;target name="main" depends="clean,init,compile,instrument,test,coverage" description="clean build, instrument and unit test"/&gt; <br/><br/>
  &lt;!-- libraries path, can define a universal classpath as below
  &lt;path id="junit"&gt;
    &lt;fileset dir="${lib.dir}"&gt;
      &lt;include name="junit/3.8.1/*.jar"/&gt;
    &lt;/fileset&gt;
  &lt;/path&gt; <br/><br/>
  &lt;path id="log4j"&gt;
    &lt;fileset dir="${lib.dir}"&gt;
      &lt;include name="log4j/1.2.8/*.jar"/&gt;
    &lt;/fileset&gt;
  &lt;/path&gt; <br/><br/>
  &lt;path id="jcoverage"&gt;
    &lt;fileset dir="${dist.dir}"&gt;
      &lt;include name="jcoverage.jar"/&gt;
    &lt;/fileset&gt;
  &lt;/path&gt;
  --&gt; <br/><br/>
  &lt;!--
    define class path for all the library needed
  --&gt;
  &lt;path id="jcoverage.class.path"&gt;
    &lt;fileset dir="${jcoverage.lib.dir}"&gt;
        &lt;include name="*.jar"/&gt;
    &lt;/fileset&gt;
  &lt;/path&gt;
　
  &lt;!-- 现在还不知道resource指定的tasks.properties(不存在)是做什么用的 --&gt;
  &lt;taskdef classpathref="jcoverage.class.path" resource="tasks.properties"/&gt; <br/><br/>
   &lt;target name="clean" description="clean up build artefacts"&gt;
    &lt;delete quiet="true"&gt;
      &lt;fileset dir="${build.dir}"/&gt;
      &lt;fileset dir="${basedir}"&gt;
        &lt;include name="jcoverage.ser"/&gt;
        &lt;include name="jcoverage.log"/&gt;
      &lt;/fileset&gt;
    &lt;/delete&gt;
  &lt;/target&gt; <br/><br/>
  &lt;target name="init" description="create build directories"&gt;
    &lt;mkdir dir="${build.dir}"/&gt;
    &lt;mkdir dir="${build.classes.dir}"/&gt;
    &lt;mkdir dir="${build.coverage.dir}"/&gt;
    &lt;mkdir dir="${build.instrumented.dir}"/&gt;
    &lt;mkdir dir="${build.reports.dir}"/&gt;
  &lt;/target&gt; <br/><br/>
  &lt;target name="compile" description="compile all classes"&gt;
    &lt;javac srcdir="${src.dir}" destdir="${build.classes.di*}" **ilonerror="yes" debug="yes"&gt;
      &lt;!--
      &lt;classpath refid="junit"/&gt;
      &lt;classpath refid="log4j"/&gt;
      --&gt;
      &lt;classpath refid="jcoverage.class.path"/&gt;
    &lt;/javac&gt;
  &lt;/target&gt; <br/><br/>
  &lt;target name="instrument" description="Add jcoverage instrumentation"&gt;
    &lt;!--
      instrument the application classes, writing the instrumented
      classes into ${build.instrumented.dir}.
    --&gt;
    &lt;instrument todir="${build.instrumented.dir}"&gt;
      &lt;!--
        Note that the following line causes instrument to ignore any
        source line containing a reference to log4j, for the purposes
        of coverage reporting.
      --&gt;
      &lt;ignore regex="org.apache.log4j.*"/&gt; <br/><br/>
      &lt;fileset dir="${build.classes.dir}"&gt;
        &lt;!--
          instrument all the application classes, but don't instrument
          the test classes.
        --&gt;
        &lt;include name="**/*.clas*"/&gt;
        &lt;**clude name="**/*Test.class"/&gt;
      &lt;/fileset&gt;
    &lt;/instrument&gt;
  &lt;/target&gt; <br/><br/>
  &lt;target name="test" description="Unit test the application"&gt;
    &lt;junit fork="yes" dir="${basedir}" errorProperty="test.failed" failureProperty="test.failed"&gt;
      &lt;!--
        note the classpath order, instrumented classes are before the
        original (uninstrumented) classes.
      --&gt;
      &lt;classpath location="${build.instrumented.dir}"/&gt;
      &lt;classpath location="${build.classes.dir}"/&gt; <br/><br/>
      &lt;!--
        the instrumented classes reference classes used by the
        jcoverage runtime.
      --&gt;
      &lt;!--
      &lt;classpath refid="jcoverage"/&gt;
      --&gt;
      &lt;classpath refid="jcoverage.class.path"/&gt;   <br/><br/>
      &lt;formatter type="xml"/&gt; <br/><br/>
      &lt;batchtest todir="${build.reports.dir}"&gt;
        &lt;fileset dir="${src.dir}"&gt;
          &lt;include name="**/*Test.java"/&gt;
        &lt;/fileset&gt;
      &lt;/batchtest&gt;
    &lt;/junit&gt;
  &lt;/target&gt; <br/><br/>
  &lt;target name="coverage" description="HTML and XML coverage reports can be found in build/coverage"&gt;
    &lt;report srcdir="${src.dir}" destdir="${build.coverage.dir}"/&gt;
    &lt;report srcdir="${src.dir}" destdir="${build.coverage.dir}" format="xml"/&gt;
  &lt;/target&gt;
&lt;/project&gt;</pre>
<br/>
下面也许有必要粘贴一些用JCoverage生成的覆盖率报告界面图来。
