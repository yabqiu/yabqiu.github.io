---
title: 用 SyntaxHighlighter Evolved 作为自已的代码加亮插件
url: /wordpress-use-syntaxhighlighter-evolved/
date: 2010-08-07T08:32:30-05:00
featured: false
draft: true
type: post
toc: false
# menu: main
usePageBundles: true
categories:
  - WordPress
tags: 
  - wordpress
  - Highlighter
comment: true
codeMaxLines: 50
# additional
wpPostId: 105 
wpStatus: publish
views: 1476
lastmod: 2010-08-25T12:55:41-05:00
---

敝人的博客常常要贴程序代码，因而装个合适的语法加亮的插件是必不可少的。可以预见得到的是基本上各种语法加亮的插件都是源自于 Google 上的一个项目 <a href="http://code.google.com/p/syntaxhighlighter/" target="_blank">SyntaxHighlighter</a>. 但具体选用哪一个却要好自体验斟酌的。有几篇很好的文章可参考下：<br/>
<br/>
<a href="http://dddspace.com/2010/03/guide-to-find-a-wordpress-syntax-highlighter-that-works-translation.html">1. WordPress代码高亮插件指南[译文]</a><br/>
<a href="http://www.forece.net/post/2454.htm" target="_blank">2. Wordpress 高亮代码显示插件 – SyntaxHighlighter Evolved</a><br/>
<a href="http://hzhawk.cjlu.edu.cn/coding/wordpress-ckeditor-codecolorer/" target="_blank">3. 让 WordPress 下 CKEditor 支持 CodeColorer</a>,<br/>
<a href="http://www.seoxj.com/wordpress-wp-codebox-141/" target="_blank">4. wordpress代码高亮插件wp-codebox使用方法(语法详解)</a>。<br/>
<br/>
怎么着那都是他人之言了，自己试了才知究意，我就说说 SyntaxHighlighter Evolved 吧，我正用着的。之前在 http://unmi.blogjava.net 的博客我往日志中嵌入代码的方式是 &lt;textarea name=code class=php&gt;&lt;/textarea&gt; 来写的，这样在 textarea 中代码能保持原有的格式，该有的空格都在，那是因为那边的编辑器支持的好，<!--more-->换作 WordPress 的 tinyMCE 用 &lt;textarea&gt; 就让人失望了，不仅代码全乱，拷贝的时候还弄些 &lt;br/&gt;，&lt;p&gt; 等进去。SyntaxHighlighter Evolved 推荐的方式是用 Shortcode，如代码写在 [ php] 和 [ /php] 之间，优点是不用切换到 HTML 模式下，而一个致命的缺点就是 TinyMCE 会无端的把程序代码中的缩进空格给去了，因为 html 代码中是不认这种软空格的。还好可以用 &lt;pre&gt; 标签，它能很好的保持代码风格，虽然在 TinyMCE 中点到 [ php]  上状态栏的 Path: 中也可能显示为 &lt;pre&gt;，但你仍然必须切换到 HTML 模式下手工输入 &lt;pre&gt;，然后往其中贴上代码。<br/>
<br/>
因为受以前用 SyntaxHighlighter 的印象，还以为也要写成 &lt;pre name="code"&gt;&lt;/pre&gt; 的方式，但是 TinyMCE 会把 name="code" 属性给去了。有两篇文章说了怎么让 TinyMCE 保留 &lt;pre&gt; 的 name 属性：<a href="http://wordpress.org/support/topic/plugin-google-syntax-highlighter-for-wordpress-tinymce-strips-namecode-part-when-going-to-design-view" target="_blank"></a><br/>
<br/>
<a href="http://wordpress.org/support/topic/plugin-google-syntax-highlighter-for-wordpress-tinymce-strips-namecode-part-when-going-to-design-view" target="_blank">1. Google Syntax Highlighter for WordPress] tinyMCE strips {name='code'} part when going to de</a>,<a href="http://www.gosoa.com.cn/google-syntax-highlighter-与wordpress-tinymce-的兼容性/" target="_blank"><br/>
2. Google Syntax Highlighter 与WordPress – tinyMCE 的兼容性</a><br/>
<br/>
它们说是要在 wp-admin/includes/post.php 文件中，给数组 $initArray 再加一项 'extended_valid_elements' =&gt; "pre[name|class]" 就行。其实对于 SyntaxHighlighter Evolved 来说是多虑了，它不依赖于 &lt;pre&gt; 的 name 属性，写成 &lt;pre class="brush:php"&gt;...&lt;/pre&gt; 即可，&lt;pre&gt; 可以认识连续的空格的。<br/>
<br/>
因为 &lt;pre&gt; 是个不可见的标签，所以切换到 HTML 下输入时在其中放个字母才好在可视界面下定位，如 &lt;pre class="brush:php"&gt;d&lt;/pre&gt;，可视界面下用你的内容换掉 d 就是了。如何知道你的内容是不是真的在 &lt;pre&gt; 之间呢，可看空格是不还在，我有个想法就是给 TinyMCE 的 &lt;pre&gt; 标签加个很容易分辨出来的样式，比如&lt;pre&gt; 中的内容用什么字体，字体颜色等。<br/>
<br/>
这很容易做到，修改样式文件 wp-includes/js/tinymce/themes/advanced/skins/wp_theme/content.css，找到代码：<br/>
<pre class="brush:css">pre {<br/>
    font: 12px/18px Consolas, Monaco, "Courier New", Courier, monospace;<br/>
}</pre>

把这段针对 TinyMCE 编辑器中的 pre 标签的样式改为<br/>
<pre class="brush:css">pre {<br/>
    font: 12px/18px Consolas, Monaco, "Courier New", Courier, monospace;<br/>
<br/>
    /** Following two lines are added by Unmi **/<br/>
    color: #800080;<br/>
    font-style:italic;<br/>
    border-color : #88A9FF;<br/>
    border-width : 1px;<br/>
    border-style : dotted;<br/>
}</pre>

下图就是应用了这个 pre 样式时，在 TinyMCE 里编辑源代码时的界面，很明显的看出哪些内容是在 &lt;pre&gt; 标签里的，有框有字体：<br/>
<br/>
<img class="aligncenter" style="border: 0px;" src="http://unmi.cc/wp-content/uploads/2010/08/TinyMCE_SyntaxHighlighter.jpg" alt="" width="767" height="396" /><br/>
<br/>
有了上图的话，下面这段话也是重复了。但是在 FireFox 下还是有些讨厌，代码中每行的前导空格同样会去掉，如四个空格变成一个，再多空格只被认为是一个。所以往 TinyMCE 贴源代码时尽量使用 IE 吧。<br/>
<br/>
就可以很清晰的在 TinyMCE 编辑器中看出那块是放在 &lt;pre&gt; 标签中的代码，方便直接编辑。只是要不时的切换到 HTML 模式来输入 &lt;pre&gt; 稍觉麻烦，还须对 TinyMCE 进一步扩展，比如加个工具按钮，一点击再选择语言就在当前位置加上了 &lt;pre class="brush:所选语言"&gt;Here&lt;/pre&gt; 就更顺心了。
