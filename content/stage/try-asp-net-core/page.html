---
title: .NET Core 上的 Web -- ASP.NET Core
url: /try-asp-net-core/
date: 2016-09-03T00:16:39-05:00
featured: false
draft: true
type: post
toc: false
# menu: main
usePageBundles: true
categories:
  - .Net
tags: 
  - .NET Core
  - dotnet
comment: true
codeMaxLines: 50
# additional
wpPostId: 7408 
wpStatus: publish
views: 348
lastmod: 2022-03-10T00:02:43-06:00
---

.NET Core 上不光可以做控制台的程序, 还可也实现 AST.NET 的 Web 应用, 而且是自带服务器的那种. 像 NodeJS, Spring Boot, Netty 那种非容器型的嵌入式的 Web Server, 非常适合于做微服务应用. 谁说 ASP.NET 就一定要部署到 IIS 上呢?</p>
<br/>
本文参考 <a href="https://docs.asp.net/en/latest/getting-started.html">https://docs.asp.net/en/latest/getting-started.html</a> 而来, 基本步骤是一致的<br/><br/>
<h3>1. 安装 .NET Core</h3><br/><br/>
参考上一篇 <a href="http://unmi.cc/net-core-console-hello-world/">.NET Core 上手体验 Hello World</a><br/><br/>
<h3>2. 创建 .NET Core 项目</h3><br/><br/>
<blockquote>
mkdir appnetcoreapp<br />
cd aspnetcoreapp<br />
dotnet new
</blockquote>
<br/>
<h3>3. 更新 <code>project.json</code> 引入 Kestrel HTTP server 依赖</h3><br/><br/>
<!--more--><br/><br/>
<pre class="brush:c#;highlight:15">{
  "version": "1.0.0-*",
  "buildOptions": {
    "debugType": "portable",
    "emitEntryPoint": true
  },
  "dependencies": {},
  "frameworks": {
    "netcoreapp1.0": {
      "dependencies": {
        "Microsoft.NETCore.App": {
          "type": "platform",
          "version": "1.0.0"
        },
        "Microsoft.AspNetCore.Server.Kestrel": "1.0.0"
      },
      "imports": "dnxcore50"
    }
  }
}
</pre>
<br/>
<h3>4. 恢复包 -- 依据 package.json 恢复项目依赖, 生成在  package.lock.json 文件中</h3><br/><br/>
<blockquote>
dotnet restore
</blockquote>
<br/>
这一步由 <code>package.json</code> 确定好了 <code>package.lock.json</code> 之好, 才有可能在 IDE 中引入该项目, 使用所依赖的类. 或者 <code>dotnet run</code> 编译时也需要用到 <code>package.lock.json</code> 文件.<br/><br/>
<h3>5. 添加 <code>Startup.cs</code> 定义最简单的请求逻辑</h3><br/><br/>
<pre class="lang:default decode:true ">using System;
using Microsoft.AspNetCore.Builder;
using Microsoft.AspNetCore.Hosting;
using Microsoft.AspNetCore.Http;<br/><br/>
namespace aspnetcoreapp
{
    public class Startup
    {
        public void Configure(IApplicationBuilder app)
        {
            app.Run(context =&gt;
            {
                return context.Response.WriteAsync("Hello from ASP.NET Core!");
            });
        }
    }
}
</pre>
<br/>
<h3>6. 修改 <code>Program.cs</code> 使之启动一个 Web 服务</h3><br/><br/>
<pre class="lang:default decode:true">using System;
using Microsoft.AspNetCore.Hosting;<br/><br/>
namespace aspnetcoreapp
{
    public class Program
    {
        public static void Main(string[] args)
        {
            var host = new WebHostBuilder()
                .UseKestrel()
                .UseStartup()
                .Build();<br/><br/>
            host.Run();
        }
    }
}
</pre>
<br/>
<h3>7. 用 <code>dotnet run</code> 启动 Web 服务</h3><br/><br/>
<blockquote>
➜ aspnetcoreapp$ <span style="color: #800000;">dotnet run</span><br />
Project aspnetcoreapp (.NETCoreApp,Version=v1.0) was previously compiled. Skipping compilation.<br />
Hosting environment: Production<br />
Content root path: /Users/Yanbin/Desktop/aspnetcoreapp/bin/Debug/netcoreapp1.0<br />
Now listening on: http://localhost:5000<br />
Application started. Press Ctrl+C to shut down.
</blockquote>
<br/>
<h3>8 访问服务 http://localhost:5000</h3><br/><br/>
<blockquote>
➜ aspnetcoreapp$ <span style="color: #800000;">curl -i http://localhost:5000</span><br />
HTTP/1.1 200 OK<br />
Date: Sat, 03 Sep 2016 05:09:33 GMT<br />
Transfer-Encoding: chunked<br />
Server: Kestrel
Hello from ASP.NET Core!
</blockquote>
<br/>
Server 是 <code>Kestrel</code>, 没实现路由, 不管你访问 http://localhost:5000 下的什么都是显示一样的内容. 其他的是高级内容, 诸如路由, 静态文件, 国际化, 错误处理, MVC 等. ASP.NET Core 项目可以被部署到许多地方, 例如 IIS, Docker, Azure 等.<br/><br/>
附录: 1. <a href="https://docs.asp.net/en/latest/">ASP.NET Core Documentation</a>
