---
title: Vimer 的福音：Mac 下 Caps + hjkl 作为方向键
url: /vimer-mac-caps-hjkl-as-arrow-keys/
date: 2017-07-25T03:13:26-05:00
featured: false
draft: true
type: post
toc: false
# menu: main
usePageBundles: true
categories:
  - Vim
tags: 
  - mac
  - vim
comment: true
codeMaxLines: 50
# additional
wpPostId: 8167 
wpStatus: publish
views: 3958
lastmod: 2021-07-14T21:33:37-05:00
---

本人所用的键盘是 <a href="http://www.wasdkeyboards.com/index.php/products/mechanical-keyboard/wasd-vp3-61-key-custom-mechanical-keyboard.html">WASD VP3 61 Key</a> 的 -- Poker 3 方案，可以不借助于软件直接键盘上设置为 Caps + hjkl 来作为方向键。Caps 跳线为 Fn, 并选择一个 Layer, 把原本 Fn + ijkl 的方向键组合键重新映射为 Fn + hjkl 即可。<br/><br/>
办公室的 61 键的键盘借于朋友体验，所以又重新把 DAS 87 键摆了出来。由于习惯了 61 键的 Caps + hjkl 的方向键，在 87 键盘上每次按方向键时右手都要离开它的 Home Row，很是不爽。别说是 87 键，即便是有些键盘把方向键压缩在右 Shift 下方，都无法接受右手右下移去按方向键。<br/><br/>
Caps 键没什么卵用(只会用 Caps 来输入大写字母的当我没说)，却常年占据着黄金位置(左手掌无需移动就能按到)，所以主意是如何把 Caps 另作他们，对于 Vimer 来说最理想的方向键是 Caps + hjkl。<br/><br/>
Mac 下有个键盘映射的工具 Karabiner, 先前的版本 KeyRemap4MacBook 只支持到 Mac OS 10.8, 而 Karabiner 也只能支持 10.9 到 10.11。而我的 Mac 系统是 macOS Sierra 10.12, 有一个不完全特性的 Karabiner 叫做 <a href="https://github.com/tekezo/Karabiner-Elements/blob/master/README.md">Karabiner-Elements</a>, 它不能像 KeyRemap4MacBook 和 Karabiner 那样支持直接组合键的映射。因此在 macOS Sierra 一直未能把方向键映射成某个功能键(如 Caps) + hjkl，不得不用物理方向键。<br/><br/>
有两种方法把 Caps + hjkl 映射为方向键<br/><br/>
<!--more--><br/><br/>
<h3>一：启用 "Change right_command+hjkl to arrow keys" 规则，并把  caps_lock 映射为 right_command</h3><br/><br/>
我一直在紧跟着最新的 Karabiner-Elements 版本(截止到2017-07-25 时版本为 0.91.9)，今天偶然间发现 Karabiner-Elements 配置中多了一个 Complex Modifications 选项卡，点 "Add rule" 可以看到三个规则实例，<br/><br/>
<a href="https://yanbin.blog/wp-content/uploads/2017/07/Karabiner-Elements-arrow-1.png"><img class="aligncenter wp-image-8168 size-large" src="https://yanbin.blog/wp-content/uploads/2017/07/Karabiner-Elements-arrow-1-800x464.png" alt="" width="800" height="464" /></a><br/><br/>
从按钮 "Import more rules from the Internet (open a web browser)" 可以找到更多的规则配置，其中有一个 Vi Mode 的规则，使用 S 或 D 作为  Trigger Key, 再配合 hjkl 作为方向键，这仍然不是我想要的。<br/><br/>
实际我相当的规则是 "Change right_command+hjkl to arrow keys", 所以启用这个规则。别急，我们并不打算真正光用右手大拇指按住 command 键，同手右手按 hjkl 来使用方向键，反正就是右手腕别扭不过来。<br/><br/>
所以下一步就是要把 Caps 嫁接到 right_command 上来，使用基本的 "Simple Modifications" 中的功能，只需加上一行 "caps_lock" 到 "right_command" 的映射<br/><br/>
<a href="https://yanbin.blog/wp-content/uploads/2017/07/Karabiner-Elements-arrow-2-1.png"><img class="aligncenter wp-image-8170 size-large" src="https://yanbin.blog/wp-content/uploads/2017/07/Karabiner-Elements-arrow-2-1-800x464.png" alt="" width="800" height="464" /></a><br/><br/>
其余三个是键映射与 Caps + hjkl 用作方向键无关。<br/><br/>
至此我们就可以在任何键盘上欢快的使用 Caps + hjkl 作为方向键，铵方向键时再也不需要让右手掌作半点移动了。<br/><br/>
<h3>二：认识 Karabiner 规则文件</h3><br/><br/>
Karabiner-Elements 的配置文件是 ~/.config/karabiner/karabiner.json，前面图形界面中配置的规则会产生如下的相应内容：<br/><br/>
<pre class="brush:xml ">    "profiles": [
        {
            "complex_modifications": {
                "parameters": {
                    "basic.to_if_alone_timeout_milliseconds": 1000
                },
                "rules": [
                    {
                        "description": "Change right_command+hjkl to arrow keys",
                        "manipulators": [
                            {
                                "from": {
                                    "key_code": "h",
                                    "modifiers": {
                                        "mandatory": [
                                            "right_command"
                                        ],
                                        "optional": [
                                            "any"
                                        ]
                                    }
                                },
                                "to": [
                                    {
                                        "key_code": "left_arrow"
                                    }
                                ],
                                "type": "basic"
                            },
                            {
                                "from": {
                                    "key_code": "j",
                                    "modifiers": {
                                        "mandatory": [
                                            "right_command"
                                        ],
                                        "optional": [
                                            "any"
                                        ]
                                    }
                                },
                                "to": [
                                    {
                                        "key_code": "down_arrow"
                                    }
                                ],
                                "type": "basic"
                            },
                            {
                                "from": {
                                    "key_code": "k",
                                    "modifiers": {
                                        "mandatory": [
                                            "right_command"
                                        ],
                                        "optional": [
                                            "any"
                                        ]
                                    }
                                },
                                "to": [
                                    {
                                        "key_code": "up_arrow"
                                    }
                                ],
                                "type": "basic"
                            },
                            {
                                "from": {
                                    "key_code": "l",
                                    "modifiers": {
                                        "mandatory": [
                                            "right_command"
                                        ],
                                        "optional": [
                                            "any"
                                        ]
                                    }
                                },
                                "to": [
                                    {
                                        "key_code": "right_arrow"
                                    }
                                ],
                                "type": "basic"
                            }
                        ]
                    }
                ]
            },
            "simple_modifications": {
                "caps_lock": "right_command",<br/><br/>
</pre>
<br/>
看到这里我们应该能意识到，其实从技术上并不需要先启用 "Change right_command+hjkl to arrow keys" 规则，然后把 "caps_lock" 映射为 "right_command" 两步。<br/><br/>
那么我们去掉 "simple_modifications" 中的 "caps_lock" 到 "right_command" 映射，直接把规则 "Change right_command+hjkl to arrow keys" 中所有 "right_command" 修改为 "caps_lock" 行不行呢？像下面那样修<br/><br/>
<pre class="brush:xml">"modifiers": {
    "mandatory": [
        "right_command"
    ]</pre>
<br/>
改成<br/><br/>
<pre class="brush:xml">"modifiers": {
    "mandatory": [
        "caps_lock"
    ]</pre>
<br/>
这样做的话，会有一定的功效，每按一次 caps_lock + hjkl 组合后都必须抬起键，不能一直按着 caps_lock 然后做用 hjkl 作为方向键，因为此时的 caps_lock 仍然担当着原来的 caps_lock 职责，等于是双重功能。<br/><br/>
所以有一个解决的办法是，仍然保留 "right_command" + "hjkl" 的方向键功能，只是在规则文件中再加一个 "caps_lock" 到  "right_command" 的映射，效果上是一样的，只是在 Simple Modifications 中并不要 "caps_lock" 到 "right_command"  的映射条目。<br/><br/>
最后的效果就是<br/><br/>
<a href="https://yanbin.blog/wp-content/uploads/2017/07/Karabiner-Elements-arrow-3.png"><img class="aligncenter wp-image-8172 size-large" src="https://yanbin.blog/wp-content/uploads/2017/07/Karabiner-Elements-arrow-3-800x464.png" alt="" width="800" height="464" /></a><br/><br/>
有这一个规则就足矣。基于此我定制了一个规则文件<a href="https://yanbin.blog/wp-content/uploads/2017/07/caps_lock_hjkl_to_arrow_keys.json">Change caps_lock + hjkl to arrow_keys</a>，也就是用下面的方式一次性导入即可。<br/><br/>
<h3>三：直接导入我定制的 Change caps_lock + hjkl to arrow keys 规则</h3><br/><br/>
既然我们可以从网络上导入规则，那么当然可以自己预先定制好自己的规则也像他们那样发布一个规则链接。于是我也做了一个 json 规则文件。<br/><br/>
请点击链接 <a href="karabiner://karabiner/assets/complex_modifications/import?url=https%3A%2F%2Fyanbin.blog%2Fwp-content%2Fuploads%2F2017%2F07%2Fcaps_lock_hjkl_to_arrow_keys.json">Change caps_lock + hjkl to arrow keys</a>, 应该会提示打开 Karabiner-Elements 应用<br/><br/>
<a href="https://yanbin.blog/wp-content/uploads/2017/07/Karabiner-Elements-arrow-4.png"><img class="aligncenter wp-image-8174 size-large" src="https://yanbin.blog/wp-content/uploads/2017/07/Karabiner-Elements-arrow-4-800x301.png" alt="" width="800" height="301" /></a><br/><br/>
用 Karabiner-Elements 打开该链接<br/><br/>
<a href="https://yanbin.blog/wp-content/uploads/2017/07/Karabiner-Elements-arrow-5.png"><img class="aligncenter wp-image-8175 size-large" src="https://yanbin.blog/wp-content/uploads/2017/07/Karabiner-Elements-arrow-5-800x464.png" alt="" width="800" height="464" /></a><br/><br/>
导入到 Karabiner-Elements 中<br/><br/>
<a href="https://yanbin.blog/wp-content/uploads/2017/07/Karabiner-Elements-arrow-6.png"><img class="aligncenter wp-image-8176 size-large" src="https://yanbin.blog/wp-content/uploads/2017/07/Karabiner-Elements-arrow-6-800x464.png" alt="" width="800" height="464" /></a><br/><br/>
现在可以随意的 Enable/Disable 规则 "Change caps_lock+hjkl to arrow keys" 了，启用后的效果与方法一中是一样的。<br/><br/>
链接：<br/><br/>
<ol>
    <li><a href="https://pqrs.org/osx/karabiner/complex_modifications/">Karabiner-Elements complex_modifications rules</a></li>
</ol>
