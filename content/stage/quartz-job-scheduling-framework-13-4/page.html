---
title: Quartz Job Scheduling Framework［翻译］第十三章. Quartz 和 Web 应用 (第四部分)
url: /quartz-job-scheduling-framework-13-4/
date: 2008-05-01T03:38:00-05:00
featured: false
draft: true
toc: false
# menu: main
usePageBundles: true
thumbnail: "../images/logos/https://yanbin.blog/wp-content/uploads/2007/10/quartz-logo.jpeg"
categories:
  - Quartz
tags: 
  - Quartz
  - 翻译
comment: true
codeMaxLines: 50
# additional
wpPostId: 406 
wpStatus: publish
views: 765
lastmod: 2021-09-02T14:43:29-05:00
---

<strong>五. 使用 <span style="color: #800080;">ServletContextListener</span></strong></p>
<br/>
很值得一提的是你可以配置和集成 Quartz 到 Web 应用的另一种方式。从 2.3 版本的 Servlet API 开始，你能创建监听器，由容器在其生命周期中的某个特定时间回调。其中的一个监听器接口叫做 <span style="color: #800080;">java.servlet.ServletContextListener</span>，它包括有两个方法：<br/><br/>
<span style="color: #800080;">public void contextInitialized(ServletContextEvent sce);<br />
public void contextDestroyed(ServeltContextEvent sce);<br />
</span><br />
容器会在启动和关闭的时候相应的调用这两个方法。这就可以在 <span style="color: #800080;">contextInitialized()</span> 方法中初始化 Quartz Scheduler，并通过 <span style="color: #800080;">contextDestroyed()</span> 方法关闭它。代码 13.5 描述了这种用法：<!--more--><br/><br/>
<strong>代码 13.5. <span style="color: #800080;">ServletContextListener</span> 也能被用于初始化 Quartz</strong><br/><br/>
<pre class="brush:java">import javax.servlet.ServletContext;
import javax.servlet.ServletContextEvent;
import javax.servlet.ServletContextListener;<br/><br/>
import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.quartz.SchedulerException;
import org.quartz.impl.StdSchedulerFactory;<br/><br/>
public class QuartzServletContextListener implements ServletContextListener {
    private static Log logger = LogFactory
              .getLog(QuartzServletContextListener.class);<br/><br/>
    public static final String QUARTZ_FACTORY_KEY =
         "org.quartz.impl.StdSchedulerFactory.KEY";<br/><br/>
    private ServletContext ctx = null;<br/><br/>
    private StdSchedulerFactory factory = null;<br/><br/>
    /**
     * Called when the container is shutting down.
     */
    public void contextDestroyed(ServletContextEvent sce) {
         try {
              factory.getDefaultScheduler().shutdown();
         } catch (SchedulerException ex) {
              logger.error("Error stopping Quartz", ex);
         }<br/><br/>
    }<br/><br/>
    /**
     * Called when the container is first started.
     */
    public void contextInitialized(ServletContextEvent sce) {<br/><br/>
         ctx = sce.getServletContext();<br/><br/>
         try {<br/><br/>
              factory = new StdSchedulerFactory();<br/><br/>
              // Start the scheduler now<br/><br/>
              factory.getScheduler().start();<br/><br/>
              logger.info("Storing QuartzScheduler Factory at"
                        + QUARTZ_FACTORY_KEY);<br/><br/>
              ctx.setAttribute(QUARTZ_FACTORY_KEY, factory);<br/><br/>
        } catch (Exception ex) {
              logger.error("Quartz failed to initialize", ex);
         }
    }
}</pre>
<br/>
正如我们在 <span style="color: #800080;">QuartzInitializerServlet</span> 中所做的，我们需要为这个监听器加入一些配置信息到 Web 部署描术文件(<span style="color: #800080;">web.xml</span>) 中。针对我们的监听器，我们需要加一个 <span style="color: #800080;">&lt;listener&gt;</span> 元素到部署描述中。如下片断中显示：<br/><br/>
<pre class="lang:default decode:true ">&lt;web-app&gt;
 &lt;listener&gt;
   &lt;listener-class&gt;
  org.cavaness.jobconsole.web.QuartzServletContextListener
  &lt;/listener-class&gt;
 &lt;/listener&gt;
 &lt;!--Other deployment descriptor info not shown --&gt;
&lt;/web-app&gt;</pre>
<br/>
<strong>·新的 <span style="color: #800080;">QuartzInitializerListener</span> 已加入到 Quartz 中</strong><br/><br/>
<span style="color: #800080;">ServletContextListener</span> 为顺应用户社区而来的呼声被加入到 Quartz 框架中。13.5 中的代码应当认为是一个例子，实际应用时你需要开发你自己的监听器。
