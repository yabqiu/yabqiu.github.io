---
title: "Python 包管理及虚拟环境的应用(四: conda)"
url: /python-package-manager-venv-virtualenv-4/
date: 2020-07-31T02:05:10-05:00
featured: false
draft: true
toc: false
# menu: main
usePageBundles: true
categories:
  - Python
tags: 
  - venv
  - pyvenv
comment: true
codeMaxLines: 50
# additional
wpPostId: 10438 
wpStatus: publish
views: 2267
lastmod: 2020-09-09T10:07:20-05:00
---

一年半以前写了关于 Python 包管理及虚拟环境系列<br/><br/>
<ol>
    <li><a href="https://yanbin.blog/python-package-manager-venv-virtualenv-1/"> Python 包管理及虚拟环境的应用(一: pip)</a></li>
    <li><a href="https://yanbin.blog/python-package-manager-venv-virtualenv-2/">Python 包管理及虚拟环境的应用(二: virtualenv)</a></li>
    <li><a href="https://yanbin.blog/python-package-manager-venv-virtualenv-3/">Python 包管理及虚拟环境的应用(三: pipenv)</a></li>
</ol>
<br/>
其中历数了 <code>virtualenv</code>, <code>python3 -m venv</code>, <code>pipenv</code>, 并提到了 <a href="https://github.com/pyenv/pyenv">pyenv</a> 和 conda。但对 pyenv 和 conda 未作介绍，其中 conda 似乎不该错过。 Anaconda 着力于为数据分析提供支撑，并与 Jupyter Notebook 有更完美的结合，而且 PyCharm 中对它也有很好支持。因此本文来了解一下 conda 以及 Anaconda。<br/><br/>
首先 Anaconda 是什么，它是一个用于科学计算的，跨平台的包管理与 Python 环境的工具，它方便的解决了多版本 Python 并存，切换及第三方包安装的问题。所以 Anaconda 不只是像 <code>venv</code>, <code>pipenv</code> 那样的创建管理 Python 虚拟环境，还承担了系统软件的安装管理，像 Mac 下的 <code>brew</code> 那样的功能。一般来说我们没有必要安装 Anaconda, 只需要安装 Miniconda 获得 <code>conda</code> 这个命令行工具即可。<!--more--><br/><br/>
<h3>Anaconda 的安装(可跳过，安装 conda 即可)</h3><br/><br/>
在这个页面 <a href="https://www.anaconda.com/products/individual">https://www.anaconda.com/products/individual</a> 目前提供了包含了 Python 3.8 的两种安装方式<br/><br/>
<ol>
    <li>图形界面安装：<a href="https://repo.anaconda.com/archive/Anaconda3-2020.07-MacOSX-x86_64.pkg">https://repo.anaconda.com/archive/Anaconda3-2020.07-MacOSX-x86_64.pkg</a></li>
    <li>命令行方式安装：<a href="https://repo.anaconda.com/archive/Anaconda3-2020.07-MacOSX-x86_64.sh">https://repo.anaconda.com/archive/Anaconda3-2020.07-MacOSX-x86_64.sh</a></li>
</ol>
<br/>
命令行安装方式需先下载 Anaconda3-2020.07-MacOSX-x86_64.sh, 然后执行<br/><br/>
<blockquote>
$ bash ~/Downloads/Anaconda3-2020.07-MacOSX-x86_64.sh
</blockquote>
<br/>
试过直接用 curl https://repo.anaconda.com/archive/Anaconda3-2020.07-MacOSX-x86_64.sh | bash, 会死在 <code>&gt;&gt;&gt; Please answer 'yes' or 'no':'</code> 这个循环上。<br/><br/>
或在 Mac 下直接用 <code>brew</code> 进行安装<br/><br/>
<blockquote>
$ brew cask install anaconda
</blockquote>
<br/>
Anaconda 安装后有一个 ANACONDA NAVIGATOR 的界面<br/><br/>
<a href="https://yanbin.blog/wp-content/uploads/2020/07/anaconda-navigator.png"><img class="aligncenter size-large wp-image-10439" src="https://yanbin.blog/wp-content/uploads/2020/07/anaconda-navigator-800x551.png" alt="" width="800" height="551" /></a><br/><br/>
在这个界面可以运行，安装软件，管理虚拟 Python 环境。安装 Anaconda 其实没什么必要，有实际意义也就是那个 <code>conda</code> 命令，于是我们接下来了解 Miniconda 的安装。<br/><br/>
Linux 下的安装脚本下载路径：<a href="https://repo.anaconda.com/archive/Anaconda3-2020.07-Linux-x86_64.sh">https://repo.anaconda.com/archive/Anaconda3-2020.07-Linux-x86_64.sh</a><br/><br/>
<h3>Miniconda 的安装</h3><br/><br/>
在这里 <a href="https://docs.conda.io/en/latest/miniconda.html">https://docs.conda.io/en/latest/miniconda.html</a> 有 Windows, MacOS X, 和 Linux  下的安装包，Mac 平台下目前提供了 Python 为 3.8 和 2.7 的图形界面和命令行的安装方式，和安装 Anaconda 类似的，以 Python 3.8 的安装包为例<br/><br/>
<ol>
    <li>图形界面安装：<a href="https://repo.anaconda.com/miniconda/Miniconda3-latest-MacOSX-x86_64.pkg">https://repo.anaconda.com/miniconda/Miniconda3-latest-MacOSX-x86_64.pkg</a></li>
    <li>命令行方式安装：<a href="https://repo.anaconda.com/miniconda/Miniconda3-latest-MacOSX-x86_64.sh">https://repo.anaconda.com/miniconda/Miniconda3-latest-MacOSX-x86_64.sh</a>，也是需先下载，然后<br/><br/>
<blockquote>$ bash ~/Downloads/Miniconda3-latest-MacOSX-x86_64.sh</blockquote>
<br/>
想要快捷的 `curl https://repo.anaconda.com/miniconda/Miniconda3-latest-MacOSX-x86_64.sh | bash` 也是无法过掉 `&gt;&gt;&gt; Please answer 'yes' or 'no':'` 这一关</li>
</ol>
<br/>
安装过程中会提示选择安装路径，默认在 <code>~/miniconda3</code>, 并且提示初始化为当前所使用的 shell 环境，比如用的是 <code>zsh</code> 的话就会更新 <code>~/.zshrc</code> 配置<br/><br/>
同样的在 Mac OS X 下可用  <code>brew</code> 来安装<br/><br/>
<blockquote>
$ brew cask install miniconda
$ conda init zsh                                 # 假如所用的 shell 是 zsh, 会修改 ~/.zshrc 文件<br />
$ source ~/.zshrc<br />
$ (base) $                                           # 初始化后看到提示符中有了一个当前环境 (base)
</blockquote>
<br/>
用 <code>brew</code> 的安装路径在 <code>/usr/local/Caskroom/miniconda/base</code><br/><br/>
如果不初始化 conda, 则 <code>conda create py37 python=3.7</code> 创建虚拟环境后在试图用 <code>conda activate py37</code> 激活时也会要求用 <code>conda init &lt;SHELL_NAME&gt;</code> 实始化。<br/><br/>
有意思的是用 <code>pip install conda</code> 也能安装下来，但待到运行 <code>conda</code> 命令的时候提示要安装 <code>miniconda</code><br/><br/>
Linux 下的安装脚本下载路径：<a href="https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh">https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh</a><br/><br/>
<h3>conda 的使用</h3><br/><br/>
比如说在 Mac OS X 下我选择了用 <code>brew cask install miniconda</code> 来安装，以后方便用  <code>brew update</code> 和 <code>brew upgrade</code> 进行升级。在安装并用 <code>conda init</code> 初始化后，我们会发现执行的 python 默认是 <code>miniconda</code> 内置的 Python 3.8<br/><br/>
<blockquote>
(base) ➜ test git:(:|) which python<br />
/usr/local/Caskroom/miniconda/base/bin/python<br />
(base) ➜ test git:(:|) python<br />
Python 3.8.3 (default, May 19 2020, 13:54:14)<br />
[Clang 10.0.0 ] :: Anaconda, Inc. on darwin<br />
Type "help", "copyright", "credits" or "license" for more information.<br />
>&gt;&gt;
</blockquote>
<br/>
那么该如何使用其他版本的 Python 呢？莫急，现在我们要开始体验到 <code>conda</code> 与以前所使用的 <code>venv</code>, <code>pipenv</code> 的不同之处了。从前要创建某个 Python 版本的虚拟环境需要在操作系统上事先安装好相应版本的 Python，比如下面要为不同版本的 Python 创建虚拟环境<br/><br/>
<blockquote>
$ python3.7 -m venv py37_venv<br />
$ python3.8 -m vevn py38_venv<br />
$<br />
$ pipenv                                                // 为当前 python 版本创建虚拟环境<br />
$ pipenv --python 3.7                        // 为 python 3.7 合建虚拟环境，系统中必须安装有 python 3.7<br />
$ pipenv --python 3.6                       // 如果系统中未安装 python 3.6, 就会看到 <span style="color: #800000;">Python 3.6 was not found on your system…</span>
</blockquote>
<br/>
有了 conda 就不一样，再也不用想方涉法先在系统中互不影响的安装好各个版本的 Python, Python 3.4, Python 3.5, Python 3.6, Python 3.7, Python 3.8, Python 3.9 还有 Python 2 等各个版本，你不疯掉，系统都快疯掉了。<br/><br/>
conda 创建的虚拟环境是比 <code>venv</code> 和 <code>pipenv</code> 等更高一层次的虚拟化，它自带指定的 Python 版本，系统中只需要 Minoconda 内置的一个 Python 版本即可。<br/><br/>
下面来看 conda 命令管理虚拟环境的用法<br/><br/>
<blockquote>
(base) $ <strong>conda create -n python36 python=3.6</strong> # 创建基于 3.6 的虚拟环境, 或加上修订版本号 python=3.6.3
    environment location: /usr/local/Caskroom/miniconda/base/envs/python36
    added / updated specs:<br />
        - python=3.6
(base)$ <strong>conda activate python36</strong> # 激法虚拟环境<br />
(python36) $ <strong>python -V</strong><br />
Python 3.6.10 :: Anaconda, Inc.<br />
(python36) $ <strong>conda install flask</strong>         # 用 conda 安装依赖，会安装在 /usr/local/Caskroom/miniconda/base/envs/python36/lib/python3.6/site-packages 中<br />
(python36) $ <strong>pip install requests</strong>       # 也会安装在 /usr/local/Caskroom/miniconda/base/envs/python36/lib/python3.6/site-packages 中<br />
(python36) $ <strong>conda deactivate</strong>                 # 退出当前虚拟环境<br />
(base) $ <strong>conda info -e</strong>                              # 列出虚拟环境信息，可用路径来激环境，如 conda activate /Users/yanbin/opt/miniconda3<br />
                                  /Users/yanbin/opt/miniconda3<br />
base                    *   /usr/local/Caskroom/miniconda/base<br />
python36               /usr/local/Caskroom/miniconda/base/envs/python36<br />
(base) $ <strong>conda env remove -n python36</strong>   # 删除虚拟环境，或用  conda remove -n python36 --all
(base) $ <strong>conda create -n python36-1 --clone python36</strong>   # 克隆虚拟环境<br />
(base) $ <strong>conda install -n python36 requests</strong>                     # 为虚拟环境安装组件，无需激活<br />
(base) $ <strong>conda remove -n python36 request</strong>
</blockquote>
<br/>
其他的 conda 命令<br/><br/>
<blockquote>
(python36)$ <strong>conda list</strong>           # 查看已安装的包<br />
(python36)$ <strong>conda update matplotlib</strong>   # 更新包<br />
(python36)$ <strong>conda remove matplotlib</strong>  # 删除包<br />
(python36)$ <strong>conda update conda</strong>           # 更新 conda 自身<br />
(python36)$ <strong>conda update python </strong>        # 更新当前 python 的修订版本，如 python 3.6.2 到 python 3.6.3<br />
(base) $ <strong>conda list -e &gt; requirements.txt</strong>    # 导出已安装组件到文件中，像  pip freeze &gt; requirements.txt<br />
(base) $ <strong>conda install -n python36 --file requirements.txt </strong>  # 像 pip install -r requrements.txt 一样<br />
(base) $ conda create -n py36 --file requirements.txt             # 还能创建虚拟环境时直接安装依赖
</blockquote>
<br/>
查看 conda 支持哪些 Python 版本的虚拟机，用命令<br/><br/>
<blockquote>
(base) $ conda search python
</blockquote>
<br/>
显示出当前支持的所有 Python 版本有 2.7.13, 2.7.14, 2.7.14, 2.7.15, 2.7.16, 2.7.17, 2.7.18, 3.5.4, 3.5.5, 3.5.6, 3.6.2, 3.6.3, 3.6.4, 3.6.5, 3.6.5, 3.6.6, 3.6.7, 3.6.8, 3.6.9, 3.6.10, 3.7.0, 3.7.1, 3.7.1, 3.7.2, 3.7.3, 3.7.4, 3.7.5, 3.7.6, 3.7.7, 3.8.0, 3.8.1, 3.8.2, 3.8.3。<br/><br/>
conda 和 pip 使用了不同的仓库，conda 里的组件管理应该更严格些，所以 conda 仓库中没有的 Python 组件，请尝试用 <code>pip</code> 来安装。<br/><br/>
<h3>PyCharm 对 Conda 虚拟环境的支持</h3><br/><br/>
PyCharm(或 IntelliJ IDEA) 中除了支持 <code>Virtualenv Environment</code> 和 <code>Pipenv Environment</code>  外，也支持 <code>Conda Environment</code>, 请看下图<br/><br/>
&nbsp;<br/><br/>
<a href="https://yanbin.blog/wp-content/uploads/2020/07/pycharm-conda.png"><img class="aligncenter size-large wp-image-10444" src="https://yanbin.blog/wp-content/uploads/2020/07/pycharm-conda-800x344.png" alt="" width="800" height="344" /></a><br/><br/>
可以此时选择不同的 Python 版本创建一个新 Conda 虚拟环境，也可以从已有的 conda 虚拟环境中选取一个; 而无论是创建  <code>Virtualevn Environment</code> 还是 <code>Pipenv Environment</code> 都必须选择一个系统中安装好的 Python 解释器版本。<br/><br/>
<h3>总结一下</h3><br/><br/>
<ol>
    <li>在 Mac OS X 下最简单的安装 conda 的方式为 <code>brew install miniconda</code>, 然后再 <code>conda init zsh</code> 初始化</li>
    <li>Virtualenv 和 Pipenv 创建虚拟环境需要在系统中安装有相应版本的 Python</li>
    <li>而 Conda 把 Python 版本自身纳入到虚拟环境的一部分，方便系统中多 Python 版本共存。系统中只要安装一个 conda(自带 Python), 想要别的 Python 版本只需用它来创建相应的 Python 虚拟环境。Linux 下都用不着编译源代码的方式来安装 Python 了，只需以命令行的方式运行 .sh 安装好 miniconda 后，得来 Python 想要的版本就不怎么费功夫了。</li>
    <li>conda 和 pip 使用了不同的仓库，conda 没有的组件可用 pip 来安装，反之亦然</li>
    <li>conda 安装 Python 组件前会列出所有的其他依赖</li>
    <li>conda 适用于多语言，除 Python 外还支持 R, Ruby, Lua, Scala, Java, JavaScript, C/C++, FORTRAN，比如 <code>conda install -c anaconda-cluster scala</code></li>
</ol>
<br/>
相关链接：<br/><br/>
<ol>
    <li><a href="https://zhuanlan.zhihu.com/p/32925500">Anaconda介绍, 安装及使用教程</a></li>
</ol>
