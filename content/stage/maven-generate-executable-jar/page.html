---
title: Maven 工程生成可执行的 JAR 包
url: /maven-generate-executable-jar/
date: 2014-02-16T23:52:30-06:00
featured: false
draft: true
type: post
toc: false
# menu: main
usePageBundles: true
categories:
  - Java/JEE
tags: 
  - Maven
comment: true
codeMaxLines: 50
# additional
wpPostId: 6205 
wpStatus: publish
views: 2548
lastmod: 2021-05-02T22:20:42-05:00
---

远离 Maven 工程有些时日了，也不知道当前还是否在流行 Maven 管理工程与依赖，当前类似工具有 <a href="https://ant.apache.org/" target="_blank" rel="noopener">Ant</a>+<a href="https://ant.apache.org/ivy/" target="_blank" rel="noopener">Ivy</a>, <a href="http://gruntjs.com" target="_blank" rel="noopener">Grunt</a>, <a href="http://www.scala-sbt.org" target="_blank" rel="noopener">sbt</a> 和 <a href="http://www.gradle.org" target="_blank" rel="noopener">Gradle</a>。Web 工程的输出发布包没什么好说的，因为 &lt;packaging&gt;<code>war</code>&lt;/packaging&gt;，所以 <code>mvn package</code> 出来的 WAR 包里就有站点运行的所有内容了，用到的依赖会在 WEB-INF/lib 目录下列着。</p>
<br/>
而对于那些 &lt;packaging&gt;<code>jar</code>&lt;/packaging&gt; 的工程，用 <code>mvn package</code> 只会生成一个 JAR 包，它所依赖的各个类库仍然分散在本地仓库中，而我们的发布包应该包含这些第三方依赖的。<br/><br/>
假定，有一个 GoSSH  Maven 工程，设定的版本是 0.0.1，它依赖了 jsch-0.1.50, commons-cli-1.3-SNAPSHOT，想要发布的包有如下布局<br/><br/>
<blockquote>
GoSSH-0.0.1.jar<br />
lib<br />
        jsch-0.1.50.jar<br />
        commons-cli-1.3-20140216.032825-101.jar     #这里的 revision 号是随 SNAPSHOT 动态而定的
</blockquote>
<br/>
并且在 GoSSH-0.0.1.jar 中的 META-INF/MANIFEST.MF 文件中指定了<!--more--><br/><br/>
<blockquote>
Class-Path: lib/jsch-0.1.50.jar lib/commons-cli-1.3-20140216.032825-101.jar<br />
Main-Class: cc.unmi.Main
</blockquote>
<br/>
想要的效果就是可以用命令<br/><br/>
<blockquote>
java -jar GoSSH-0.0.1.jar
</blockquote>
<br/>
直接执行 为了这个需求我们可以使用 <a href="http://maven.apache.org/plugins/maven-jar-plugin/" target="_blank" rel="noopener">maven-jar-plugin</a> 和 <a href="http://maven.apache.org/plugins/maven-dependency-plugin/" target="_blank" rel="noopener">maven-dependency-plugin </a>这两个插件。它有许多的 Goal，这里是我自己的一个配置片断<br/><br/>
<pre class="lang:default decode:true">    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-jar-plugin&lt;/artifactId&gt;
                &lt;version&gt;2.4&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;archive&gt;
                        &lt;manifest&gt;
                            &lt;addClasspath&gt;true&lt;/addClasspath&gt;
                            &lt;classpathPrefix&gt;lib/&lt;/classpathPrefix&gt;
                            &lt;mainClass&gt;cc.unmi.Main&lt;/mainClass&gt;
                        &lt;/manifest&gt;
                    &lt;/archive&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;id&gt;copy-dependencies&lt;/id&gt;
                        &lt;phase&gt;pre-package&lt;/phase&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;copy&lt;/goal&gt;
                        &lt;/goals&gt;
                        &lt;configuration&gt;
                            &lt;artifactItems&gt;
                                &lt;artifactItem&gt;
                                    &lt;groupId&gt;com.jcraft&lt;/groupId&gt;
                                    &lt;artifactId&gt;jsch&lt;/artifactId&gt;
                                    &lt;version&gt;0.1.50&lt;/version&gt;
                                    &lt;outputDirectory&gt;${project.build.directory}/lib&lt;/outputDirectory&gt;
                                    &lt;overWrite&gt;true&lt;/overWrite&gt;
                                &lt;/artifactItem&gt;
                                &lt;artifactItem&gt;
                                    &lt;groupId&gt;commons-cli&lt;/groupId&gt;
                                    &lt;artifactId&gt;commons-cli&lt;/artifactId&gt;
                                    &lt;version&gt;1.3-SNAPSHOT&lt;/version&gt;
                                    &lt;outputDirectory&gt;${project.build.directory}/lib&lt;/outputDirectory&gt;
                                    &lt;overWrite&gt;true&lt;/overWrite&gt;
                                &lt;/artifactItem&gt;
                            &lt;/artifactItems&gt;
                        &lt;/configuration&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
        ......
        &lt;/plugins&gt;
</pre>
<br/>
看到上面那段代码一眼就能看出它们正在做什么，对，要用到的需拷贝到 lib 目录中的依赖包配置成 &lt;artifactItem&gt;，以后执行 mvn package 时就会生成前面的目录布局，GoSSH-0.0.1.jar 和 lib/jsch-0.1.50.jar 和 lib/commons-cli-1.3-20140216.032825-101.jar。这就是我们要的发布包的内容。<br/><br/>
另外，我们只借助于插件 <a href="http://maven.apache.org/plugins/maven-assembly-plugin/" target="_blank" rel="noopener">maven-assembly-plugin</a> 能做出一个包含了依赖类的独立的 JAR 包，比如生成的 GoSSH-0.0.1-jar-with-dependencies.jar，内含在 &lt;dependencies&gt; 中配置的运行时依赖，它们不再以一个个 JAR 各自存在，而是全部内容都在那个 xxx-with-dependencies.jar 中的。<br/><br/>
这时候的配置是<br/><br/>
<pre class="lang:default decode:true ">    &lt;build&gt;
        &lt;plugins&gt; 
           &lt;plugin&gt;
                &lt;!-- mvn assembly:single --&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;descriptorRefs&gt;
                        &lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt;
                    &lt;/descriptorRefs&gt;
                    &lt;archive&gt;
                        &lt;manifest&gt;
                            &lt;mainClass&gt;cc.unmi.Main&lt;/mainClass&gt;
                        &lt;/manifest&gt;
                    &lt;/archive&gt;
                &lt;/configuration&gt;
                &lt;executions&gt;  &lt;!-- 这部分配置只是为了把任务绑定到 package --&gt;
                    &lt;execution&gt;
                        &lt;id&gt;make-assembly&lt;/id&gt;
                        &lt;phase&gt;package&lt;/phase&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;single&lt;/goal&gt;
                        &lt;/goals&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
        ......
        &lt;/plugins
</pre>
<br/>
这样在执行 mvn package 或 mvn assembly:single 就会生成 GoSSH-0.0.1-jar-with-dependencies.jar，发布的时候只需要这一个文件就行了。但这样做其实有些不太好，自己的类与依赖类混在一起，不知道依赖了哪些包，可能这个无依赖的包会很大。<br/><br/>
更多的配置细节，还得去浏览以上所提到的三个插件官网上的帮助。
