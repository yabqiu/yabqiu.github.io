{{/*
    for bundle use
    Cannot mix named and positional parameters
*/}}

{{ $originalSrc := or (.Get "src") (.Get 0) }}
{{ $width := or (.Get "width") (.Get 1) | default "" }}
{{ $class := or (.Get "class") (.Get 2) | default "aligncenter" }}
{{ $url := .Page.Params.url }}
{{ $section := .Page.Section }}

{{ if $width }}
  {{ if not (strings.HasSuffix $width "px") }}
    {{ $width = printf "%vpx" $width }}
  {{ end }}
{{ end }}

{{ $cleanedSrc := $originalSrc | replaceRE "-\\d+x\\d+(\\.\\w+)$" "$1" }}

{{ if ne $originalSrc $cleanedSrc }}
<a href="/{{ $section }}{{ $url }}{{ $cleanedSrc }}" target="_blank" rel="noreferrer">
{{ end }}
<img class="{{ $class }}"
     src="/{{ $section }}{{ $url }}{{ $originalSrc }}"
     {{ if $width }}width="{{ $width }}"{{ end }}
/>
{{ if ne $originalSrc $cleanedSrc }}
</a>
{{ end }}